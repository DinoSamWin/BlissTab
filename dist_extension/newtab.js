import{r as f,a as Na,j as c,c as ks,R as xe,X as ao,G as Oa,b as Ia}from"./assets/GatewayCreateModal-fQTNZ94e.js";/**
 * react-router v7.12.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var Xs="popstate";function Pa(t={}){function e(n,s){let{pathname:i,search:o,hash:a}=n.location;return rs("",{pathname:i,search:o,hash:a},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function r(n,s){return typeof s=="string"?s:Cr(s)}return Da(e,r,null,t)}function _e(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function lt(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function La(){return Math.random().toString(36).substring(2,10)}function Qs(t,e){return{usr:t.state,key:t.key,idx:e}}function rs(t,e,r=null,n){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?ir(e):e,state:r,key:e&&e.key||n||La()}}function Cr({pathname:t="/",search:e="",hash:r=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),r&&r!=="#"&&(t+=r.charAt(0)==="#"?r:"#"+r),t}function ir(t){let e={};if(t){let r=t.indexOf("#");r>=0&&(e.hash=t.substring(r),t=t.substring(0,r));let n=t.indexOf("?");n>=0&&(e.search=t.substring(n),t=t.substring(0,n)),t&&(e.pathname=t)}return e}function Da(t,e,r,n={}){let{window:s=document.defaultView,v5Compat:i=!1}=n,o=s.history,a="POP",l=null,u=d();u==null&&(u=0,o.replaceState({...o.state,idx:u},""));function d(){return(o.state||{idx:null}).idx}function g(){a="POP";let m=d(),x=m==null?null:m-u;u=m,l&&l({action:a,location:b.location,delta:x})}function h(m,x){a="PUSH";let _=rs(b.location,m,x);u=d()+1;let w=Qs(_,u),C=b.createHref(_);try{o.pushState(w,"",C)}catch(P){if(P instanceof DOMException&&P.name==="DataCloneError")throw P;s.location.assign(C)}i&&l&&l({action:a,location:b.location,delta:1})}function p(m,x){a="REPLACE";let _=rs(b.location,m,x);u=d();let w=Qs(_,u),C=b.createHref(_);o.replaceState(w,"",C),i&&l&&l({action:a,location:b.location,delta:0})}function v(m){return $a(m)}let b={get action(){return a},get location(){return t(s,o)},listen(m){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(Xs,g),l=m,()=>{s.removeEventListener(Xs,g),l=null}},createHref(m){return e(s,m)},createURL:v,encodeLocation(m){let x=v(m);return{pathname:x.pathname,search:x.search,hash:x.hash}},push:h,replace:p,go(m){return o.go(m)}};return b}function $a(t,e=!1){let r="http://localhost";typeof window<"u"&&(r=window.location.origin!=="null"?window.location.origin:window.location.href),_e(r,"No window.location.(origin|href) available to create URL");let n=typeof t=="string"?t:Cr(t);return n=n.replace(/ $/,"%20"),!e&&n.startsWith("//")&&(n=r+n),new URL(n,r)}function lo(t,e,r="/"){return Ua(t,e,r,!1)}function Ua(t,e,r,n){let s=typeof e=="string"?ir(e):e,i=_t(s.pathname||"/",r);if(i==null)return null;let o=co(t);Ma(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let u=Ya(i);a=Va(o[l],u,n)}return a}function co(t,e=[],r=[],n="",s=!1){let i=(o,a,l=s,u)=>{let d={relativePath:u===void 0?o.path||"":u,caseSensitive:o.caseSensitive===!0,childrenIndex:a,route:o};if(d.relativePath.startsWith("/")){if(!d.relativePath.startsWith(n)&&l)return;_e(d.relativePath.startsWith(n),`Absolute route path "${d.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),d.relativePath=d.relativePath.slice(n.length)}let g=xt([n,d.relativePath]),h=r.concat(d);o.children&&o.children.length>0&&(_e(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${g}".`),co(o.children,e,h,g,l)),!(o.path==null&&!o.index)&&e.push({path:g,score:Ha(g,o.index),routesMeta:h})};return t.forEach((o,a)=>{var l;if(o.path===""||!((l=o.path)!=null&&l.includes("?")))i(o,a);else for(let u of uo(o.path))i(o,a,!0,u)}),e}function uo(t){let e=t.split("/");if(e.length===0)return[];let[r,...n]=e,s=r.endsWith("?"),i=r.replace(/\?$/,"");if(n.length===0)return s?[i,""]:[i];let o=uo(n.join("/")),a=[];return a.push(...o.map(l=>l===""?i:[i,l].join("/"))),s&&a.push(...o),a.map(l=>t.startsWith("/")&&l===""?"/":l)}function Ma(t){t.sort((e,r)=>e.score!==r.score?r.score-e.score:Ka(e.routesMeta.map(n=>n.childrenIndex),r.routesMeta.map(n=>n.childrenIndex)))}var Fa=/^:[\w-]+$/,Ba=3,qa=2,za=1,Wa=10,Ga=-2,Zs=t=>t==="*";function Ha(t,e){let r=t.split("/"),n=r.length;return r.some(Zs)&&(n+=Ga),e&&(n+=qa),r.filter(s=>!Zs(s)).reduce((s,i)=>s+(Fa.test(i)?Ba:i===""?za:Wa),n)}function Ka(t,e){return t.length===e.length&&t.slice(0,-1).every((n,s)=>n===e[s])?t[t.length-1]-e[e.length-1]:0}function Va(t,e,r=!1){let{routesMeta:n}=t,s={},i="/",o=[];for(let a=0;a<n.length;++a){let l=n[a],u=a===n.length-1,d=i==="/"?e:e.slice(i.length)||"/",g=on({path:l.relativePath,caseSensitive:l.caseSensitive,end:u},d),h=l.route;if(!g&&u&&r&&!n[n.length-1].route.index&&(g=on({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},d)),!g)return null;Object.assign(s,g.params),o.push({params:s,pathname:xt([i,g.pathname]),pathnameBase:el(xt([i,g.pathnameBase])),route:h}),g.pathnameBase!=="/"&&(i=xt([i,g.pathnameBase]))}return o}function on(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[r,n]=Ja(t.path,t.caseSensitive,t.end),s=e.match(r);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),a=s.slice(1);return{params:n.reduce((u,{paramName:d,isOptional:g},h)=>{if(d==="*"){let v=a[h]||"";o=i.slice(0,i.length-v.length).replace(/(.)\/+$/,"$1")}const p=a[h];return g&&!p?u[d]=void 0:u[d]=(p||"").replace(/%2F/g,"/"),u},{}),pathname:i,pathnameBase:o,pattern:t}}function Ja(t,e=!1,r=!0){lt(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let n=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(n.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(n.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),n]}function Ya(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return lt(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function _t(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let r=e.endsWith("/")?e.length-1:e.length,n=t.charAt(r);return n&&n!=="/"?null:t.slice(r)||"/"}var ho=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Xa=t=>ho.test(t);function Qa(t,e="/"){let{pathname:r,search:n="",hash:s=""}=typeof t=="string"?ir(t):t,i;if(r)if(Xa(r))i=r;else{if(r.includes("//")){let o=r;r=r.replace(/\/\/+/g,"/"),lt(!1,`Pathnames cannot have embedded double slashes - normalizing ${o} -> ${r}`)}r.startsWith("/")?i=ei(r.substring(1),"/"):i=ei(r,e)}else i=e;return{pathname:i,search:tl(n),hash:rl(s)}}function ei(t,e){let r=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?r.length>1&&r.pop():s!=="."&&r.push(s)}),r.length>1?r.join("/"):"/"}function Ln(t,e,r,n){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${r}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function Za(t){return t.filter((e,r)=>r===0||e.route.path&&e.route.path.length>0)}function Ss(t){let e=Za(t);return e.map((r,n)=>n===e.length-1?r.pathname:r.pathnameBase)}function Es(t,e,r,n=!1){let s;typeof t=="string"?s=ir(t):(s={...t},_e(!s.pathname||!s.pathname.includes("?"),Ln("?","pathname","search",s)),_e(!s.pathname||!s.pathname.includes("#"),Ln("#","pathname","hash",s)),_e(!s.search||!s.search.includes("#"),Ln("#","search","hash",s)));let i=t===""||s.pathname==="",o=i?"/":s.pathname,a;if(o==null)a=r;else{let g=e.length-1;if(!n&&o.startsWith("..")){let h=o.split("/");for(;h[0]==="..";)h.shift(),g-=1;s.pathname=h.join("/")}a=g>=0?e[g]:"/"}let l=Qa(s,a),u=o&&o!=="/"&&o.endsWith("/"),d=(i||o===".")&&r.endsWith("/");return!l.pathname.endsWith("/")&&(u||d)&&(l.pathname+="/"),l}var xt=t=>t.join("/").replace(/\/\/+/g,"/"),el=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),tl=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,rl=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,nl=class{constructor(t,e,r,n=!1){this.status=t,this.statusText=e||"",this.internal=n,r instanceof Error?(this.data=r.toString(),this.error=r):this.data=r}};function sl(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function il(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var fo=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function go(t,e){let r=t;if(typeof r!="string"||!ho.test(r))return{absoluteURL:void 0,isExternal:!1,to:r};let n=r,s=!1;if(fo)try{let i=new URL(window.location.href),o=r.startsWith("//")?new URL(i.protocol+r):new URL(r),a=_t(o.pathname,e);o.origin===i.origin&&a!=null?r=a+o.search+o.hash:s=!0}catch{lt(!1,`<Link to="${r}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:n,isExternal:s,to:r}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var po=["POST","PUT","PATCH","DELETE"];new Set(po);var ol=["GET",...po];new Set(ol);var or=f.createContext(null);or.displayName="DataRouter";var vn=f.createContext(null);vn.displayName="DataRouterState";var al=f.createContext(!1),mo=f.createContext({isTransitioning:!1});mo.displayName="ViewTransition";var ll=f.createContext(new Map);ll.displayName="Fetchers";var cl=f.createContext(null);cl.displayName="Await";var nt=f.createContext(null);nt.displayName="Navigation";var Dr=f.createContext(null);Dr.displayName="Location";var bt=f.createContext({outlet:null,matches:[],isDataRoute:!1});bt.displayName="Route";var Cs=f.createContext(null);Cs.displayName="RouteError";var bo="REACT_ROUTER_ERROR",ul="REDIRECT",dl="ROUTE_ERROR_RESPONSE";function hl(t){if(t.startsWith(`${bo}:${ul}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function fl(t){if(t.startsWith(`${bo}:${dl}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new nl(e.status,e.statusText,e.data)}catch{}}function gl(t,{relative:e}={}){_e(ar(),"useHref() may be used only in the context of a <Router> component.");let{basename:r,navigator:n}=f.useContext(nt),{hash:s,pathname:i,search:o}=$r(t,{relative:e}),a=i;return r!=="/"&&(a=i==="/"?r:xt([r,i])),n.createHref({pathname:a,search:o,hash:s})}function ar(){return f.useContext(Dr)!=null}function kt(){return _e(ar(),"useLocation() may be used only in the context of a <Router> component."),f.useContext(Dr).location}var yo="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function wo(t){f.useContext(nt).static||f.useLayoutEffect(t)}function vo(){let{isDataRoute:t}=f.useContext(bt);return t?Rl():pl()}function pl(){_e(ar(),"useNavigate() may be used only in the context of a <Router> component.");let t=f.useContext(or),{basename:e,navigator:r}=f.useContext(nt),{matches:n}=f.useContext(bt),{pathname:s}=kt(),i=JSON.stringify(Ss(n)),o=f.useRef(!1);return wo(()=>{o.current=!0}),f.useCallback((l,u={})=>{if(lt(o.current,yo),!o.current)return;if(typeof l=="number"){r.go(l);return}let d=Es(l,JSON.parse(i),s,u.relative==="path");t==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:xt([e,d.pathname])),(u.replace?r.replace:r.push)(d,u.state,u)},[e,r,i,s,t])}f.createContext(null);function $r(t,{relative:e}={}){let{matches:r}=f.useContext(bt),{pathname:n}=kt(),s=JSON.stringify(Ss(r));return f.useMemo(()=>Es(t,JSON.parse(s),n,e==="path"),[t,s,n,e])}function ml(t,e){return xo(t,e)}function xo(t,e,r,n,s){var _;_e(ar(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=f.useContext(nt),{matches:o}=f.useContext(bt),a=o[o.length-1],l=a?a.params:{},u=a?a.pathname:"/",d=a?a.pathnameBase:"/",g=a&&a.route;{let w=g&&g.path||"";ko(u,!g||w.endsWith("*")||w.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${w}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${w}"> to <Route path="${w==="/"?"*":`${w}/*`}">.`)}let h=kt(),p;if(e){let w=typeof e=="string"?ir(e):e;_e(d==="/"||((_=w.pathname)==null?void 0:_.startsWith(d)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${d}" but pathname "${w.pathname}" was given in the \`location\` prop.`),p=w}else p=h;let v=p.pathname||"/",b=v;if(d!=="/"){let w=d.replace(/^\//,"").split("/");b="/"+v.replace(/^\//,"").split("/").slice(w.length).join("/")}let m=lo(t,{pathname:b});lt(g||m!=null,`No routes matched location "${p.pathname}${p.search}${p.hash}" `),lt(m==null||m[m.length-1].route.element!==void 0||m[m.length-1].route.Component!==void 0||m[m.length-1].route.lazy!==void 0,`Matched leaf route at location "${p.pathname}${p.search}${p.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let x=xl(m&&m.map(w=>Object.assign({},w,{params:Object.assign({},l,w.params),pathname:xt([d,i.encodeLocation?i.encodeLocation(w.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:w.pathname]),pathnameBase:w.pathnameBase==="/"?d:xt([d,i.encodeLocation?i.encodeLocation(w.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:w.pathnameBase])})),o,r,n,s);return e&&x?f.createElement(Dr.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...p},navigationType:"POP"}},x):x}function bl(){let t=Cl(),e=sl(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),r=t instanceof Error?t.stack:null,n="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:n},i={padding:"2px 4px",backgroundColor:n},o=null;return console.error("Error handled by React Router default ErrorBoundary:",t),o=f.createElement(f.Fragment,null,f.createElement("p",null,"ğŸ’¿ Hey developer ğŸ‘‹"),f.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",f.createElement("code",{style:i},"ErrorBoundary")," or"," ",f.createElement("code",{style:i},"errorElement")," prop on your route.")),f.createElement(f.Fragment,null,f.createElement("h2",null,"Unexpected Application Error!"),f.createElement("h3",{style:{fontStyle:"italic"}},e),r?f.createElement("pre",{style:s},r):null,o)}var yl=f.createElement(bl,null),_o=class extends f.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const r=fl(t.digest);r&&(t=r)}let e=t!==void 0?f.createElement(bt.Provider,{value:this.props.routeContext},f.createElement(Cs.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?f.createElement(wl,{error:t},e):e}};_o.contextType=al;var Dn=new WeakMap;function wl({children:t,error:e}){let{basename:r}=f.useContext(nt);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let n=hl(e.digest);if(n){let s=Dn.get(e);if(s)throw s;let i=go(n.location,r);if(fo&&!Dn.get(e))if(i.isExternal||n.reloadDocument)window.location.href=i.absoluteURL||i.to;else{const o=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(i.to,{replace:n.replace}));throw Dn.set(e,o),o}return f.createElement("meta",{httpEquiv:"refresh",content:`0;url=${i.absoluteURL||i.to}`})}}return t}function vl({routeContext:t,match:e,children:r}){let n=f.useContext(or);return n&&n.static&&n.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=e.route.id),f.createElement(bt.Provider,{value:t},r)}function xl(t,e=[],r=null,n=null,s=null){if(t==null){if(!r)return null;if(r.errors)t=r.matches;else if(e.length===0&&!r.initialized&&r.matches.length>0)t=r.matches;else return null}let i=t,o=r==null?void 0:r.errors;if(o!=null){let d=i.findIndex(g=>g.route.id&&(o==null?void 0:o[g.route.id])!==void 0);_e(d>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),i=i.slice(0,Math.min(i.length,d+1))}let a=!1,l=-1;if(r)for(let d=0;d<i.length;d++){let g=i[d];if((g.route.HydrateFallback||g.route.hydrateFallbackElement)&&(l=d),g.route.id){let{loaderData:h,errors:p}=r,v=g.route.loader&&!h.hasOwnProperty(g.route.id)&&(!p||p[g.route.id]===void 0);if(g.route.lazy||v){a=!0,l>=0?i=i.slice(0,l+1):i=[i[0]];break}}}let u=r&&n?(d,g)=>{var h,p;n(d,{location:r.location,params:((p=(h=r.matches)==null?void 0:h[0])==null?void 0:p.params)??{},unstable_pattern:il(r.matches),errorInfo:g})}:void 0;return i.reduceRight((d,g,h)=>{let p,v=!1,b=null,m=null;r&&(p=o&&g.route.id?o[g.route.id]:void 0,b=g.route.errorElement||yl,a&&(l<0&&h===0?(ko("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),v=!0,m=null):l===h&&(v=!0,m=g.route.hydrateFallbackElement||null)));let x=e.concat(i.slice(0,h+1)),_=()=>{let w;return p?w=b:v?w=m:g.route.Component?w=f.createElement(g.route.Component,null):g.route.element?w=g.route.element:w=d,f.createElement(vl,{match:g,routeContext:{outlet:d,matches:x,isDataRoute:r!=null},children:w})};return r&&(g.route.ErrorBoundary||g.route.errorElement||h===0)?f.createElement(_o,{location:r.location,revalidation:r.revalidation,component:b,error:p,children:_(),routeContext:{outlet:null,matches:x,isDataRoute:!0},onError:u}):_()},null)}function Rs(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function _l(t){let e=f.useContext(or);return _e(e,Rs(t)),e}function kl(t){let e=f.useContext(vn);return _e(e,Rs(t)),e}function Sl(t){let e=f.useContext(bt);return _e(e,Rs(t)),e}function Ts(t){let e=Sl(t),r=e.matches[e.matches.length-1];return _e(r.route.id,`${t} can only be used on routes that contain a unique "id"`),r.route.id}function El(){return Ts("useRouteId")}function Cl(){var n;let t=f.useContext(Cs),e=kl("useRouteError"),r=Ts("useRouteError");return t!==void 0?t:(n=e.errors)==null?void 0:n[r]}function Rl(){let{router:t}=_l("useNavigate"),e=Ts("useNavigate"),r=f.useRef(!1);return wo(()=>{r.current=!0}),f.useCallback(async(s,i={})=>{lt(r.current,yo),r.current&&(typeof s=="number"?await t.navigate(s):await t.navigate(s,{fromRouteId:e,...i}))},[t,e])}var ti={};function ko(t,e,r){!e&&!ti[t]&&(ti[t]=!0,lt(!1,r))}f.memo(Tl);function Tl({routes:t,future:e,state:r,onError:n}){return xo(t,void 0,r,n,e)}function jl({to:t,replace:e,state:r,relative:n}){_e(ar(),"<Navigate> may be used only in the context of a <Router> component.");let{static:s}=f.useContext(nt);lt(!s,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:i}=f.useContext(bt),{pathname:o}=kt(),a=vo(),l=Es(t,Ss(i),o,n==="path"),u=JSON.stringify(l);return f.useEffect(()=>{a(JSON.parse(u),{replace:e,state:r,relative:n})},[a,u,n,e,r]),null}function mr(t){_e(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Al({basename:t="/",children:e=null,location:r,navigationType:n="POP",navigator:s,static:i=!1,unstable_useTransitions:o}){_e(!ar(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=t.replace(/^\/*/,"/"),l=f.useMemo(()=>({basename:a,navigator:s,static:i,unstable_useTransitions:o,future:{}}),[a,s,i,o]);typeof r=="string"&&(r=ir(r));let{pathname:u="/",search:d="",hash:g="",state:h=null,key:p="default"}=r,v=f.useMemo(()=>{let b=_t(u,a);return b==null?null:{location:{pathname:b,search:d,hash:g,state:h,key:p},navigationType:n}},[a,u,d,g,h,p,n]);return lt(v!=null,`<Router basename="${a}"> is not able to match the URL "${u}${d}${g}" because it does not start with the basename, so the <Router> won't render anything.`),v==null?null:f.createElement(nt.Provider,{value:l},f.createElement(Dr.Provider,{children:e,value:v}))}function Nl({children:t,location:e}){return ml(ns(t),e)}function ns(t,e=[]){let r=[];return f.Children.forEach(t,(n,s)=>{if(!f.isValidElement(n))return;let i=[...e,s];if(n.type===f.Fragment){r.push.apply(r,ns(n.props.children,i));return}_e(n.type===mr,`[${typeof n.type=="string"?n.type:n.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),_e(!n.props.index||!n.props.children,"An index route cannot have child routes.");let o={id:n.props.id||i.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,middleware:n.props.middleware,loader:n.props.loader,action:n.props.action,hydrateFallbackElement:n.props.hydrateFallbackElement,HydrateFallback:n.props.HydrateFallback,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.hasErrorBoundary===!0||n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(o.children=ns(n.props.children,i)),r.push(o)}),r}var tn="get",rn="application/x-www-form-urlencoded";function xn(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function Ol(t){return xn(t)&&t.tagName.toLowerCase()==="button"}function Il(t){return xn(t)&&t.tagName.toLowerCase()==="form"}function Pl(t){return xn(t)&&t.tagName.toLowerCase()==="input"}function Ll(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function Dl(t,e){return t.button===0&&(!e||e==="_self")&&!Ll(t)}var Gr=null;function $l(){if(Gr===null)try{new FormData(document.createElement("form"),0),Gr=!1}catch{Gr=!0}return Gr}var Ul=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function $n(t){return t!=null&&!Ul.has(t)?(lt(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${rn}"`),null):t}function Ml(t,e){let r,n,s,i,o;if(Il(t)){let a=t.getAttribute("action");n=a?_t(a,e):null,r=t.getAttribute("method")||tn,s=$n(t.getAttribute("enctype"))||rn,i=new FormData(t)}else if(Ol(t)||Pl(t)&&(t.type==="submit"||t.type==="image")){let a=t.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=t.getAttribute("formaction")||a.getAttribute("action");if(n=l?_t(l,e):null,r=t.getAttribute("formmethod")||a.getAttribute("method")||tn,s=$n(t.getAttribute("formenctype"))||$n(a.getAttribute("enctype"))||rn,i=new FormData(a,t),!$l()){let{name:u,type:d,value:g}=t;if(d==="image"){let h=u?`${u}.`:"";i.append(`${h}x`,"0"),i.append(`${h}y`,"0")}else u&&i.append(u,g)}}else{if(xn(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');r=tn,n=null,s=rn,o=t}return i&&s==="text/plain"&&(o=i,i=void 0),{action:n,method:r.toLowerCase(),encType:s,formData:i,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function js(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Fl(t,e,r,n){let s=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r?s.pathname.endsWith("/")?s.pathname=`${s.pathname}_.${n}`:s.pathname=`${s.pathname}.${n}`:s.pathname==="/"?s.pathname=`_root.${n}`:e&&_t(s.pathname,e)==="/"?s.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:s.pathname=`${s.pathname.replace(/\/$/,"")}.${n}`,s}async function Bl(t,e){if(t.id in e)return e[t.id];try{let r=await import(t.module);return e[t.id]=r,r}catch(r){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(r),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function ql(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function zl(t,e,r){let n=await Promise.all(t.map(async s=>{let i=e.routes[s.route.id];if(i){let o=await Bl(i,r);return o.links?o.links():[]}return[]}));return Kl(n.flat(1).filter(ql).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function ri(t,e,r,n,s,i){let o=(l,u)=>r[u]?l.route.id!==r[u].route.id:!0,a=(l,u)=>{var d;return r[u].pathname!==l.pathname||((d=r[u].route.path)==null?void 0:d.endsWith("*"))&&r[u].params["*"]!==l.params["*"]};return i==="assets"?e.filter((l,u)=>o(l,u)||a(l,u)):i==="data"?e.filter((l,u)=>{var g;let d=n.routes[l.route.id];if(!d||!d.hasLoader)return!1;if(o(l,u)||a(l,u))return!0;if(l.route.shouldRevalidate){let h=l.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:((g=r[0])==null?void 0:g.params)||{},nextUrl:new URL(t,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof h=="boolean")return h}return!0}):[]}function Wl(t,e,{includeHydrateFallback:r}={}){return Gl(t.map(n=>{let s=e.routes[n.route.id];if(!s)return[];let i=[s.module];return s.clientActionModule&&(i=i.concat(s.clientActionModule)),s.clientLoaderModule&&(i=i.concat(s.clientLoaderModule)),r&&s.hydrateFallbackModule&&(i=i.concat(s.hydrateFallbackModule)),s.imports&&(i=i.concat(s.imports)),i}).flat(1))}function Gl(t){return[...new Set(t)]}function Hl(t){let e={},r=Object.keys(t).sort();for(let n of r)e[n]=t[n];return e}function Kl(t,e){let r=new Set;return new Set(e),t.reduce((n,s)=>{let i=JSON.stringify(Hl(s));return r.has(i)||(r.add(i),n.push({key:i,link:s})),n},[])}function So(){let t=f.useContext(or);return js(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function Vl(){let t=f.useContext(vn);return js(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var As=f.createContext(void 0);As.displayName="FrameworkContext";function Eo(){let t=f.useContext(As);return js(t,"You must render this element inside a <HydratedRouter> element"),t}function Jl(t,e){let r=f.useContext(As),[n,s]=f.useState(!1),[i,o]=f.useState(!1),{onFocus:a,onBlur:l,onMouseEnter:u,onMouseLeave:d,onTouchStart:g}=e,h=f.useRef(null);f.useEffect(()=>{if(t==="render"&&o(!0),t==="viewport"){let b=x=>{x.forEach(_=>{o(_.isIntersecting)})},m=new IntersectionObserver(b,{threshold:.5});return h.current&&m.observe(h.current),()=>{m.disconnect()}}},[t]),f.useEffect(()=>{if(n){let b=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(b)}}},[n]);let p=()=>{s(!0)},v=()=>{s(!1),o(!1)};return r?t!=="intent"?[i,h,{}]:[i,h,{onFocus:fr(a,p),onBlur:fr(l,v),onMouseEnter:fr(u,p),onMouseLeave:fr(d,v),onTouchStart:fr(g,p)}]:[!1,h,{}]}function fr(t,e){return r=>{t&&t(r),r.defaultPrevented||e(r)}}function Yl({page:t,...e}){let{router:r}=So(),n=f.useMemo(()=>lo(r.routes,t,r.basename),[r.routes,t,r.basename]);return n?f.createElement(Ql,{page:t,matches:n,...e}):null}function Xl(t){let{manifest:e,routeModules:r}=Eo(),[n,s]=f.useState([]);return f.useEffect(()=>{let i=!1;return zl(t,e,r).then(o=>{i||s(o)}),()=>{i=!0}},[t,e,r]),n}function Ql({page:t,matches:e,...r}){let n=kt(),{future:s,manifest:i,routeModules:o}=Eo(),{basename:a}=So(),{loaderData:l,matches:u}=Vl(),d=f.useMemo(()=>ri(t,e,u,i,n,"data"),[t,e,u,i,n]),g=f.useMemo(()=>ri(t,e,u,i,n,"assets"),[t,e,u,i,n]),h=f.useMemo(()=>{if(t===n.pathname+n.search+n.hash)return[];let b=new Set,m=!1;if(e.forEach(_=>{var C;let w=i.routes[_.route.id];!w||!w.hasLoader||(!d.some(P=>P.route.id===_.route.id)&&_.route.id in l&&((C=o[_.route.id])!=null&&C.shouldRevalidate)||w.hasClientLoader?m=!0:b.add(_.route.id))}),b.size===0)return[];let x=Fl(t,a,s.unstable_trailingSlashAwareDataRequests,"data");return m&&b.size>0&&x.searchParams.set("_routes",e.filter(_=>b.has(_.route.id)).map(_=>_.route.id).join(",")),[x.pathname+x.search]},[a,s.unstable_trailingSlashAwareDataRequests,l,n,i,d,e,t,o]),p=f.useMemo(()=>Wl(g,i),[g,i]),v=Xl(g);return f.createElement(f.Fragment,null,h.map(b=>f.createElement("link",{key:b,rel:"prefetch",as:"fetch",href:b,...r})),p.map(b=>f.createElement("link",{key:b,rel:"modulepreload",href:b,...r})),v.map(({key:b,link:m})=>f.createElement("link",{key:b,nonce:r.nonce,...m})))}function Zl(...t){return e=>{t.forEach(r=>{typeof r=="function"?r(e):r!=null&&(r.current=e)})}}var ec=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{ec&&(window.__reactRouterVersion="7.12.0")}catch{}function tc({basename:t,children:e,unstable_useTransitions:r,window:n}){let s=f.useRef();s.current==null&&(s.current=Pa({window:n,v5Compat:!0}));let i=s.current,[o,a]=f.useState({action:i.action,location:i.location}),l=f.useCallback(u=>{r===!1?a(u):f.startTransition(()=>a(u))},[r]);return f.useLayoutEffect(()=>i.listen(l),[i,l]),f.createElement(Al,{basename:t,children:e,location:o.location,navigationType:o.action,navigator:i,unstable_useTransitions:r})}var Co=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ro=f.forwardRef(function({onClick:e,discover:r="render",prefetch:n="none",relative:s,reloadDocument:i,replace:o,state:a,target:l,to:u,preventScrollReset:d,viewTransition:g,unstable_defaultShouldRevalidate:h,...p},v){let{basename:b,unstable_useTransitions:m}=f.useContext(nt),x=typeof u=="string"&&Co.test(u),_=go(u,b);u=_.to;let w=gl(u,{relative:s}),[C,P,k]=Jl(n,p),E=ic(u,{replace:o,state:a,target:l,preventScrollReset:d,relative:s,viewTransition:g,unstable_defaultShouldRevalidate:h,unstable_useTransitions:m});function A(X){e&&e(X),X.defaultPrevented||E(X)}let L=f.createElement("a",{...p,...k,href:_.absoluteURL||w,onClick:_.isExternal||i?e:A,ref:Zl(v,P),target:l,"data-discover":!x&&r==="render"?"true":void 0});return C&&!x?f.createElement(f.Fragment,null,L,f.createElement(Yl,{page:w})):L});Ro.displayName="Link";var rc=f.forwardRef(function({"aria-current":e="page",caseSensitive:r=!1,className:n="",end:s=!1,style:i,to:o,viewTransition:a,children:l,...u},d){let g=$r(o,{relative:u.relative}),h=kt(),p=f.useContext(vn),{navigator:v,basename:b}=f.useContext(nt),m=p!=null&&uc(g)&&a===!0,x=v.encodeLocation?v.encodeLocation(g).pathname:g.pathname,_=h.pathname,w=p&&p.navigation&&p.navigation.location?p.navigation.location.pathname:null;r||(_=_.toLowerCase(),w=w?w.toLowerCase():null,x=x.toLowerCase()),w&&b&&(w=_t(w,b)||w);const C=x!=="/"&&x.endsWith("/")?x.length-1:x.length;let P=_===x||!s&&_.startsWith(x)&&_.charAt(C)==="/",k=w!=null&&(w===x||!s&&w.startsWith(x)&&w.charAt(x.length)==="/"),E={isActive:P,isPending:k,isTransitioning:m},A=P?e:void 0,L;typeof n=="function"?L=n(E):L=[n,P?"active":null,k?"pending":null,m?"transitioning":null].filter(Boolean).join(" ");let X=typeof i=="function"?i(E):i;return f.createElement(Ro,{...u,"aria-current":A,className:L,ref:d,style:X,to:o,viewTransition:a},typeof l=="function"?l(E):l)});rc.displayName="NavLink";var nc=f.forwardRef(({discover:t="render",fetcherKey:e,navigate:r,reloadDocument:n,replace:s,state:i,method:o=tn,action:a,onSubmit:l,relative:u,preventScrollReset:d,viewTransition:g,unstable_defaultShouldRevalidate:h,...p},v)=>{let{unstable_useTransitions:b}=f.useContext(nt),m=lc(),x=cc(a,{relative:u}),_=o.toLowerCase()==="get"?"get":"post",w=typeof a=="string"&&Co.test(a),C=P=>{if(l&&l(P),P.defaultPrevented)return;P.preventDefault();let k=P.nativeEvent.submitter,E=(k==null?void 0:k.getAttribute("formmethod"))||o,A=()=>m(k||P.currentTarget,{fetcherKey:e,method:E,navigate:r,replace:s,state:i,relative:u,preventScrollReset:d,viewTransition:g,unstable_defaultShouldRevalidate:h});b&&r!==!1?f.startTransition(()=>A()):A()};return f.createElement("form",{ref:v,method:_,action:x,onSubmit:n?l:C,...p,"data-discover":!w&&t==="render"?"true":void 0})});nc.displayName="Form";function sc(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function To(t){let e=f.useContext(or);return _e(e,sc(t)),e}function ic(t,{target:e,replace:r,state:n,preventScrollReset:s,relative:i,viewTransition:o,unstable_defaultShouldRevalidate:a,unstable_useTransitions:l}={}){let u=vo(),d=kt(),g=$r(t,{relative:i});return f.useCallback(h=>{if(Dl(h,e)){h.preventDefault();let p=r!==void 0?r:Cr(d)===Cr(g),v=()=>u(t,{replace:p,state:n,preventScrollReset:s,relative:i,viewTransition:o,unstable_defaultShouldRevalidate:a});l?f.startTransition(()=>v()):v()}},[d,u,g,r,n,e,t,s,i,o,a,l])}var oc=0,ac=()=>`__${String(++oc)}__`;function lc(){let{router:t}=To("useSubmit"),{basename:e}=f.useContext(nt),r=El(),n=t.fetch,s=t.navigate;return f.useCallback(async(i,o={})=>{let{action:a,method:l,encType:u,formData:d,body:g}=Ml(i,e);if(o.navigate===!1){let h=o.fetcherKey||ac();await n(h,r,o.action||a,{unstable_defaultShouldRevalidate:o.unstable_defaultShouldRevalidate,preventScrollReset:o.preventScrollReset,formData:d,body:g,formMethod:o.method||l,formEncType:o.encType||u,flushSync:o.flushSync})}else await s(o.action||a,{unstable_defaultShouldRevalidate:o.unstable_defaultShouldRevalidate,preventScrollReset:o.preventScrollReset,formData:d,body:g,formMethod:o.method||l,formEncType:o.encType||u,replace:o.replace,state:o.state,fromRouteId:r,flushSync:o.flushSync,viewTransition:o.viewTransition})},[n,s,e,r])}function cc(t,{relative:e}={}){let{basename:r}=f.useContext(nt),n=f.useContext(bt);_e(n,"useFormAction must be used inside a RouteContext");let[s]=n.matches.slice(-1),i={...$r(t||".",{relative:e})},o=kt();if(t==null){i.search=o.search;let a=new URLSearchParams(i.search),l=a.getAll("index");if(l.some(d=>d==="")){a.delete("index"),l.filter(g=>g).forEach(g=>a.append("index",g));let d=a.toString();i.search=d?`?${d}`:""}}return(!t||t===".")&&s.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),r!=="/"&&(i.pathname=i.pathname==="/"?r:xt([r,i.pathname])),Cr(i)}function uc(t,{relative:e}={}){let r=f.useContext(mo);_e(r!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=To("useViewTransitionState"),s=$r(t,{relative:e});if(!r.isTransitioning)return!1;let i=_t(r.currentLocation.pathname,n)||r.currentLocation.pathname,o=_t(r.nextLocation.pathname,n)||r.nextLocation.pathname;return on(s.pathname,o)!=null||on(s.pathname,i)!=null}var Zt=Na();const ni="1.0.0",si={name:"StartlyTab",slogan:"Start your day softly"},dc=[{code:"English",name:"English"},{code:"German",name:"Deutsch"},{code:"French",name:"FranÃ§ais"},{code:"Spanish",name:"EspaÃ±ol"},{code:"Italian",name:"Italiano"},{code:"Portuguese",name:"PortuguÃªs"},{code:"Japanese",name:"æ—¥æœ¬èª"},{code:"Chinese (Simplified)",name:"ç®€ä½“ä¸­æ–‡"}],hc=[{id:"1",url:"https://github.com",title:"GitHub",icon:"https://www.google.com/s2/favicons?sz=64&domain=github.com",color:"#333"},{id:"2",url:"https://notion.so",title:"Notion",icon:"https://www.google.com/s2/favicons?sz=64&domain=notion.so",color:"#000"},{id:"3",url:"https://calendar.google.com",title:"Calendar",icon:"https://www.google.com/s2/favicons?sz=64&domain=calendar.google.com",color:"#4285F4"}],ii=[{id:"r1",prompt:"A short productivity tip for office workers",active:!0},{id:"r2",prompt:"A calm, philosophical morning reflection",active:!0},{id:"r3",prompt:"A funny one-line joke about software engineering",active:!0},{id:"r4",prompt:"A beautiful, short quote about creativity",active:!0}],oi={English:["Simplicity is the ultimate sophistication.","Your direction is more important than your speed.","Small progress is still progress.","Be where your feet are.","Nature does not hurry, yet everything is accomplished.","A quiet mind is a productive mind.","Rest is not idleness, but a necessary pause."],"Chinese (Simplified)":["ç®€çº¦æ˜¯æœ€é«˜çº§çš„å¤æ‚ã€‚","æ–¹å‘æ¯”é€Ÿåº¦æ›´é‡è¦ã€‚","å¾®å°çš„è¿›æ­¥ä¹Ÿæ˜¯è¿›æ­¥ã€‚","æ´»åœ¨å½“ä¸‹ã€‚","å¤§è‡ªç„¶ä»ä¸åŒ†å¿™ï¼Œä½†ä¸‡ç‰©çš†æœ‰æˆã€‚","å®é™çš„å¿ƒçµæ˜¯é«˜æ•ˆçš„ã€‚","ä¼‘æ¯ä¸æ˜¯æ— æ‰€äº‹äº‹ï¼Œè€Œæ˜¯å¿…è¦çš„åœé¡¿ã€‚"],German:["Einfachheit ist die hÃ¶chste Stufe der Vollendung.","Deine Richtung ist wichtiger als dein Tempo.","Kleiner Fortschritt ist immer noch Fortschritt.","Sei dort, wo deine FÃ¼ÃŸe sind.","Die Natur beeilt sich nicht, und doch wird alles erreicht.","Ein ruhiger Geist ist ein produktiver Geist.","Pause ist kein MÃ¼ÃŸiggang, sondern eine notwendige Unterbrechung."],French:["La simplicitÃ© est la sophistication suprÃªme.","Votre direction est plus importante que votre vitesse.","Un petit progrÃ¨s est toujours un progrÃ¨s.","Soyez lÃ  oÃ¹ sont vos pieds.","La nature ne se presse pas, et pourtant tout est accompli.","Un esprit calme est un esprit productif.","Le repos n'est pas de l'oisivetÃ©, mais une pause nÃ©cessaire."],Spanish:["La simplicidad es la mÃ¡xima sofisticaciÃ³n.","Tu direcciÃ³n es mÃ¡s importante que tu velocidad.","Un pequeÃ±o progreso sigue siendo progreso.","Estate donde estÃ¡n tus pies.","La naturaleza no se apresura, pero todo se logra.","Una mente tranquila es una mente productiva.","El descanso no es ociosidad, sino una pausa necesaria."],Italian:["La semplicitÃ  Ã¨ l'ultima sofisticazione.","La tua direzione Ã¨ piÃ¹ importante della tua velocitÃ .","Il piccolo progresso Ã¨ pur sempre un progresso.","Sii dove sono i tuoi piedi.","La natura non ha fretta, eppure tutto Ã¨ compiuto.","Una mente calma Ã¨ una mente produttiva.","Il riposo non Ã¨ ozio, ma una pausa necessaria."],Portuguese:["A simplicidade Ã© o Ãºltimo grau da sofisticaÃ§Ã£o.","Sua direÃ§Ã£o Ã© mais importante que sua velocidade.","Pequeno progresso ainda Ã© progresso.","Esteja onde seus pÃ©s estÃ£o.","A natureza nÃ£o tem pressa, mas tudo se realiza.","Uma mente calma Ã© uma mente produtiva.","O descanso nÃ£o Ã© ociosidade, mas uma pausa necessÃ¡ria."],Japanese:["ã‚·ãƒ³ãƒ—ãƒ«ã•ã¯ç©¶æ¥µã®æ´—ç·´ã§ã‚ã‚‹ã€‚","æ–¹å‘æ€§ã¯ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚ˆã‚Šã‚‚é‡è¦ã§ã‚ã‚‹ã€‚","å°ã•ãªé€²æ­©ã‚‚é€²æ­©ã§ã‚ã‚‹ã€‚","ä»Šã€ã“ã“ã‚’ç”Ÿãã‚‹ã€‚","è‡ªç„¶ã¯æ€¥ãŒãªã„ãŒã€ã™ã¹ã¦ã‚’æˆã—é‚ã’ã‚‹ã€‚","é™ã‹ãªå¿ƒã¯ç”Ÿç”£çš„ãªå¿ƒã§ã‚ã‚‹ã€‚","ä¼‘æ¯ã¯æ€ æƒ°ã§ã¯ãªãã€å¿…è¦ãªä¸­æ–­ã§ã‚ã‚‹ã€‚"]},ai=["#E5E7EB","#FEE2E2","#FEF3C7","#D1FAE5","#DBEAFE","#E0E7FF","#F3E8FF","#FCE7F3"],gr=[{id:"google",name:"Google",icon:"https://www.google.com/s2/favicons?sz=32&domain=google.com",searchUrl:"https://www.google.com/search?q="},{id:"bing",name:"Bing",icon:"https://www.google.com/s2/favicons?sz=32&domain=bing.com",searchUrl:"https://www.bing.com/search?q="},{id:"duckduckgo",name:"DuckDuckGo",icon:"https://www.google.com/s2/favicons?sz=32&domain=duckduckgo.com",searchUrl:"https://duckduckgo.com/?q="},{id:"brave",name:"Brave Search",icon:"https://www.google.com/s2/favicons?sz=32&domain=search.brave.com",searchUrl:"https://search.brave.com/search?q="},{id:"ecosia",name:"Ecosia",icon:"https://www.google.com/s2/favicons?sz=32&domain=ecosia.org",searchUrl:"https://www.ecosia.org/search?q="}],fc="google",gc=14,pc=.7;function li(t){return t.replace(/\[h\](.*?)\[\/h\]/g,"$1").toLowerCase().trim().replace(/\s+/g," ")}function mc(t,e){const r=li(t),n=li(e);if(r===n)return 1;const s=new Set(r.split(/\s+/)),i=new Set(n.split(/\s+/)),o=new Set([...s].filter(l=>i.has(l))),a=new Set([...s,...i]);return o.size/a.size}function bc(t,e,r=pc){return!e||e.length===0?!1:e.some(n=>mc(t,n.text)>=r)}function jo(t,e=gc){const r=Date.now()-e*24*60*60*1e3;return t.filter(n=>n.timestamp>=r)}function ci(t,e,r=[],n){const s=jo(r);return[{text:t,timestamp:Date.now(),promptId:e,...n},...s].slice(0,50)}function Un(){try{const t=localStorage.getItem("focus_tab_perspective_history");if(!t)return[];const e=JSON.parse(t);return jo(Array.isArray(e)?e:[])}catch(t){return console.error("Failed to load perspective history",t),[]}}function ui(t){try{localStorage.setItem("focus_tab_perspective_history",JSON.stringify(t))}catch(e){console.error("Failed to save perspective history",e)}}function di(t){const e=Date.now()-6048e5,r=new Set;return t.forEach(n=>{if(n.timestamp<e)return;const s=new Date(n.timestamp),i=s.getHours();(i>=23||i<6)&&r.add(s.toDateString())}),r.size}function yc(t){if(t.length===0)return 999;const e=t[0].timestamp;return Math.floor((Date.now()-e)/(1e3*60))}function hi(t){const e=new Date;e.setHours(0,0,0,0);const r=e.getTime();return t.filter(n=>n.timestamp>=r).length}const wc=[{range:[6,9],intent:"kickstart"},{range:[9,11],intent:"focus",endMin:30},{range:[11,13],intent:"lighten",startMin:30,endMin:30},{range:[13,15],intent:"focus",startMin:30},{range:[15,18],intent:"decompress"},{range:[18,20],intent:"celebrate"},{range:[20,23],intent:"care"},{range:[23,6],intent:"sleep"}],fi={kickstart:{micro_action:35,micro_story:20,gentle_question:15,reframe:15,witty:10,permission:5},focus:{micro_action:45,reframe:20,gentle_question:15,micro_story:10,permission:5,witty:5},lighten:{witty:30,micro_story:20,permission:20,gentle_question:15,reframe:10,micro_action:5},decompress:{permission:25,reframe:25,micro_story:20,micro_action:15,gentle_question:10,witty:5},celebrate:{witty:25,micro_story:25,permission:20,reframe:15,micro_action:10,gentle_question:5},care:{micro_story:30,permission:25,reframe:20,micro_action:15,gentle_question:10,witty:0},sleep:{permission:40,micro_story:25,gentle_question:15,reframe:10,micro_action:10,witty:0},weekend:{micro_story:30,witty:25,permission:20,gentle_question:15,micro_action:10,reframe:0}},vc={"zh-CN":42,"ja-JP":42,"en-US":90,"de-DE":120};function xc(t){const[e,r]=t.split(":").map(Number),n=e*60+r;for(const s of wc){let[i,o]=s.range,a=(s.startMin||0)+i*60,l=(s.endMin||0)+o*60;if(i>o){if(n>=a||n<l)return s.intent}else if(n>=a&&n<l)return s.intent}return"focus"}function Mn(t,e={}){const r=Object.entries(t).map(([i,o])=>{let a=o;return e[i]&&(a*=e[i]),{key:i,weight:a}}),n=r.reduce((i,o)=>i+o.weight,0);if(n===0)return r[0].key;let s=Math.random()*n;for(const{key:i,weight:o}of r)if(s-=o,s<=0)return i;return r[0].key}function gi(t){let e=xc(t.local_time);const r=parseInt(t.local_time.split(":")[0]);if(t.is_weekend&&r>=6&&r<20&&(e="weekend"),t.work_mode_disabled&&["focus","decompress","care"].includes(e)&&(e="lighten"),t.late_night_streak>=2&&(r>=20&&r<23?e="care":(r>=23||r<6)&&(e="sleep")),t.session_count_today>=6&&e!=="sleep"&&e!=="care"){const h={[e]:40,lighten:30,decompress:30};e=Mn(h)}const n=t.custom_themes||[];let s="context";if(t.theme_only&&n.length>0)s="custom";else if(n.length>0){let h=.55+.05*n.length;h=Math.max(.55,Math.min(.85,h)),["sleep","care"].includes(e)&&(h-=.15),t.session_count_today>=6&&(h+=.1),h=Math.max(0,Math.min(1,h)),Math.random()<h&&(s="custom")}let i;if(s==="custom"&&n.length>0){const h=t.recent_history.slice(0,5).map(m=>m.theme),p={},v={};h.forEach(m=>{m&&(v[m]=(v[m]||0)+1)}),Object.entries(v).forEach(([m,x])=>{x>=2&&(p[m]=.4)});const b=Object.fromEntries(n.map(m=>[m,100]));i=Mn(b,p)}const o=fi[e]||fi.focus,a=t.recent_history.slice(0,5).map(h=>h.style),l={};a.slice(0,2).forEach(h=>{h&&(l[h]=(l[h]||1)*.2)});const d={};if(a.forEach(h=>{h&&(d[h]=(d[h]||0)+1)}),Object.entries(d).forEach(([h,p])=>{p>=3&&(l[h]=(l[h]||1)*.3)}),t.minutes_since_last<=3&&a.length>0){const h=a[0];h&&(l[h]=.01)}const g=Mn(o,l);return{intent:e,style:g,topic_source:s,selected_theme:i,language:t.language,max_length_chars:vc[t.language]||42,allow_one_comma:!0}}const an={"zh-CN":{kickstart:{micro_action:["å…ˆæŠŠ {å¹²æ‰°ç‰©} å…³æ‰ï¼Œ{åŠ¨ä½œ} 5 åˆ†é’Ÿå°±å¥½ã€‚","é†’æ¥ç¬¬ä¸€æ­¥ï¼š{åŠ¨ä½œ}ï¼Œåˆ«æƒ³å¤ªå¤šã€‚","å’–å•¡ä¹‹å‰ï¼Œå…ˆæŠŠ {å°ä»»åŠ¡} å¤„ç†æ‰ã€‚","ä»Šå¤©ä¸ç”¨å®Œç¾ï¼Œå…ˆå®Œæˆ {ä¸€æ­¥}ã€‚"],micro_story:["ç°åœ¨è¿™ä¸ªæ—¶é—´ç‚¹ï¼Œ{åœºæ™¯ç‰©} è¿˜å¾ˆå®‰é™ã€‚","çª—å¤–åˆšäº®ï¼Œä½ åªéœ€è¦å¤„ç† {ä¸€ä»¶äº‹}ã€‚","æ—©ä¸Šçš„è„‘å­æœ‰ç‚¹æ…¢ï¼Œæ²¡å…³ç³»ã€‚"],gentle_question:["ä»Šå¤©ç¬¬ä¸€æ­¥ï¼Œä½ æƒ³å…ˆæå®šä»€ä¹ˆï¼Ÿ","ç°åœ¨è¿™ä¸ªç‚¹ï¼Œä»€ä¹ˆæœ€å€¼å¾—å…ˆåšï¼Ÿ"],reframe:["æ—©èµ·çš„æ„ä¹‰ä¸æ˜¯èµ¶æ—¶é—´ï¼Œæ˜¯æ‹¥æœ‰è¿™ç‰‡åˆ»çš„æ§åˆ¶æƒã€‚","ä¸éœ€è¦ç«‹åˆ»è¿›å…¥æˆ˜æ–—çŠ¶æ€ï¼Œæ…¢æ…¢æ»‘è¡Œèµ·é£å°±å¥½ã€‚"],witty:["æ—©èµ·çš„é¸Ÿå„¿ä¸ä¸€å®šæœ‰è™«åƒï¼Œä½†ä¸€å®šèƒ½æ¯”åˆ«äººå¤šå–ä¸€æ¯å’–å•¡ã€‚","é—¹é’Ÿå“çš„æ—¶å€™å¾ˆç—›è‹¦ï¼Œä½†ç°åœ¨æ¸…é†’çš„æ„Ÿè§‰è¿˜ä¸é”™ã€‚"],permission:["å¦‚æœè¿˜å›°ï¼Œå…è®¸è‡ªå·±å†å‘ä¸‰åˆ†é’Ÿå‘†ã€‚","æ…¢æ…¢æ¥ï¼Œè¿™ä¸€å¤©ä¸éœ€è¦æ€¥ç€å¼€å§‹ã€‚"]},focus:{micro_action:["åªç›¯ç€ {ä¸€ä¸ªæ–‡ä»¶/ä¸€ä¸ªæ¨¡å—}ï¼Œå…¶ä»–å…ˆåˆ«ç®¡ã€‚","æŠŠ {å¹²æ‰°æº} æ”¾è¿œç‚¹ï¼Œä¸“å¿ƒ 10 åˆ†é’Ÿã€‚","å…ˆåšæœ€ä¸æƒ³åšçš„é‚£ä¸€æ­¥ã€‚","ç°åœ¨åªè§£å†³ {ä¸€ä¸ªé—®é¢˜}ã€‚"],reframe:["ä¸æ˜¯æ•ˆç‡ä½ï¼Œæ˜¯ä»»åŠ¡æ‹†å¾—ä¸å¤Ÿå°ã€‚","ä½ ä¸éœ€è¦å…¨åšå®Œï¼Œåªéœ€è¦æ¨è¿›ä¸€ç‚¹ç‚¹ã€‚"],gentle_question:["å¦‚æœåªåšä¸€ä»¶äº‹ï¼Œåº”è¯¥æ˜¯å“ªä¸€ä»¶ï¼Ÿ","ç°åœ¨æœ€å½±å“è¿›åº¦çš„ï¼Œæ˜¯å“ªä¸€æ­¥ï¼Ÿ"],micro_story:["é”®ç›˜æ•²å‡»çš„å£°éŸ³å¦‚æœæ˜¯è¿è´¯çš„ï¼Œé‚£å°±æ˜¯æœ€å¥½çš„ç™½å™ªéŸ³ã€‚","å‘¨å›´è¶Šåµï¼Œè€³æœºé‡Œè¶Šå®‰é™ã€‚"],permission:["ä¸“æ³¨ä¸ä»£è¡¨ä¸èƒ½èµ°ç¥ï¼Œé‚£æ˜¯å¤§è„‘åœ¨æ¢æ°”ã€‚","å¦‚æœå¡ä½äº†ï¼Œå°±å…ˆåœä¸‹æ¥ï¼Œä¸è¦ç¡¬æ’ã€‚"],witty:["æ‰‹æœºå±å¹•æœ€å¥½ç°åœ¨çœ‹èµ·æ¥æ˜¯é»‘çš„ã€‚","å‡è£…è‡ªå·±æ˜¯ä¸€ä¸ªè«å¾—æ„Ÿæƒ…çš„åšäº‹æœºå™¨ã€‚"]},lighten:{witty:["åˆ«ç¡¬æ’‘ï¼Œ{é£Ÿç‰©/é¥®å“} èƒ½æ•‘ä½ ä¸€å‘½ã€‚","ä¸­åˆä¸ç”¨æƒ³å¤ªå¤šï¼Œåƒç‚¹ä¸œè¥¿å†è¯´ã€‚","å¤§è„‘æœ‰ç‚¹ç½¢å·¥ï¼Œå…è®¸çš„ã€‚"],permission:["è¿™ä¸€æ®µæ—¶é—´ï¼Œæœ¬æ¥å°±ä¸é€‚åˆæ‹¼å‘½ã€‚","ç°åœ¨æ…¢ä¸€ç‚¹ï¼Œæ˜¯æ­£å¸¸çš„ã€‚"],micro_story:["è¿™ä¸ªç‚¹ï¼Œå¤§å¤šæ•°äººéƒ½åœ¨æ‘¸é±¼ã€‚","å±å¹•äº®ç€ï¼Œä½†å¿ƒå·²ç»åœ¨å¤–é¢äº†ã€‚"],gentle_question:["ç°åœ¨æœ€æƒ³åƒçš„é£Ÿç‰©æ˜¯ä»€ä¹ˆï¼Ÿ","å¦‚æœä¸‹åˆå¯ä»¥å·æ‡’ä¸€å°æ—¶ï¼Œä½ ä¼šåšä»€ä¹ˆï¼Ÿ"],reframe:["ä¼‘æ¯ä¸æ˜¯æµªè´¹æ—¶é—´ï¼Œæ˜¯ç»™ä¸‹åˆå……ç”µã€‚","ç°åœ¨çš„æ¾å¼›ï¼Œæ˜¯ä¸ºäº†å¾…ä¼šçš„ç´§ç»·ã€‚"],micro_action:["ç«™èµ·æ¥ä¼¸ä¸ªæ‡’è…°ï¼Œå¬å¬éª¨å¤´å“çš„å£°éŸ³ã€‚","å»æ¥æ¯æ°´ï¼Œé¡ºä¾¿çœ‹çœ‹çª—å¤–ã€‚"]},decompress:{permission:["ç´¯äº†ä¸æ˜¯é—®é¢˜ï¼Œæ˜¯ä¿¡å·ã€‚","ç°åœ¨ä¸é«˜æ•ˆï¼Œä¹Ÿæ²¡å…³ç³»ã€‚"],reframe:["ä¸‹åˆçš„æ•ˆç‡ï¼Œæœ¬æ¥å°±ä¸é ç¡¬æ‰›ã€‚","æ’‘åˆ°ç°åœ¨ï¼Œå·²ç»ä¸é”™äº†ã€‚"],micro_action:["ç«™èµ·æ¥èµ°ä¸¤æ­¥ï¼Œå†å›æ¥ç»§ç»­ã€‚","æŠŠ {çª—å£/èŠå¤©å·¥å…·} å…³ä¸€ä¸ªã€‚"],micro_story:["é˜³å…‰å¼€å§‹æ–œç€ç…§è¿›æ¥ï¼Œè¿™ä¸€å¤©è¿‡åŠäº†ã€‚","èŒ¶æ¯é‡Œçš„æ°´å‡‰äº†ï¼Œè¯¥æ¢ä¸€æ¯çƒ­çš„äº†ã€‚"],gentle_question:["ä»Šå¤©æœ€éš¾çš„éƒ¨åˆ†è¿‡å»äº†å—ï¼Ÿ","ç°åœ¨èƒ½ä¸èƒ½æŠŠèŠ‚å¥æ”¾æ…¢ä¸€æ¡£ï¼Ÿ"],witty:["ä¸‹åˆä¸‰ç‚¹ï¼Œæ˜¯åˆæ³•çš„å‘å‘†æ—¶é—´ã€‚","ç°åœ¨çš„å·¥ä½œæ•ˆç‡ä½ï¼Œæ˜¯ç”Ÿç†è§„å¾‹ï¼Œä¸æ€ªä½ ã€‚"]},celebrate:{witty:["ä¸‹ç­å‰çš„å¤§è„‘ï¼Œå·²ç»ä¸æƒ³é…åˆäº†ã€‚","æ­å–œè¾¾æˆæˆå°±ï¼šæˆåŠŸå­˜æ´»åˆ°ä¸‹ç­ã€‚"],micro_story:["ä¸€å¤©å¿«ç»“æŸäº†ï¼Œäº‹æƒ…ä¹Ÿå·®ä¸å¤šäº†ã€‚","ç°åœ¨è¿™ä¸ªç‚¹ï¼Œå¯ä»¥å¼€å§‹æ”¶å°¾äº†ã€‚"],permission:["ä»Šå¤©åˆ°è¿™å„¿ï¼Œå°±ç®—å®Œæˆã€‚","å‰©ä¸‹çš„ï¼Œæ˜å¤©å†è¯´ã€‚"],reframe:["ä¸ç®¡åšå¾—æ€ä¹ˆæ ·ï¼Œä»Šå¤©éƒ½ç»“æŸäº†ã€‚","æ”¶å°¾å·¥ä½œä¹Ÿæ˜¯å·¥ä½œï¼Œä¸éœ€è¦æ‹¼å‘½ã€‚"],micro_action:["æ•´ç†ä¸€ä¸‹æ¡Œé¢ï¼Œå‡†å¤‡é€šè¿‡ç»ˆç‚¹çº¿ã€‚","æŠŠæ˜å¤©è¦åšçš„äº‹å†™ä¸‹æ¥ï¼Œç„¶åå¿˜æ‰å®ƒä»¬ã€‚"],gentle_question:["ä»Šå¤©æœ‰ä»€ä¹ˆå°äº‹å€¼å¾—ç»™è‡ªå·±ç‚¹ä¸ªèµï¼Ÿ","å¾…ä¼šç¦»å¼€è¿™é‡Œï¼Œç¬¬ä¸€ä»¶äº‹æƒ³åšä»€ä¹ˆï¼Ÿ"]},care:{micro_story:["è¿™ä¸ªæ—¶é—´è¿˜åœ¨ç”µè„‘å‰ï¼ŒçœŸçš„ä¸å®¹æ˜“ã€‚","ç¯è¿˜äº®ç€ï¼Œä½ å·²ç»å¾ˆåŠªåŠ›äº†ã€‚"],permission:["æ…¢ä¸€ç‚¹å§ï¼Œä¸ç”¨å†é€¼è‡ªå·±ã€‚","ä»Šå¤©åšåˆ°è¿™å„¿ï¼Œä¹Ÿç®—äº¤ä»£äº†ã€‚"],reframe:["åŠ ç­ä¸ä»£è¡¨ä½ ä¸è¡Œï¼Œåªæ˜¯äº‹æƒ…å¤ªå¤šã€‚","ç°åœ¨çš„åšæŒï¼Œæ˜¯ä¸ºäº†ç»™è‡ªå·±ä¸€ä¸ªäº¤ä»£ã€‚"],micro_action:["æ‰æ‰çœ¼ç›ï¼Œæ·±å‘¼å¸ä¸‰æ¬¡ã€‚","å–å£æ°´ï¼Œæ„Ÿå—æ¸©çƒ­æµè¿‡å–‰å’™ã€‚"],gentle_question:["ç°åœ¨æœ€éœ€è¦ç…§é¡¾çš„æ˜¯ä¸æ˜¯ä½ çš„èº«ä½“ï¼Ÿ","å¦‚æœç°åœ¨åœä¸‹æ¥ï¼Œä¼šæœ‰å¤šä¸¥é‡çš„åæœï¼Ÿ"],witty:[]},sleep:{permission:["ä»Šå¤©å¯ä»¥ç»“æŸäº†ï¼Œå»ç¡å§ã€‚","äº‹æƒ…ä¸ä¼šè·‘ï¼Œèº«ä½“ä¼šã€‚"],micro_story:["å¤œè¿™ä¹ˆæ·±äº†ï¼Œå±å¹•è¿˜äº®ç€ã€‚","è¿™ä¸ªç‚¹ï¼Œä¸–ç•Œä¸ä¼šå‚¬ä½ ã€‚"],gentle_question:["ç°åœ¨ç¡ä¸‹å»ï¼Œä¼šæ›´åˆ’ç®—å—ï¼Ÿ","ä»Šå¤©æœ‰ä»€ä¹ˆç¬é—´æ˜¯å€¼å¾—ç•™æ‹çš„ï¼Ÿ"],reframe:["ç¡çœ æ˜¯æœ€å¥½çš„é‡å¯é”®ã€‚","ç°åœ¨çš„æ”¾å¼ƒï¼Œæ˜¯ä¸ºäº†æ˜å¤©çš„æ»¡è¡€å¤æ´»ã€‚"],micro_action:["å…³ä¸Šå±å¹•ï¼Œå¬å¬å‘¨å›´çš„å£°éŸ³ã€‚","æŠŠæ‰‹æœºè°ƒæˆé™éŸ³ï¼Œç»™è‡ªå·±ä¸€ä¸ªå®‰é™çš„ä¸–ç•Œã€‚"],witty:["ç†¬å¤œå¹¶ä¸èƒ½æŠŠæ˜¨å¤©ç†¬å›æ¥ã€‚","è¢«çªå·²ç»åœ¨å‘¼å”¤ä½ çš„åå­—äº†ã€‚"]},weekend:{micro_story:["ä»Šå¤©ä¸æ˜¯å·¥ä½œæ—¥ï¼ŒèŠ‚å¥å¯ä»¥ä¸ä¸€æ ·ã€‚","æ—¶é—´æ˜¯è‡ªå·±çš„ï¼Œä¸ç”¨èµ¶ã€‚"],permission:["å‘¨æœ«æ…¢ä¸€ç‚¹ï¼Œæ˜¯åº”è¯¥çš„ã€‚","ä»Šå¤©ä¸åšä»»ä½•æ­£äº‹ï¼Œä¹Ÿæ˜¯ä¸€ç§æ­£äº‹ã€‚"],witty:["ä»Šå¤©ä¸é«˜æ•ˆï¼Œä¹Ÿä¸ä¼šå‡ºäº‹ã€‚","å‘¨å…­çš„é—¹é’Ÿï¼Œå»ºè®®ç›´æ¥æ‰”å‡ºçª—å¤–ã€‚"],gentle_question:["ä»Šå¤©æœ€æƒ³æŠŠæ—¶é—´æµªè´¹åœ¨ä»€ä¹ˆä¸Šï¼Ÿ","å¦‚æœä¸è€ƒè™‘æœ‰ç”¨ï¼Œä½ æƒ³åšä»€ä¹ˆï¼Ÿ"],micro_action:["æ™’æ™’å¤ªé˜³ï¼Œå‘å‘å‘†ã€‚","æ‰¾ä¸€æœ¬çœ‹ä¸æ‡‚çš„ä¹¦ï¼Œå‚¬çœ ä¸€ä¸‹è‡ªå·±ã€‚"],reframe:["ä¼‘æ¯ä¸æ˜¯å·æ‡’ï¼Œæ˜¯ç”Ÿæ´»æœ¬æ¥çš„æ ·å­ã€‚","å‘¨æœ«çš„æ„ä¹‰ï¼Œå°±æ˜¯ç”¨æ¥è™šåº¦æ—¶å…‰çš„ã€‚"]},custom_theme_content:{interesting:["{Content}ï¼Œè¿™ä¹Ÿè®¸å’Œæ­¤åˆ»çš„ä½ æœ‰ç‚¹åƒã€‚","å¦‚æœä¸çœ‹å±å¹•ï¼Œ{Content}ã€‚","å°±åƒ {Theme} é‡Œè¯´çš„ï¼š{Content}ã€‚","{Content}ã€‚"],witty:["å¦‚æœè¦ç”¨ {Theme} æ¥è§£é‡Šç°åœ¨ï¼Œé‚£å°±æ˜¯ï¼š{Content}ã€‚","ç”Ÿæ´»æœ‰æ—¶å€™åƒ {Theme}ï¼š{Content}ã€‚"],reframe:["è¯•ç€ç”¨ {Theme} çš„é€»è¾‘çœ‹ä¸–ç•Œï¼š{Content}ã€‚","å¦‚æœæŠŠä½ ç°åœ¨çš„çŠ¶æ€å¸¦å…¥ {Theme}ï¼š{Content}ã€‚"],gentle_question:["å¦‚æœæ˜¯ {Theme}ï¼Œä¼šæ€ä¹ˆå¤„ç†ç°åœ¨çš„ç„¦è™‘ï¼Ÿ","æ­¤åˆ»çš„å®‰é™ï¼Œè®©ä½ æƒ³åˆ°äº† {Theme} çš„å“ªä¸€éƒ¨åˆ†ï¼Ÿ"]}},"en-US":{kickstart:{micro_action:["Turn off {distractions}, just {action} for 5 mins."],micro_story:["It's quiet right now. Just handle {one_thing}."]},focus:{micro_action:["Focus on {one_module} only."],reframe:["You don't need to finish it all, just push a bit."]},lighten:{witty:["Take a break."]},decompress:{permission:["It's okay to slow down."]},celebrate:{micro_story:["Done for the day."]},care:{gentle_question:["Are you okay?"]},sleep:{permission:["Go to sleep."]},weekend:{micro_story:["Enjoy the weekend."]}}};function _c(t,e,r="zh-CN"){const n=an[r]||an["zh-CN"],s=n[t]||n.focus;return s[e]||Object.values(s)[0]||["Write a short, human perspective line."]}function pi(t,e="zh-CN"){const n=(an[e]||an["zh-CN"]).custom_theme_content;return n?n[t]||n.interesting||["{Content}"]:["{Content}"]}const ot={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_GOOGLE_CLIENT_ID:"65772780936-6opn1jon0nthab7erht3i6pqgk3o0q1u.apps.googleusercontent.com",VITE_SILICONFLOW_API_KEY:"sk-wrzbqttakodzlnzkbsrtiudqdtoovshtonbtvswwhraigncv",VITE_SILICONFLOW_MODEL:"deepseek-ai/DeepSeek-V3",VITE_SUPABASE_ANON_KEY:"sb_publishable_NmAqx6bPjCKyu1BAAjhMVA_v2_JKJS2",VITE_SUPABASE_URL:"https://sudmwgwwlsdkpoxrnsji.supabase.co"};var He={};const kc=3;async function ss(t,e=0,r){var n,s,i,o;try{const a=(He==null?void 0:He.SILICONFLOW_API_KEY)||"sk-wrzbqttakodzlnzkbsrtiudqdtoovshtonbtvswwhraigncv",l=(He==null?void 0:He.ZHIPUAI_API_KEY)||(He==null?void 0:He.API_KEY)||(ot==null?void 0:ot.VITE_ZHIPUAI_API_KEY)||(ot==null?void 0:ot.VITE_GEMINI_API_KEY),u=a||l;let d="https://open.bigmodel.cn/api/paas/v4",g="glm-4-flash";const h=typeof chrome<"u"&&!!chrome.runtime&&!!chrome.runtime.id;a&&(h?d=(ot==null?void 0:ot.VITE_SILICONFLOW_API_BASE)||"https://api.siliconflow.cn/v1":d=(He==null?void 0:He.SILICONFLOW_API_BASE)||(ot==null?void 0:ot.VITE_SILICONFLOW_API_BASE)||"/api/siliconflow",g=(He==null?void 0:He.SILICONFLOW_MODEL)||"deepseek-ai/DeepSeek-V3",g.includes("deepseek")&&!g.includes("R1")&&(console.log("[StartlyTab] Optimizing model selection: Defaulting to Qwen 7B for speed."),g="Qwen/Qwen2.5-7B-Instruct"),console.log("[StartlyTab] Using SiliconFlow API:",g,h?"(Extension Direct)":"(Proxy)"));const p=gi(t);console.log("[Router] Generated Plan:",p);const v=Sc(p),b=Ec(t,p),m=await fetch(`${d}/chat/completions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},body:JSON.stringify({model:g,messages:[{role:"system",content:v},{role:"user",content:b}],temperature:.7,top_p:.95,max_tokens:100,stream:!!r})});if(!m.ok){const _=await m.text();return console.error("[ZhipuAI] API error:",m.status,_),{text:Fn(t.language),plan:p}}let x="";return r&&m.body||(x=((o=(i=(s=(n=(await m.json()).choices)==null?void 0:n[0])==null?void 0:s.message)==null?void 0:i.content)==null?void 0:o.trim())||""),x=Cc(x),!x||x.length===0?{text:Fn(t.language),plan:p}:bc(x,t.recent_history)&&e<kc?(console.log(`[ZhipuAI] Perspective too similar, retrying (attempt ${e+1})...`),ss(t,e+1)):{text:x,plan:p}}catch(a){return console.error("[ZhipuAI] Generation failed:",a),{text:Fn(t.language),plan:gi(t)}}}function Sc(t){const e=t.language==="zh-CN"||t.language==="zh-TW";let r;return t.topic_source==="custom"?(r=pi("interesting",t.language),(t.style==="witty"||t.style==="reframe"||t.style==="gentle_question")&&(r=pi(t.style,t.language))):r=_c(t.intent,t.style,t.language),e?`ä½ æ˜¯å¦å¬è¯´è¿‡"ç”Ÿæ´»è§†è§’(Perspective)"ï¼Ÿä½ ç°åœ¨çš„è§’è‰²å°±æ˜¯ç”Ÿæˆå®ƒçš„ä¸“å®¶ã€‚
ä»»åŠ¡ï¼šæ‰§è¡Œ Router è®¡åˆ’ã€‚
èº«ä»½ï¼šç”¨æˆ·çš„ã€å¯†å‹ã€‘ï¼Œè¯´è¯æåº¦æ¾å¼›ï¼Œæ‹’ç»è¯´æ•™ã€‚

æ‰§è¡Œè®¡åˆ’ï¼š
- æ„å›¾: ${t.intent}
- é£æ ¼: ${t.style}
- è¯é¢˜: ${t.topic_source} ${t.selected_theme?`(${t.selected_theme})`:""}
- é™å­—: ${t.max_length_chars}

å‚è€ƒè¯­æ„Ÿ (ä»…ä¾›å‚è€ƒè¯­æ°”ï¼Œä¸è¦ç›´æ¥å¥—ç”¨å¥å¼):
${r.map(n=>`- ${n}`).join(`
`)}

ç¡¬æ€§çº¦æŸ:
- ä»…è¾“å‡ºã€ä¸€å¥è¯ã€‘ç»“æœã€‚
- ä¸¥ç¦ Emojiã€Hashtagã€æ ‡è¯­ã€‚
- ä¸¥ç¦å‡ºç° "åŠ æ²¹"ã€"ç›¸ä¿¡è‡ªå·±"ã€"åšæŒ" ç­‰ç©ºæ´å£å·ã€‚
- åƒæœ‹å‹ä½è¯­ï¼Œè€Œä¸æ˜¯å¹¿å‘Šæ–‡æ¡ˆã€‚
- ä¸è¦è§£é‡Šï¼Œç›´æ¥ç»™ç»“æœã€‚`:`You are a Stylist for "Perspective" lines.
Task: Execute the Router Plan provided.
Identity: Close friend, relaxed tone, no preaching.

Execution Plan:
- Intent: ${t.intent}
- Style: ${t.style}
- Topic: ${t.topic_source} ${t.selected_theme?`(${t.selected_theme})`:""}
- Max Length: ${t.max_length_chars} chars

Vibe Reference (Use for TONE only, do not copy structure):
${r.map(n=>`- ${n}`).join(`
`)}

Strict Constraints:
- Output ONE line only.
- No emojis, hashtags, or slogans.
- No "Believe in yourself", "Keep going".
- Whisper like a friend, don't sell like an ad.
- No explanations.`}function Ec(t,e){const r=e.language==="zh-CN"||e.language==="zh-TW",n=t.recent_history.length>0?r?`è¿‘æœŸ(è¯·å®Œå…¨é¿å¼€è¿™äº›å¥å¼å’Œç”¨è¯): 
${t.recent_history.slice(0,3).map(i=>`- ${i.text}`).join(`
`)}`:`Avoid recent (Do not reuse structure/words): 
${t.recent_history.slice(0,3).map(i=>`- ${i.text}`).join(`
`)}`:"";if(r){const i=e.selected_theme?`ä¸»é¢˜: ${e.selected_theme}`:"ä¸»é¢˜: æ—¥å¸¸ç”Ÿæ´»è¯­å¢ƒ";return`Plan:
Intent: ${e.intent}
Style: ${e.style}
${i}
Forbidden:
- No "åŠ æ²¹" (Keep going), "ç›¸ä¿¡è‡ªå·±" (Believe in yourself)
- No "å¦‚æœ..." (If...), "è¯•è¯•..." (Try...), "æœ‰æ—¶å€™..." (Sometimes...)
- No "Suggestion/Advice" tone. Use "Observation/Statement" tone.
${n}

Generate:`}const s=e.selected_theme?`Theme: ${e.selected_theme}`:"Theme: Daily Life context";return`Plan:
Intent: ${e.intent}
Style: ${e.style}
${s}
Forbidden:
- No cliches ("Believe in yourself")
- No "If...", "Try...", "Sometimes..." starts.
- No Advice. Only Observations.
${n}

Generate:`}function Cc(t){return t.replace(/^["'ã€Œ](.*?)["'ã€]$/g,"$1").replace(/\[h\](.*?)\[\/h\]/g,"$1").replace(/#/g,"").replace(/[â– â–¡â–ˆâ—†â–²â–¼â—â—‹]/g,"").trim()}function Fn(t){const e=oi[t]||oi.English;return e[Math.floor(Math.random()*e.length)]}const nr="65772780936-6opn1jon0nthab7erht3i6pqgk3o0q1u.apps.googleusercontent.com",Rc=typeof chrome<"u"&&!!chrome.runtime&&!!chrome.runtime.id,yr=nr.includes("YOUR_GOOGLE_CLIENT_ID")||nr==="";typeof window<"u"&&(console.log("[Auth] ===== Google OAuth Configuration ====="),console.log("[Auth] Client ID loaded:","Yes"),console.log("[Auth] Client ID value:",`${nr.substring(0,20)}...`),console.log("[Auth] Full Client ID:",nr),console.log("[Auth] Is placeholder:",yr),console.log("[Auth] Current origin:",window.location.origin),console.log("[Auth] Environment:","production"),console.log("[Auth] All env vars:",{hasClientId:!0,hasSupabaseUrl:!0,hasSupabaseKey:!0}),console.log("[Auth] ======================================"));async function Tc(t){if(typeof window>"u")return;const e=localStorage.getItem("focus_tab_user");let r=!1,n=!1;if(e)try{const i=JSON.parse(e);t(i),r=!0,n=!0,console.log("[Auth] Restored user from localStorage:",i.email)}catch(i){console.error("[Auth] Auth restore failed",i)}const s=setInterval(()=>{var i,o;if((o=(i=window.google)==null?void 0:i.accounts)!=null&&o.id){clearInterval(s),console.log("[Auth] Google SDK loaded, initializing..."),console.log("[Auth] Using Client ID:",yr?"MOCK_ID (placeholder)":nr),console.log("[Auth] Has existing user:",r);const a=u=>{try{console.log("[Auth] Received credential response");const g=u.credential.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),h=JSON.parse(window.atob(g)),p={id:h.sub,email:h.email,name:h.name,picture:h.picture};console.log("[Auth] User authenticated:",p.email),localStorage.setItem("focus_tab_user",JSON.stringify(p)),t(p),n=!0}catch(d){console.error("[Auth] Auth parsing failed",d),t(null),n=!0}},l=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||/^((?!chrome|android).)*safari/i.test(navigator.vendor);try{const u={client_id:yr?"MOCK_ID":nr,callback:a,auto_select:!r,use_fedcm_for_prompt:!1};l&&console.log("[Auth] Safari detected, using Safari-optimized configuration"),window.google.accounts.id.initialize(u),console.log("[Auth] Google SDK initialized successfully"),!r&&!n&&(console.log("[Auth] No existing user found, auth check complete"),t(null),n=!0),!yr&&!r&&!l?(console.log("[Auth] No existing user, attempting One Tap prompt..."),window.google.accounts.id.prompt()):r?console.log("[Auth] User already logged in, skipping One Tap prompt"):l&&console.log("[Auth] Safari detected, skipping One Tap (will use button click instead)")}catch(u){console.error("[Auth] Failed to initialize Google SDK:",u),!r&&!n&&(t(null),n=!0)}}},300);setTimeout(()=>{clearInterval(s),n||(console.log("[Auth] Auth check timeout, no user found"),t(null),n=!0)},5e3)}function jc(){if(typeof window>"u")return!1;const t=window.navigator.userAgent.toLowerCase(),e=/safari/.test(t)&&!/chrome/.test(t)&&!/chromium/.test(t),r=/^((?!chrome|android).)*safari/i.test(window.navigator.userAgent);return e||r||/^((?!chrome|android).)*safari/i.test(window.navigator.vendor)}function Ac(t){var e,r;if(!(typeof window>"u")){if(yr){console.info("StartlyTab: Simulating login (No Client ID provided or Extension Mode)."),setTimeout(()=>{const n={id:"mock-"+Math.random().toString(36).substr(2,9),email:"dean.pro@startlytab.com",name:"Dean Extension",picture:""};localStorage.setItem("focus_tab_user",JSON.stringify(n)),t&&t(n)},600);return}if((r=(e=window.google)==null?void 0:e.accounts)!=null&&r.id)if(jc()){console.log("[Auth] Safari detected, triggering button click instead of prompt");const n=document.querySelector("#google-login-btn button");if(n)n.click();else{console.warn("[Auth] Google button not found, falling back to prompt");try{window.google.accounts.id.prompt()}catch(s){console.error("[Auth] Prompt failed in Safari:",s)}}}else window.google.accounts.id.prompt()}}function Nc(){if(localStorage.removeItem("focus_tab_user"),typeof window<"u"&&window.google)try{window.google.accounts.id.disableAutoSelect()}catch{}}async function Oc(t){const e=await fetch("https://www.googleapis.com/oauth2/v3/userinfo",{headers:{Authorization:`Bearer ${t}`}});if(!e.ok)throw new Error("Failed to fetch user info");const r=await e.json();return{id:r.sub,email:r.email,name:r.name,picture:r.picture}}async function Ic(t){return new Promise((e,r)=>{if(!(chrome!=null&&chrome.identity)){console.warn("Chrome Identity API not available. Starting Demo Mode.");const s={id:"mock-"+Math.random().toString(36).substr(2,9),email:"dean.demo@startlytab.com",name:"Dean Demo (Offline)",picture:""};localStorage.setItem("focus_tab_user",JSON.stringify(s)),t(s),e();return}const n=chrome.runtime.id;console.log("[Auth] Starting Chrome Identity flow. Current Extension ID:",n),chrome.identity.getAuthToken({interactive:!0},async s=>{var i;if(chrome.runtime.lastError||!s){const o=((i=chrome.runtime.lastError)==null?void 0:i.message)||"Unknown error";console.error("Chrome Identity Error:",o),console.error("Please ensure your Extension ID matches the one in Google Cloud Console."),console.error("Current ID:",n);const a={id:"demo-"+Math.random().toString(36).substr(2,9),email:"user@example.com",name:"Demo User (Auth Failed)",picture:""};localStorage.setItem("focus_tab_user",JSON.stringify(a)),t(a),e();return}try{const o=await Oc(s);localStorage.setItem("focus_tab_user",JSON.stringify(o)),t(o),e()}catch(o){console.error("Failed to get user info:",o),r(o)}})})}function _n(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(t);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(t,n[s])&&(r[n[s]]=t[n[s]]);return r}function Pc(t,e,r,n){function s(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function a(d){try{u(n.next(d))}catch(g){o(g)}}function l(d){try{u(n.throw(d))}catch(g){o(g)}}function u(d){d.done?i(d.value):s(d.value).then(a,l)}u((n=n.apply(t,e||[])).next())})}const Lc=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class Ns extends Error{constructor(e,r="FunctionsError",n){super(e),this.name=r,this.context=n}}class Dc extends Ns{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class mi extends Ns{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class bi extends Ns{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var is;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(is||(is={}));class $c{constructor(e,{headers:r={},customFetch:n,region:s=is.Any}={}){this.url=e,this.headers=r,this.region=s,this.fetch=Lc(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return Pc(this,arguments,void 0,function*(r,n={}){var s;let i,o;try{const{headers:a,method:l,body:u,signal:d,timeout:g}=n;let h={},{region:p}=n;p||(p=this.region);const v=new URL(`${this.url}/${r}`);p&&p!=="any"&&(h["x-region"]=p,v.searchParams.set("forceFunctionRegion",p));let b;u&&(a&&!Object.prototype.hasOwnProperty.call(a,"Content-Type")||!a)?typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",b=u):typeof u=="string"?(h["Content-Type"]="text/plain",b=u):typeof FormData<"u"&&u instanceof FormData?b=u:(h["Content-Type"]="application/json",b=JSON.stringify(u)):u&&typeof u!="string"&&!(typeof Blob<"u"&&u instanceof Blob)&&!(u instanceof ArrayBuffer)&&!(typeof FormData<"u"&&u instanceof FormData)?b=JSON.stringify(u):b=u;let m=d;g&&(o=new AbortController,i=setTimeout(()=>o.abort(),g),d?(m=o.signal,d.addEventListener("abort",()=>o.abort())):m=o.signal);const x=yield this.fetch(v.toString(),{method:l||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),a),body:b,signal:m}).catch(P=>{throw new Dc(P)}),_=x.headers.get("x-relay-error");if(_&&_==="true")throw new mi(x);if(!x.ok)throw new bi(x);let w=((s=x.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),C;return w==="application/json"?C=yield x.json():w==="application/octet-stream"||w==="application/pdf"?C=yield x.blob():w==="text/event-stream"?C=x:w==="multipart/form-data"?C=yield x.formData():C=yield x.text(),{data:C,error:null,response:x}}catch(a){return{data:null,error:a,response:a instanceof bi||a instanceof mi?a.context:void 0}}finally{i&&clearTimeout(i)}})}}var Uc=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}},Mc=class{constructor(t){var e,r;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(e=t.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=t.signal,this.isMaybeSingle=(r=t.isMaybeSingle)!==null&&r!==void 0?r:!1,t.fetch?this.fetch=t.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=new Headers(this.headers),this.headers.set(t,e),this}then(t,e){var r=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const n=this.fetch;let s=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{let o=null,a=null,l=null,u=i.status,d=i.statusText;if(i.ok){var g,h;if(r.method!=="HEAD"){var p;const x=await i.text();x===""||(r.headers.get("Accept")==="text/csv"||r.headers.get("Accept")&&(!((p=r.headers.get("Accept"))===null||p===void 0)&&p.includes("application/vnd.pgrst.plan+text"))?a=x:a=JSON.parse(x))}const b=(g=r.headers.get("Prefer"))===null||g===void 0?void 0:g.match(/count=(exact|planned|estimated)/),m=(h=i.headers.get("content-range"))===null||h===void 0?void 0:h.split("/");b&&m&&m.length>1&&(l=parseInt(m[1])),r.isMaybeSingle&&r.method==="GET"&&Array.isArray(a)&&(a.length>1?(o={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,l=null,u=406,d="Not Acceptable"):a.length===1?a=a[0]:a=null)}else{var v;const b=await i.text();try{o=JSON.parse(b),Array.isArray(o)&&i.status===404&&(a=[],o=null,u=200,d="OK")}catch{i.status===404&&b===""?(u=204,d="No Content"):o={message:b}}if(o&&r.isMaybeSingle&&(!(o==null||(v=o.details)===null||v===void 0)&&v.includes("0 rows"))&&(o=null,u=200,d="OK"),o&&r.shouldThrowOnError)throw new Uc(o)}return{error:o,data:a,count:l,status:u,statusText:d}});return this.shouldThrowOnError||(s=s.catch(i=>{var o;let a="";const l=i==null?void 0:i.cause;if(l){var u,d,g,h;const v=(u=l==null?void 0:l.message)!==null&&u!==void 0?u:"",b=(d=l==null?void 0:l.code)!==null&&d!==void 0?d:"";a=`${(g=i==null?void 0:i.name)!==null&&g!==void 0?g:"FetchError"}: ${i==null?void 0:i.message}`,a+=`

Caused by: ${(h=l==null?void 0:l.name)!==null&&h!==void 0?h:"Error"}: ${v}`,b&&(a+=` (${b})`),l!=null&&l.stack&&(a+=`
${l.stack}`)}else{var p;a=(p=i==null?void 0:i.stack)!==null&&p!==void 0?p:""}return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:a,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),s.then(t,e)}returns(){return this}overrideTypes(){return this}},Fc=class extends Mc{select(t){let e=!1;const r=(t??"*").split("").map(n=>/\s/.test(n)&&!e?"":(n==='"'&&(e=!e),n)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:e=!0,nullsFirst:r,foreignTable:n,referencedTable:s=n}={}){const i=s?`${s}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${t}.${e?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:r=e}={}){const n=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${t}`),this}range(t,e,{foreignTable:r,referencedTable:n=r}={}){const s=typeof n>"u"?"offset":`${n}.offset`,i=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(s,`${t}`),this.url.searchParams.set(i,`${e-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:e=!1,settings:r=!1,buffers:n=!1,wal:s=!1,format:i="text"}={}){var o;const a=[t?"analyze":null,e?"verbose":null,r?"settings":null,n?"buffers":null,s?"wal":null].filter(Boolean).join("|"),l=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${l}"; options=${a};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};const yi=new RegExp("[,()]");var Yt=class extends Fc{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}regexMatch(t,e){return this.url.searchParams.append(t,`match.${e}`),this}regexIMatch(t,e){return this.url.searchParams.append(t,`imatch.${e}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}isDistinct(t,e){return this.url.searchParams.append(t,`isdistinct.${e}`),this}in(t,e){const r=Array.from(new Set(e)).map(n=>typeof n=="string"&&yi.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(t,`in.(${r})`),this}notIn(t,e){const r=Array.from(new Set(e)).map(n=>typeof n=="string"&&yi.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(t,`not.in.(${r})`),this}contains(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return typeof e=="string"?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:r,type:n}={}){let s="";n==="plain"?s="pl":n==="phrase"?s="ph":n==="websearch"&&(s="w");const i=r===void 0?"":`(${r})`;return this.url.searchParams.append(t,`${s}fts${i}.${e}`),this}match(t){return Object.entries(t).forEach(([e,r])=>{this.url.searchParams.append(e,`eq.${r}`)}),this}not(t,e,r){return this.url.searchParams.append(t,`not.${e}.${r}`),this}or(t,{foreignTable:e,referencedTable:r=e}={}){const n=r?`${r}.or`:"or";return this.url.searchParams.append(n,`(${t})`),this}filter(t,e,r){return this.url.searchParams.append(t,`${e}.${r}`),this}},Bc=class{constructor(t,{headers:e={},schema:r,fetch:n}){this.url=t,this.headers=new Headers(e),this.schema=r,this.fetch=n}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(t,e){const{head:r=!1,count:n}=e??{},s=r?"HEAD":"GET";let i=!1;const o=(t??"*").split("").map(u=>/\s/.test(u)&&!i?"":(u==='"'&&(i=!i),u)).join(""),{url:a,headers:l}=this.cloneRequestState();return a.searchParams.set("select",o),n&&l.append("Prefer",`count=${n}`),new Yt({method:s,url:a,headers:l,schema:this.schema,fetch:this.fetch})}insert(t,{count:e,defaultToNull:r=!0}={}){var n;const s="POST",{url:i,headers:o}=this.cloneRequestState();if(e&&o.append("Prefer",`count=${e}`),r||o.append("Prefer","missing=default"),Array.isArray(t)){const a=t.reduce((l,u)=>l.concat(Object.keys(u)),[]);if(a.length>0){const l=[...new Set(a)].map(u=>`"${u}"`);i.searchParams.set("columns",l.join(","))}}return new Yt({method:s,url:i,headers:o,schema:this.schema,body:t,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}upsert(t,{onConflict:e,ignoreDuplicates:r=!1,count:n,defaultToNull:s=!0}={}){var i;const o="POST",{url:a,headers:l}=this.cloneRequestState();if(l.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),e!==void 0&&a.searchParams.set("on_conflict",e),n&&l.append("Prefer",`count=${n}`),s||l.append("Prefer","missing=default"),Array.isArray(t)){const u=t.reduce((d,g)=>d.concat(Object.keys(g)),[]);if(u.length>0){const d=[...new Set(u)].map(g=>`"${g}"`);a.searchParams.set("columns",d.join(","))}}return new Yt({method:o,url:a,headers:l,schema:this.schema,body:t,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}update(t,{count:e}={}){var r;const n="PATCH",{url:s,headers:i}=this.cloneRequestState();return e&&i.append("Prefer",`count=${e}`),new Yt({method:n,url:s,headers:i,schema:this.schema,body:t,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}delete({count:t}={}){var e;const r="DELETE",{url:n,headers:s}=this.cloneRequestState();return t&&s.append("Prefer",`count=${t}`),new Yt({method:r,url:n,headers:s,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch})}},qc=class Ao{constructor(e,{headers:r={},schema:n,fetch:s}={}){this.url=e,this.headers=new Headers(r),this.schemaName=n,this.fetch=s}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new Bc(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Ao(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,r={},{head:n=!1,get:s=!1,count:i}={}){var o;let a;const l=new URL(`${this.url}/rpc/${e}`);let u;const d=p=>p!==null&&typeof p=="object"&&(!Array.isArray(p)||p.some(d)),g=n&&Object.values(r).some(d);g?(a="POST",u=r):n||s?(a=n?"HEAD":"GET",Object.entries(r).filter(([p,v])=>v!==void 0).map(([p,v])=>[p,Array.isArray(v)?`{${v.join(",")}}`:`${v}`]).forEach(([p,v])=>{l.searchParams.append(p,v)})):(a="POST",u=r);const h=new Headers(this.headers);return g?h.set("Prefer",i?`count=${i},return=minimal`:"return=minimal"):i&&h.set("Prefer",`count=${i}`),new Yt({method:a,url:l,headers:h,schema:this.schemaName,body:u,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}};class zc{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const r=globalThis.process;if(r){const n=r.versions;if(n&&n.node){const s=n.node,i=parseInt(s.replace(/^v/,"").split(".")[0]);return i>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${i} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${i} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let r=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(r+=`

Suggested solution: ${e.workaround}`),new Error(r)}static createWebSocket(e,r){const n=this.getWebSocketConstructor();return new n(e,r)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const Wc="2.90.1",Gc=`realtime-js/${Wc}`,No="1.0.0",Hc="2.0.0",wi=No,os=1e4,Kc=1e3,Vc=100;var jt;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(jt||(jt={}));var Oe;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Oe||(Oe={}));var gt;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(gt||(gt={}));var as;(function(t){t.websocket="websocket"})(as||(as={}));var Ut;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(Ut||(Ut={}));class Jc{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,r){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return r(this._binaryEncodeUserBroadcastPush(e));let n=[e.join_ref,e.ref,e.topic,e.event,e.payload];return r(JSON.stringify(n))}_binaryEncodeUserBroadcastPush(e){var r;return this._isArrayBuffer((r=e.payload)===null||r===void 0?void 0:r.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var r,n;const s=(n=(r=e.payload)===null||r===void 0?void 0:r.payload)!==null&&n!==void 0?n:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,s)}_encodeJsonUserBroadcastPush(e){var r,n;const s=(n=(r=e.payload)===null||r===void 0?void 0:r.payload)!==null&&n!==void 0?n:{},o=new TextEncoder().encode(JSON.stringify(s)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(e,r,n){var s,i;const o=e.topic,a=(s=e.ref)!==null&&s!==void 0?s:"",l=(i=e.join_ref)!==null&&i!==void 0?i:"",u=e.payload.event,d=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},g=Object.keys(d).length===0?"":JSON.stringify(d);if(l.length>255)throw new Error(`joinRef length ${l.length} exceeds maximum of 255`);if(a.length>255)throw new Error(`ref length ${a.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`userEvent length ${u.length} exceeds maximum of 255`);if(g.length>255)throw new Error(`metadata length ${g.length} exceeds maximum of 255`);const h=this.USER_BROADCAST_PUSH_META_LENGTH+l.length+a.length+o.length+u.length+g.length,p=new ArrayBuffer(this.HEADER_LENGTH+h);let v=new DataView(p),b=0;v.setUint8(b++,this.KINDS.userBroadcastPush),v.setUint8(b++,l.length),v.setUint8(b++,a.length),v.setUint8(b++,o.length),v.setUint8(b++,u.length),v.setUint8(b++,g.length),v.setUint8(b++,r),Array.from(l,x=>v.setUint8(b++,x.charCodeAt(0))),Array.from(a,x=>v.setUint8(b++,x.charCodeAt(0))),Array.from(o,x=>v.setUint8(b++,x.charCodeAt(0))),Array.from(u,x=>v.setUint8(b++,x.charCodeAt(0))),Array.from(g,x=>v.setUint8(b++,x.charCodeAt(0)));var m=new Uint8Array(p.byteLength+n.byteLength);return m.set(new Uint8Array(p),0),m.set(new Uint8Array(n),p.byteLength),m.buffer}decode(e,r){if(this._isArrayBuffer(e)){let n=this._binaryDecode(e);return r(n)}if(typeof e=="string"){const n=JSON.parse(e),[s,i,o,a,l]=n;return r({join_ref:s,ref:i,topic:o,event:a,payload:l})}return r({})}_binaryDecode(e){const r=new DataView(e),n=r.getUint8(0),s=new TextDecoder;switch(n){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,r,s)}}_decodeUserBroadcast(e,r,n){const s=r.getUint8(1),i=r.getUint8(2),o=r.getUint8(3),a=r.getUint8(4);let l=this.HEADER_LENGTH+4;const u=n.decode(e.slice(l,l+s));l=l+s;const d=n.decode(e.slice(l,l+i));l=l+i;const g=n.decode(e.slice(l,l+o));l=l+o;const h=e.slice(l,e.byteLength),p=a===this.JSON_ENCODING?JSON.parse(n.decode(h)):h,v={type:this.BROADCAST_EVENT,event:d,payload:p};return o>0&&(v.meta=JSON.parse(g)),{join_ref:null,ref:null,topic:u,event:this.BROADCAST_EVENT,payload:v}}_isArrayBuffer(e){var r;return e instanceof ArrayBuffer||((r=e==null?void 0:e.constructor)===null||r===void 0?void 0:r.name)==="ArrayBuffer"}_pick(e,r){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([n])=>r.includes(n)))}}class Oo{constructor(e,r){this.callback=e,this.timerCalc=r,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=r}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var we;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(we||(we={}));const vi=(t,e,r={})=>{var n;const s=(n=r.skipTypes)!==null&&n!==void 0?n:[];return e?Object.keys(e).reduce((i,o)=>(i[o]=Yc(o,t,e,s),i),{}):{}},Yc=(t,e,r,n)=>{const s=e.find(a=>a.name===t),i=s==null?void 0:s.type,o=r[t];return i&&!n.includes(i)?Io(i,o):ls(o)},Io=(t,e)=>{if(t.charAt(0)==="_"){const r=t.slice(1,t.length);return eu(e,r)}switch(t){case we.bool:return Xc(e);case we.float4:case we.float8:case we.int2:case we.int4:case we.int8:case we.numeric:case we.oid:return Qc(e);case we.json:case we.jsonb:return Zc(e);case we.timestamp:return tu(e);case we.abstime:case we.date:case we.daterange:case we.int4range:case we.int8range:case we.money:case we.reltime:case we.text:case we.time:case we.timestamptz:case we.timetz:case we.tsrange:case we.tstzrange:return ls(e);default:return ls(e)}},ls=t=>t,Xc=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},Qc=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},Zc=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t},eu=(t,e)=>{if(typeof t!="string")return t;const r=t.length-1,n=t[r];if(t[0]==="{"&&n==="}"){let i;const o=t.slice(1,r);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(a=>Io(e,a))}return t},tu=t=>typeof t=="string"?t.replace(" ","T"):t,Po=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class Bn{constructor(e,r,n={},s=os){this.channel=e,this.event=r,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,r){var n;return this._hasReceived(e)&&r((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:r}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=r=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=r,this._matchReceive(r)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,r){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:r})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:r}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(r))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var xi;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(xi||(xi={}));class wr{constructor(e,r){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(r==null?void 0:r.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=wr.syncState(this.state,s,i,o),this.pendingDiffs.forEach(l=>{this.state=wr.syncDiff(this.state,l,i,o)}),this.pendingDiffs=[],a()}),this.channel._on(n.diff,{},s=>{const{onJoin:i,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=wr.syncDiff(this.state,s,i,o),a())}),this.onJoin((s,i,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:o})}),this.onLeave((s,i,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,r,n,s){const i=this.cloneDeep(e),o=this.transformState(r),a={},l={};return this.map(i,(u,d)=>{o[u]||(l[u]=d)}),this.map(o,(u,d)=>{const g=i[u];if(g){const h=d.map(m=>m.presence_ref),p=g.map(m=>m.presence_ref),v=d.filter(m=>p.indexOf(m.presence_ref)<0),b=g.filter(m=>h.indexOf(m.presence_ref)<0);v.length>0&&(a[u]=v),b.length>0&&(l[u]=b)}else a[u]=d}),this.syncDiff(i,{joins:a,leaves:l},n,s)}static syncDiff(e,r,n,s){const{joins:i,leaves:o}={joins:this.transformState(r.joins),leaves:this.transformState(r.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(i,(a,l)=>{var u;const d=(u=e[a])!==null&&u!==void 0?u:[];if(e[a]=this.cloneDeep(l),d.length>0){const g=e[a].map(p=>p.presence_ref),h=d.filter(p=>g.indexOf(p.presence_ref)<0);e[a].unshift(...h)}n(a,d,l)}),this.map(o,(a,l)=>{let u=e[a];if(!u)return;const d=l.map(g=>g.presence_ref);u=u.filter(g=>d.indexOf(g.presence_ref)<0),e[a]=u,s(a,u,l),u.length===0&&delete e[a]}),e}static map(e,r){return Object.getOwnPropertyNames(e).map(n=>r(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((r,n)=>{const s=e[n];return"metas"in s?r[n]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):r[n]=s,r},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var _i;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(_i||(_i={}));var vr;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(vr||(vr={}));var wt;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(wt||(wt={}));class er{constructor(e,r={config:{}},n){var s,i;if(this.topic=e,this.params=r,this.socket=n,this.bindings={},this.state=Oe.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},r.config),this.timeout=this.socket.timeout,this.joinPush=new Bn(this,gt.join,this.params,this.timeout),this.rejoinTimer=new Oo(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Oe.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Oe.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Oe.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Oe.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Oe.errored,this.rejoinTimer.scheduleTimeout())}),this._on(gt.reply,{},(o,a)=>{this._trigger(this._replyEventName(a),o)}),this.presence=new wr(this),this.broadcastEndpointURL=Po(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,r=this.timeout){var n,s,i;if(this.socket.isConnected()||this.socket.connect(),this.state==Oe.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,u=(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(p=>p.filter))!==null&&s!==void 0?s:[],d=!!this.bindings[vr.PRESENCE]&&this.bindings[vr.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,g={},h={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:d}),postgres_changes:u,private:l};this.socket.accessTokenValue&&(g.access_token=this.socket.accessTokenValue),this._onError(p=>e==null?void 0:e(wt.CHANNEL_ERROR,p)),this._onClose(()=>e==null?void 0:e(wt.CLOSED)),this.updateJoinPayload(Object.assign({config:h},g)),this.joinedOnce=!0,this._rejoin(r),this.joinPush.receive("ok",async({postgres_changes:p})=>{var v;if(this.socket._isManualToken()||this.socket.setAuth(),p===void 0){e==null||e(wt.SUBSCRIBED);return}else{const b=this.bindings.postgres_changes,m=(v=b==null?void 0:b.length)!==null&&v!==void 0?v:0,x=[];for(let _=0;_<m;_++){const w=b[_],{filter:{event:C,schema:P,table:k,filter:E}}=w,A=p&&p[_];if(A&&A.event===C&&er.isFilterValueEqual(A.schema,P)&&er.isFilterValueEqual(A.table,k)&&er.isFilterValueEqual(A.filter,E))x.push(Object.assign(Object.assign({},w),{id:A.id}));else{this.unsubscribe(),this.state=Oe.errored,e==null||e(wt.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=x,e&&e(wt.SUBSCRIBED);return}}).receive("error",p=>{this.state=Oe.errored,e==null||e(wt.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(p).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(wt.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,r={}){return await this.send({type:"presence",event:"track",payload:e},r.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,r,n){return this.state===Oe.joined&&e===vr.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,r,n)}async httpSend(e,r,n={}){var s;if(r==null)return Promise.reject("Payload is required for httpSend()");const i={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(i.Authorization=`Bearer ${this.socket.accessTokenValue}`);const o={method:"POST",headers:i,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:r,private:this.private}]})},a=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(s=n.timeout)!==null&&s!==void 0?s:this.timeout);if(a.status===202)return{success:!0};let l=a.statusText;try{const u=await a.json();l=u.error||u.message||l}catch{}return Promise.reject(new Error(l))}async send(e,r={}){var n,s;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:o}=e,a={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(a.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:a,body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(n=r.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=u.body)===null||s===void 0?void 0:s.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,a,l;const u=this._push(e.type,e,r.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Oe.leaving;const r=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(gt.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(s=>{n=new Bn(this,gt.leave,{},e),n.receive("ok",()=>{r(),s("ok")}).receive("timeout",()=>{r(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Oe.closed,this.bindings={}}async _fetchWithTimeout(e,r,n){const s=new AbortController,i=setTimeout(()=>s.abort(),n),o=await this.socket.fetch(e,Object.assign(Object.assign({},r),{signal:s.signal}));return clearTimeout(i),o}_push(e,r,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Bn(this,e,r,n);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>Vc){const r=this.pushBuffer.shift();r&&(r.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${r.event}`,r.payload))}}_onMessage(e,r,n){return r}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,r,n){var s,i;const o=e.toLocaleLowerCase(),{close:a,error:l,leave:u,join:d}=gt;if(n&&[a,l,u,d].indexOf(o)>=0&&n!==this._joinRef())return;let h=this._onMessage(o,r,n);if(r&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(p=>{var v,b,m;return((v=p.filter)===null||v===void 0?void 0:v.event)==="*"||((m=(b=p.filter)===null||b===void 0?void 0:b.event)===null||m===void 0?void 0:m.toLocaleLowerCase())===o}).map(p=>p.callback(h,n)):(i=this.bindings[o])===null||i===void 0||i.filter(p=>{var v,b,m,x,_,w,C,P;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){const k=p.id,E=(v=p.filter)===null||v===void 0?void 0:v.event;return k&&((b=r.ids)===null||b===void 0?void 0:b.includes(k))&&(E==="*"||(E==null?void 0:E.toLocaleLowerCase())===((m=r.data)===null||m===void 0?void 0:m.type.toLocaleLowerCase()))&&(!(!((x=p.filter)===null||x===void 0)&&x.table)||p.filter.table===((_=r.data)===null||_===void 0?void 0:_.table))}else{const k=(C=(w=p==null?void 0:p.filter)===null||w===void 0?void 0:w.event)===null||C===void 0?void 0:C.toLocaleLowerCase();return k==="*"||k===((P=r==null?void 0:r.event)===null||P===void 0?void 0:P.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof h=="object"&&"ids"in h){const v=h.data,{schema:b,table:m,commit_timestamp:x,type:_,errors:w}=v;h=Object.assign(Object.assign({},{schema:b,table:m,commit_timestamp:x,eventType:_,new:{},old:{},errors:w}),this._getPayloadRecords(v))}p.callback(h,n)})}_isClosed(){return this.state===Oe.closed}_isJoined(){return this.state===Oe.joined}_isJoining(){return this.state===Oe.joining}_isLeaving(){return this.state===Oe.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,r,n){const s=e.toLocaleLowerCase(),i={type:s,filter:r,callback:n};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,r){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===n&&er.isEqual(s.filter,r))})),this}static isEqual(e,r){if(Object.keys(e).length!==Object.keys(r).length)return!1;for(const n in e)if(e[n]!==r[n])return!1;return!0}static isFilterValueEqual(e,r){return(e??void 0)===(r??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(gt.close,{},e)}_onError(e){this._on(gt.error,{},r=>e(r))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Oe.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const r={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(r.new=vi(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(r.old=vi(e.columns,e.old_record)),r}}const qn=()=>{},Hr={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},ru=[1e3,2e3,5e3,1e4],nu=1e4,su=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class iu{constructor(e,r){var n;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=os,this.transport=null,this.heartbeatIntervalMs=Hr.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=qn,this.ref=0,this.reconnectTimer=null,this.vsn=wi,this.logger=qn,this.conn=null,this.sendBuffer=[],this.serializer=new Jc,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=s=>s?(...i)=>s(...i):(...i)=>fetch(...i),!(!((n=r==null?void 0:r.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=r.params.apikey,this.endPoint=`${e}/${as.websocket}`,this.httpEndpoint=Po(e),this._initializeOptions(r),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(r==null?void 0:r.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=zc.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const r=e.message;throw r.includes("Node.js")?new Error(`${r}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${r}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,r){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,r??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const r=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),r}async removeAllChannels(){const e=await Promise.all(this.channels.map(r=>r.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,r,n){this.logger(e,r,n)}connectionState(){switch(this.conn&&this.conn.readyState){case jt.connecting:return Ut.Connecting;case jt.open:return Ut.Open;case jt.closing:return Ut.Closing;default:return Ut.Closed}}isConnected(){return this.connectionState()===Ut.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,r={config:{}}){const n=`realtime:${e}`,s=this.getChannels().find(i=>i.topic===n);if(s)return s;{const i=new er(`realtime:${e}`,r,this);return this.channels.push(i),i}}push(e){const{topic:r,event:n,payload:s,ref:i}=e,o=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${r} ${n} (${i})`,s),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(r){this.log("error","error in heartbeat callback",r)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(r){this.log("error","error in heartbeat callback",r)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(Kc,"heartbeat timeout"),setTimeout(()=>{var r;this.isConnected()||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout()},Hr.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(r){this.log("error","error in heartbeat callback",r)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let r=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));r&&(this.log("transport",`leaving duplicate topic "${e}"`),r.unsubscribe())}_remove(e){this.channels=this.channels.filter(r=>r.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,r=>{if(r.topic==="phoenix"&&r.event==="phx_reply"&&r.ref&&r.ref===this.pendingHeartbeatRef){const u=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(r.payload.status==="ok"?"ok":"error",u)}catch(d){this.log("error","error in heartbeat callback",d)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:n,event:s,payload:i,ref:o}=r,a=o?`(${o})`:"",l=i.status||"";this.log("receive",`${l} ${n} ${s} ${a}`.trim(),i),this.channels.filter(u=>u._isMember(n)).forEach(u=>u._trigger(s,i,o)),this._triggerStateCallbacks("message",r)})}_clearTimer(e){var r;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((r=this.reconnectTimer)===null||r===void 0||r.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===jt.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===jt.open||this.conn.readyState===jt.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(r=>{this.log("error","error waiting for auth on connect",r),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=r=>{this.log("worker","worker error",r.message),this._terminateWorker()},this.workerRef.onmessage=r=>{r.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var r;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(r=this.reconnectTimer)===null||r===void 0||r.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(gt.error))}_appendParams(e,r){if(Object.keys(r).length===0)return e;const n=e.match(/\?/)?"&":"?",s=new URLSearchParams(r);return`${e}${n}${s}`}_workerObjectUrl(e){let r;if(e)r=e;else{const n=new Blob([su],{type:"application/javascript"});r=URL.createObjectURL(n)}return r}_setConnectionState(e,r=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=r)}async _performAuth(e=null){let r,n=!1;if(e)r=e,n=!0;else if(this.accessToken)try{r=await this.accessToken()}catch(s){this.log("error","Error fetching access token from callback",s),r=this.accessTokenValue}else r=this.accessTokenValue;n?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=r&&(this.accessTokenValue=r,this.channels.forEach(s=>{const i={access_token:r,version:Gc};r&&s.updateJoinPayload(i),s.joinedOnce&&s._isJoined()&&s._push(gt.access_token,{access_token:r})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(r=>{this.log("error",`Error setting auth in ${e}`,r)})}_triggerStateCallbacks(e,r){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(r)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(n){this.log("error",`error triggering ${e} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new Oo(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Hr.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var r,n,s,i,o,a,l,u,d,g,h,p;switch(this.transport=(r=e==null?void 0:e.transport)!==null&&r!==void 0?r:null,this.timeout=(n=e==null?void 0:e.timeout)!==null&&n!==void 0?n:os,this.heartbeatIntervalMs=(s=e==null?void 0:e.heartbeatIntervalMs)!==null&&s!==void 0?s:Hr.HEARTBEAT_INTERVAL,this.worker=(i=e==null?void 0:e.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(a=e==null?void 0:e.heartbeatCallback)!==null&&a!==void 0?a:qn,this.vsn=(l=e==null?void 0:e.vsn)!==null&&l!==void 0?l:wi,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(u=e==null?void 0:e.reconnectAfterMs)!==null&&u!==void 0?u:(v=>ru[v-1]||nu),this.vsn){case No:this.encode=(d=e==null?void 0:e.encode)!==null&&d!==void 0?d:((v,b)=>b(JSON.stringify(v))),this.decode=(g=e==null?void 0:e.decode)!==null&&g!==void 0?g:((v,b)=>b(JSON.parse(v)));break;case Hc:this.encode=(h=e==null?void 0:e.encode)!==null&&h!==void 0?h:this.serializer.encode.bind(this.serializer),this.decode=(p=e==null?void 0:e.decode)!==null&&p!==void 0?p:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}var Rr=class extends Error{constructor(t,e){var r;super(t),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&((r=e.icebergType)==null?void 0:r.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function ou(t,e,r){const n=new URL(e,t);if(r)for(const[s,i]of Object.entries(r))i!==void 0&&n.searchParams.set(s,i);return n.toString()}async function au(t){return!t||t.type==="none"?{}:t.type==="bearer"?{Authorization:`Bearer ${t.token}`}:t.type==="header"?{[t.name]:t.value}:t.type==="custom"?await t.getHeaders():{}}function lu(t){const e=t.fetchImpl??globalThis.fetch;return{async request({method:r,path:n,query:s,body:i,headers:o}){const a=ou(t.baseUrl,n,s),l=await au(t.auth),u=await e(a,{method:r,headers:{...i?{"Content-Type":"application/json"}:{},...l,...o},body:i?JSON.stringify(i):void 0}),d=await u.text(),g=(u.headers.get("content-type")||"").includes("application/json"),h=g&&d?JSON.parse(d):d;if(!u.ok){const p=g?h:void 0,v=p==null?void 0:p.error;throw new Rr((v==null?void 0:v.message)??`Request failed with status ${u.status}`,{status:u.status,icebergType:v==null?void 0:v.type,icebergCode:v==null?void 0:v.code,details:p})}return{status:u.status,headers:u.headers,data:h}}}}function Kr(t){return t.join("")}var cu=class{constructor(t,e=""){this.client=t,this.prefix=e}async listNamespaces(t){const e=t?{parent:Kr(t.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(n=>({namespace:n}))}async createNamespace(t,e){const r={namespace:t.namespace,properties:e==null?void 0:e.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:r})).data}async dropNamespace(t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Kr(t.namespace)}`})}async loadNamespaceMetadata(t){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Kr(t.namespace)}`})).data.properties}}async namespaceExists(t){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Kr(t.namespace)}`}),!0}catch(e){if(e instanceof Rr&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(t,e){try{return await this.createNamespace(t,e)}catch(r){if(r instanceof Rr&&r.status===409)return;throw r}}};function zt(t){return t.join("")}var uu=class{constructor(t,e="",r){this.client=t,this.prefix=e,this.accessDelegation=r}async listTables(t){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${zt(t.namespace)}/tables`})).data.identifiers}async createTable(t,e){const r={};return this.accessDelegation&&(r["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${zt(t.namespace)}/tables`,body:e,headers:r})).data.metadata}async updateTable(t,e){const r=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${zt(t.namespace)}/tables/${t.name}`,body:e});return{"metadata-location":r.data["metadata-location"],metadata:r.data.metadata}}async dropTable(t,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${zt(t.namespace)}/tables/${t.name}`,query:{purgeRequested:String((e==null?void 0:e.purge)??!1)}})}async loadTable(t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${zt(t.namespace)}/tables/${t.name}`,headers:e})).data.metadata}async tableExists(t){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${zt(t.namespace)}/tables/${t.name}`,headers:e}),!0}catch(r){if(r instanceof Rr&&r.status===404)return!1;throw r}}async createTableIfNotExists(t,e){try{return await this.createTable(t,e)}catch(r){if(r instanceof Rr&&r.status===409)return await this.loadTable({namespace:t.namespace,name:e.name});throw r}}},du=class{constructor(t){var n;let e="v1";t.catalogName&&(e+=`/${t.catalogName}`);const r=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`;this.client=lu({baseUrl:r,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=(n=t.accessDelegation)==null?void 0:n.join(","),this.namespaceOps=new cu(this.client,e),this.tableOps=new uu(this.client,e,this.accessDelegation)}async listNamespaces(t){return this.namespaceOps.listNamespaces(t)}async createNamespace(t,e){return this.namespaceOps.createNamespace(t,e)}async dropNamespace(t){await this.namespaceOps.dropNamespace(t)}async loadNamespaceMetadata(t){return this.namespaceOps.loadNamespaceMetadata(t)}async listTables(t){return this.tableOps.listTables(t)}async createTable(t,e){return this.tableOps.createTable(t,e)}async updateTable(t,e){return this.tableOps.updateTable(t,e)}async dropTable(t,e){await this.tableOps.dropTable(t,e)}async loadTable(t){return this.tableOps.loadTable(t)}async namespaceExists(t){return this.namespaceOps.namespaceExists(t)}async tableExists(t){return this.tableOps.tableExists(t)}async createNamespaceIfNotExists(t,e){return this.namespaceOps.createNamespaceIfNotExists(t,e)}async createTableIfNotExists(t,e){return this.tableOps.createTableIfNotExists(t,e)}},kn=class extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}};function Se(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var hu=class extends kn{constructor(t,e,r){super(t),this.name="StorageApiError",this.status=e,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},cs=class extends kn{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}};const Os=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),fu=()=>Response,us=t=>{if(Array.isArray(t))return t.map(r=>us(r));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([r,n])=>{const s=r.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=us(n)}),e},gu=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},pu=t=>!t||typeof t!="string"||t.length===0||t.length>100||t.trim()!==t||t.includes("/")||t.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(t);function Tr(t){"@babel/helpers - typeof";return Tr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tr(t)}function mu(t,e){if(Tr(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(Tr(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function bu(t){var e=mu(t,"string");return Tr(e)=="symbol"?e:e+""}function yu(t,e,r){return(e=bu(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function ki(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),r.push.apply(r,n)}return r}function V(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?ki(Object(r),!0).forEach(function(n){yu(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ki(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}const zn=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},wu=async(t,e,r)=>{t instanceof await fu()&&!(r!=null&&r.noResolveJson)?t.json().then(n=>{const s=t.status||500,i=(n==null?void 0:n.statusCode)||s+"";e(new hu(zn(n),s,i))}).catch(n=>{e(new cs(zn(n),n))}):e(new cs(zn(t),t))},vu=(t,e,r,n)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"||!n?s:(gu(n)?(s.headers=V({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(n)):s.body=n,e!=null&&e.duplex&&(s.duplex=e.duplex),V(V({},s),r))};async function Ur(t,e,r,n,s,i){return new Promise((o,a)=>{t(r,vu(e,n,s,i)).then(l=>{if(!l.ok)throw l;return n!=null&&n.noResolveJson?l:l.json()}).then(l=>o(l)).catch(l=>wu(l,a,n))})}async function jr(t,e,r,n){return Ur(t,"GET",e,r,n)}async function ft(t,e,r,n,s){return Ur(t,"POST",e,n,s,r)}async function ds(t,e,r,n,s){return Ur(t,"PUT",e,n,s,r)}async function xu(t,e,r,n){return Ur(t,"HEAD",e,V(V({},r),{},{noResolveJson:!0}),n)}async function Is(t,e,r,n,s){return Ur(t,"DELETE",e,n,s,r)}var _u=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}then(t,e){return this.execute().then(t,e)}async execute(){var t=this;try{return{data:(await t.downloadFn()).body,error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Se(e))return{data:null,error:e};throw e}}};let Lo;Lo=Symbol.toStringTag;var ku=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e,this[Lo]="BlobDownloadBuilder",this.promise=null}asStream(){return new _u(this.downloadFn,this.shouldThrowOnError)}then(t,e){return this.getPromise().then(t,e)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var t=this;try{return{data:await(await t.downloadFn()).blob(),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(Se(e))return{data:null,error:e};throw e}}};const Su={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Si={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var Eu=class{constructor(t,e={},r,n){this.shouldThrowOnError=!1,this.url=t,this.headers=e,this.bucketId=r,this.fetch=Os(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(t,e,r,n){var s=this;try{let i;const o=V(V({},Si),n);let a=V(V({},s.headers),t==="POST"&&{"x-upsert":String(o.upsert)});const l=o.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),l&&i.append("metadata",s.encodeMetadata(l)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.has("cacheControl")||i.append("cacheControl",o.cacheControl),l&&!i.has("metadata")&&i.append("metadata",s.encodeMetadata(l))):(i=r,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,l&&(a["x-metadata"]=s.toBase64(s.encodeMetadata(l))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!o.duplex&&(o.duplex="half")),n!=null&&n.headers&&(a=V(V({},a),n.headers));const u=s._removeEmptyFolders(e),d=s._getFinalPath(u),g=await(t=="PUT"?ds:ft)(s.fetch,`${s.url}/object/${d}`,i,V({headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:u,id:g.Id,fullPath:g.Key},error:null}}catch(i){if(s.shouldThrowOnError)throw i;if(Se(i))return{data:null,error:i};throw i}}async upload(t,e,r){return this.uploadOrUpdate("POST",t,e,r)}async uploadToSignedUrl(t,e,r,n){var s=this;const i=s._removeEmptyFolders(t),o=s._getFinalPath(i),a=new URL(s.url+`/object/upload/sign/${o}`);a.searchParams.set("token",e);try{let l;const u=V({upsert:Si.upsert},n),d=V(V({},s.headers),{"x-upsert":String(u.upsert)});return typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",u.cacheControl)):(l=r,d["cache-control"]=`max-age=${u.cacheControl}`,d["content-type"]=u.contentType),{data:{path:i,fullPath:(await ds(s.fetch,a.toString(),l,{headers:d})).Key},error:null}}catch(l){if(s.shouldThrowOnError)throw l;if(Se(l))return{data:null,error:l};throw l}}async createSignedUploadUrl(t,e){var r=this;try{let n=r._getFinalPath(t);const s=V({},r.headers);e!=null&&e.upsert&&(s["x-upsert"]="true");const i=await ft(r.fetch,`${r.url}/object/upload/sign/${n}`,{},{headers:s}),o=new URL(r.url+i.url),a=o.searchParams.get("token");if(!a)throw new kn("No token returned by API");return{data:{signedUrl:o.toString(),path:t,token:a},error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(Se(n))return{data:null,error:n};throw n}}async update(t,e,r){return this.uploadOrUpdate("PUT",t,e,r)}async move(t,e,r){var n=this;try{return{data:await ft(n.fetch,`${n.url}/object/move`,{bucketId:n.bucketId,sourceKey:t,destinationKey:e,destinationBucket:r==null?void 0:r.destinationBucket},{headers:n.headers}),error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(Se(s))return{data:null,error:s};throw s}}async copy(t,e,r){var n=this;try{return{data:{path:(await ft(n.fetch,`${n.url}/object/copy`,{bucketId:n.bucketId,sourceKey:t,destinationKey:e,destinationBucket:r==null?void 0:r.destinationBucket},{headers:n.headers})).Key},error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(Se(s))return{data:null,error:s};throw s}}async createSignedUrl(t,e,r){var n=this;try{let s=n._getFinalPath(t),i=await ft(n.fetch,`${n.url}/object/sign/${s}`,V({expiresIn:e},r!=null&&r.transform?{transform:r.transform}:{}),{headers:n.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${n.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(Se(s))return{data:null,error:s};throw s}}async createSignedUrls(t,e,r){var n=this;try{const s=await ft(n.fetch,`${n.url}/object/sign/${n.bucketId}`,{expiresIn:e,paths:t},{headers:n.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(o=>V(V({},o),{},{signedUrl:o.signedURL?encodeURI(`${n.url}${o.signedURL}${i}`):null})),error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(Se(s))return{data:null,error:s};throw s}}download(t,e){const r=typeof(e==null?void 0:e.transform)<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString((e==null?void 0:e.transform)||{}),s=n?`?${n}`:"",i=this._getFinalPath(t),o=()=>jr(this.fetch,`${this.url}/${r}/${i}${s}`,{headers:this.headers,noResolveJson:!0});return new ku(o,this.shouldThrowOnError)}async info(t){var e=this;const r=e._getFinalPath(t);try{return{data:us(await jr(e.fetch,`${e.url}/object/info/${r}`,{headers:e.headers})),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Se(n))return{data:null,error:n};throw n}}async exists(t){var e=this;const r=e._getFinalPath(t);try{return await xu(e.fetch,`${e.url}/object/${r}`,{headers:e.headers}),{data:!0,error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Se(n)&&n instanceof cs){const s=n.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:n}}throw n}}getPublicUrl(t,e){const r=this._getFinalPath(t),n=[],s=e!=null&&e.download?`download=${e.download===!0?"":e.download}`:"";s!==""&&n.push(s);const i=typeof(e==null?void 0:e.transform)<"u"?"render/image":"object",o=this.transformOptsToQueryString((e==null?void 0:e.transform)||{});o!==""&&n.push(o);let a=n.join("&");return a!==""&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${r}${a}`)}}}async remove(t){var e=this;try{return{data:await Is(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:t},{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Se(r))return{data:null,error:r};throw r}}async list(t,e,r){var n=this;try{const s=V(V(V({},Su),e),{},{prefix:t||""});return{data:await ft(n.fetch,`${n.url}/object/list/${n.bucketId}`,s,{headers:n.headers},r),error:null}}catch(s){if(n.shouldThrowOnError)throw s;if(Se(s))return{data:null,error:s};throw s}}async listV2(t,e){var r=this;try{const n=V({},t);return{data:await ft(r.fetch,`${r.url}/object/list-v2/${r.bucketId}`,n,{headers:r.headers},e),error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(Se(n))return{data:null,error:n};throw n}}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}};const Do="2.90.1",$o={"X-Client-Info":`storage-js/${Do}`};var Cu=class{constructor(t,e={},r,n){this.shouldThrowOnError=!1;const s=new URL(t);n!=null&&n.useNewHostname&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase.")),this.url=s.href.replace(/\/$/,""),this.headers=V(V({},$o),e),this.fetch=Os(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(t){var e=this;try{const r=e.listBucketOptionsToQueryString(t);return{data:await jr(e.fetch,`${e.url}/bucket${r}`,{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Se(r))return{data:null,error:r};throw r}}async getBucket(t){var e=this;try{return{data:await jr(e.fetch,`${e.url}/bucket/${t}`,{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Se(r))return{data:null,error:r};throw r}}async createBucket(t,e={public:!1}){var r=this;try{return{data:await ft(r.fetch,`${r.url}/bucket`,{id:t,name:t,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:r.headers}),error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(Se(n))return{data:null,error:n};throw n}}async updateBucket(t,e){var r=this;try{return{data:await ds(r.fetch,`${r.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:r.headers}),error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(Se(n))return{data:null,error:n};throw n}}async emptyBucket(t){var e=this;try{return{data:await ft(e.fetch,`${e.url}/bucket/${t}/empty`,{},{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Se(r))return{data:null,error:r};throw r}}async deleteBucket(t){var e=this;try{return{data:await Is(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Se(r))return{data:null,error:r};throw r}}listBucketOptionsToQueryString(t){const e={};return t&&("limit"in t&&(e.limit=String(t.limit)),"offset"in t&&(e.offset=String(t.offset)),t.search&&(e.search=t.search),t.sortColumn&&(e.sortColumn=t.sortColumn),t.sortOrder&&(e.sortOrder=t.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},Ru=class{constructor(t,e={},r){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=V(V({},$o),e),this.fetch=Os(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(t){var e=this;try{return{data:await ft(e.fetch,`${e.url}/bucket`,{name:t},{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Se(r))return{data:null,error:r};throw r}}async listBuckets(t){var e=this;try{const r=new URLSearchParams;(t==null?void 0:t.limit)!==void 0&&r.set("limit",t.limit.toString()),(t==null?void 0:t.offset)!==void 0&&r.set("offset",t.offset.toString()),t!=null&&t.sortColumn&&r.set("sortColumn",t.sortColumn),t!=null&&t.sortOrder&&r.set("sortOrder",t.sortOrder),t!=null&&t.search&&r.set("search",t.search);const n=r.toString(),s=n?`${e.url}/bucket?${n}`:`${e.url}/bucket`;return{data:await jr(e.fetch,s,{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Se(r))return{data:null,error:r};throw r}}async deleteBucket(t){var e=this;try{return{data:await Is(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(Se(r))return{data:null,error:r};throw r}}from(t){var e=this;if(!pu(t))throw new kn("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const r=new du({baseUrl:this.url,catalogName:t,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),n=this.shouldThrowOnError;return new Proxy(r,{get(s,i){const o=s[i];return typeof o!="function"?o:async(...a)=>{try{return{data:await o.apply(s,a),error:null}}catch(l){if(n)throw l;return{data:null,error:l}}}}})}};const Ps={"X-Client-Info":`storage-js/${Do}`,"Content-Type":"application/json"};var Uo=class extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function tt(t){return typeof t=="object"&&t!==null&&"__isStorageVectorsError"in t}var Wn=class extends Uo{constructor(t,e,r){super(t),this.name="StorageVectorsApiError",this.status=e,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Tu=class extends Uo{constructor(t,e){super(t),this.name="StorageVectorsUnknownError",this.originalError=e}};const Ls=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),ju=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},Ei=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Au=async(t,e,r)=>{if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!(r!=null&&r.noResolveJson)){const n=t.status||500,s=t;if(typeof s.json=="function")s.json().then(i=>{const o=(i==null?void 0:i.statusCode)||(i==null?void 0:i.code)||n+"";e(new Wn(Ei(i),n,o))}).catch(()=>{const i=n+"";e(new Wn(s.statusText||`HTTP ${n} error`,n,i))});else{const i=n+"";e(new Wn(s.statusText||`HTTP ${n} error`,n,i))}}else e(new Tu(Ei(t),t))},Nu=(t,e,r,n)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return n?(ju(n)?(s.headers=V({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(n)):s.body=n,V(V({},s),r)):s};async function Ou(t,e,r,n,s,i){return new Promise((o,a)=>{t(r,Nu(e,n,s,i)).then(l=>{if(!l.ok)throw l;if(n!=null&&n.noResolveJson)return l;const u=l.headers.get("content-type");return!u||!u.includes("application/json")?{}:l.json()}).then(l=>o(l)).catch(l=>Au(l,a,n))})}async function rt(t,e,r,n,s){return Ou(t,"POST",e,n,s,r)}var Iu=class{constructor(t,e={},r){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=V(V({},Ps),e),this.fetch=Ls(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(t){var e=this;try{return{data:await rt(e.fetch,`${e.url}/CreateIndex`,t,{headers:e.headers})||{},error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(tt(r))return{data:null,error:r};throw r}}async getIndex(t,e){var r=this;try{return{data:await rt(r.fetch,`${r.url}/GetIndex`,{vectorBucketName:t,indexName:e},{headers:r.headers}),error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(tt(n))return{data:null,error:n};throw n}}async listIndexes(t){var e=this;try{return{data:await rt(e.fetch,`${e.url}/ListIndexes`,t,{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(tt(r))return{data:null,error:r};throw r}}async deleteIndex(t,e){var r=this;try{return{data:await rt(r.fetch,`${r.url}/DeleteIndex`,{vectorBucketName:t,indexName:e},{headers:r.headers})||{},error:null}}catch(n){if(r.shouldThrowOnError)throw n;if(tt(n))return{data:null,error:n};throw n}}},Pu=class{constructor(t,e={},r){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=V(V({},Ps),e),this.fetch=Ls(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(t){var e=this;try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await rt(e.fetch,`${e.url}/PutVectors`,t,{headers:e.headers})||{},error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(tt(r))return{data:null,error:r};throw r}}async getVectors(t){var e=this;try{return{data:await rt(e.fetch,`${e.url}/GetVectors`,t,{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(tt(r))return{data:null,error:r};throw r}}async listVectors(t){var e=this;try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:await rt(e.fetch,`${e.url}/ListVectors`,t,{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(tt(r))return{data:null,error:r};throw r}}async queryVectors(t){var e=this;try{return{data:await rt(e.fetch,`${e.url}/QueryVectors`,t,{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(tt(r))return{data:null,error:r};throw r}}async deleteVectors(t){var e=this;try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await rt(e.fetch,`${e.url}/DeleteVectors`,t,{headers:e.headers})||{},error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(tt(r))return{data:null,error:r};throw r}}},Lu=class{constructor(t,e={},r){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=V(V({},Ps),e),this.fetch=Ls(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(t){var e=this;try{return{data:await rt(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{},error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(tt(r))return{data:null,error:r};throw r}}async getBucket(t){var e=this;try{return{data:await rt(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:t},{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(tt(r))return{data:null,error:r};throw r}}async listBuckets(t={}){var e=this;try{return{data:await rt(e.fetch,`${e.url}/ListVectorBuckets`,t,{headers:e.headers}),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(tt(r))return{data:null,error:r};throw r}}async deleteBucket(t){var e=this;try{return{data:await rt(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{},error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(tt(r))return{data:null,error:r};throw r}}},Du=class extends Lu{constructor(t,e={}){super(t,e.headers||{},e.fetch)}from(t){return new $u(this.url,this.headers,t,this.fetch)}async createBucket(t){var e=()=>super.createBucket,r=this;return e().call(r,t)}async getBucket(t){var e=()=>super.getBucket,r=this;return e().call(r,t)}async listBuckets(t={}){var e=()=>super.listBuckets,r=this;return e().call(r,t)}async deleteBucket(t){var e=()=>super.deleteBucket,r=this;return e().call(r,t)}},$u=class extends Iu{constructor(t,e,r,n){super(t,e,n),this.vectorBucketName=r}async createIndex(t){var e=()=>super.createIndex,r=this;return e().call(r,V(V({},t),{},{vectorBucketName:r.vectorBucketName}))}async listIndexes(t={}){var e=()=>super.listIndexes,r=this;return e().call(r,V(V({},t),{},{vectorBucketName:r.vectorBucketName}))}async getIndex(t){var e=()=>super.getIndex,r=this;return e().call(r,r.vectorBucketName,t)}async deleteIndex(t){var e=()=>super.deleteIndex,r=this;return e().call(r,r.vectorBucketName,t)}index(t){return new Uu(this.url,this.headers,this.vectorBucketName,t,this.fetch)}},Uu=class extends Pu{constructor(t,e,r,n,s){super(t,e,s),this.vectorBucketName=r,this.indexName=n}async putVectors(t){var e=()=>super.putVectors,r=this;return e().call(r,V(V({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async getVectors(t){var e=()=>super.getVectors,r=this;return e().call(r,V(V({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async listVectors(t={}){var e=()=>super.listVectors,r=this;return e().call(r,V(V({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async queryVectors(t){var e=()=>super.queryVectors,r=this;return e().call(r,V(V({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}async deleteVectors(t){var e=()=>super.deleteVectors,r=this;return e().call(r,V(V({},t),{},{vectorBucketName:r.vectorBucketName,indexName:r.indexName}))}},Mu=class extends Cu{constructor(t,e={},r,n){super(t,e,r,n)}from(t){return new Eu(this.url,this.headers,t,this.fetch)}get vectors(){return new Du(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new Ru(this.url+"/iceberg",this.headers,this.fetch)}};const Mo="2.90.1",Xt=30*1e3,hs=3,Gn=hs*Xt,Fu="http://localhost:9999",Bu="supabase.auth.token",qu={"X-Client-Info":`gotrue-js/${Mo}`},fs="X-Supabase-Api-Version",Fo={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},zu=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Wu=600*1e3;class Ar extends Error{constructor(e,r,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=r,this.code=n}}function B(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class Gu extends Ar{constructor(e,r,n){super(e,r,n),this.name="AuthApiError",this.status=r,this.code=n}}function Hu(t){return B(t)&&t.name==="AuthApiError"}class Mt extends Ar{constructor(e,r){super(e),this.name="AuthUnknownError",this.originalError=r}}class St extends Ar{constructor(e,r,n,s){super(e,n,s),this.name=r,this.status=n}}class et extends St{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Ku(t){return B(t)&&t.name==="AuthSessionMissingError"}class Wt extends St{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Vr extends St{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Jr extends St{constructor(e,r=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Vu(t){return B(t)&&t.name==="AuthImplicitGrantRedirectError"}class Ci extends St{constructor(e,r=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=r}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ju extends St{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class gs extends St{constructor(e,r){super(e,"AuthRetryableFetchError",r,void 0)}}function Hn(t){return B(t)&&t.name==="AuthRetryableFetchError"}class Ri extends St{constructor(e,r,n){super(e,"AuthWeakPasswordError",r,"weak_password"),this.reasons=n}}class ps extends St{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const ln="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Ti=` 	
\r=`.split(""),Yu=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<Ti.length;e+=1)t[Ti[e].charCodeAt(0)]=-2;for(let e=0;e<ln.length;e+=1)t[ln[e].charCodeAt(0)]=e;return t})();function ji(t,e,r){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;r(ln[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;r(ln[n]),e.queuedBits-=6}}function Bo(t,e,r){const n=Yu[t];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)r(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function Ai(t){const e=[],r=o=>{e.push(String.fromCodePoint(o))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=o=>{Zu(o,n,r)};for(let o=0;o<t.length;o+=1)Bo(t.charCodeAt(o),s,i);return e.join("")}function Xu(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function Qu(t,e){for(let r=0;r<t.length;r+=1){let n=t.charCodeAt(r);if(n>55295&&n<=56319){const s=(n-55296)*1024&65535;n=(t.charCodeAt(r+1)-56320&65535|s)+65536,r+=1}Xu(n,e)}}function Zu(t,e,r){if(e.utf8seq===0){if(t<=127){r(t);return}for(let n=1;n<6;n+=1)if((t>>7-n&1)===0){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&r(e.codepoint)}}function tr(t){const e=[],r={queue:0,queuedBits:0},n=s=>{e.push(s)};for(let s=0;s<t.length;s+=1)Bo(t.charCodeAt(s),r,n);return new Uint8Array(e)}function ed(t){const e=[];return Qu(t,r=>e.push(r)),new Uint8Array(e)}function Bt(t){const e=[],r={queue:0,queuedBits:0},n=s=>{e.push(s)};return t.forEach(s=>ji(s,r,n)),ji(null,r,n),e.join("")}function td(t){return Math.round(Date.now()/1e3)+t}function rd(){return Symbol("auth-callback")}const Me=()=>typeof window<"u"&&typeof document<"u",Lt={tested:!1,writable:!1},qo=()=>{if(!Me())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Lt.tested)return Lt.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),Lt.tested=!0,Lt.writable=!0}catch{Lt.tested=!0,Lt.writable=!1}return Lt.writable};function nd(t){const e={},r=new URL(t);if(r.hash&&r.hash[0]==="#")try{new URLSearchParams(r.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return r.searchParams.forEach((n,s)=>{e[s]=n}),e}const zo=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),sd=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",Qt=async(t,e,r)=>{await t.setItem(e,JSON.stringify(r))},Dt=async(t,e)=>{const r=await t.getItem(e);if(!r)return null;try{return JSON.parse(r)}catch{return r}},Ue=async(t,e)=>{await t.removeItem(e)};class Sn{constructor(){this.promise=new Sn.promiseConstructor((e,r)=>{this.resolve=e,this.reject=r})}}Sn.promiseConstructor=Promise;function Kn(t){const e=t.split(".");if(e.length!==3)throw new ps("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!zu.test(e[n]))throw new ps("JWT not in base64url format");return{header:JSON.parse(Ai(e[0])),payload:JSON.parse(Ai(e[1])),signature:tr(e[2]),raw:{header:e[0],payload:e[1]}}}async function id(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function od(t,e){return new Promise((n,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await t(i);if(!e(i,null,o)){n(o);return}}catch(o){if(!e(i,o)){s(o);return}}})()})}function ad(t){return("0"+t.toString(16)).substr(-2)}function ld(){const e=new Uint32Array(56);if(typeof crypto>"u"){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=r.length;let s="";for(let i=0;i<56;i++)s+=r.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(e),Array.from(e,ad).join("")}async function cd(t){const r=new TextEncoder().encode(t),n=await crypto.subtle.digest("SHA-256",r),s=new Uint8Array(n);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function ud(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const r=await cd(t);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Gt(t,e,r=!1){const n=ld();let s=n;r&&(s+="/PASSWORD_RECOVERY"),await Qt(t,`${e}-code-verifier`,s);const i=await ud(n);return[i,n===i?"plain":"s256"]}const dd=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function hd(t){const e=t.headers.get(fs);if(!e||!e.match(dd))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function fd(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function gd(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const pd=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Ht(t){if(!pd.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Vn(){const t={};return new Proxy(t,{get:(e,r)=>{if(r==="__isUserNotAvailableProxy")return!0;if(typeof r=="symbol"){const n=r.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${r}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,r)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${r}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function md(t,e){return new Proxy(t,{get:(r,n,s)=>{if(n==="__isInsecureUserWarningProxy")return!0;if(typeof n=="symbol"){const i=n.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(r,n,s)}return!e.value&&typeof n=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(r,n,s)}})}function Ni(t){return JSON.parse(JSON.stringify(t))}const $t=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),bd=[502,503,504];async function Oi(t){var e;if(!sd(t))throw new gs($t(t),0);if(bd.includes(t.status))throw new gs($t(t),t.status);let r;try{r=await t.json()}catch(i){throw new Mt($t(i),i)}let n;const s=hd(t);if(s&&s.getTime()>=Fo["2024-01-01"].timestamp&&typeof r=="object"&&r&&typeof r.code=="string"?n=r.code:typeof r=="object"&&r&&typeof r.error_code=="string"&&(n=r.error_code),n){if(n==="weak_password")throw new Ri($t(r),t.status,((e=r.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new et}else if(typeof r=="object"&&r&&typeof r.weak_password=="object"&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new Ri($t(r),t.status,r.weak_password.reasons);throw new Gu($t(r),t.status||500,n)}const yd=(t,e,r,n)=>{const s={method:t,headers:(e==null?void 0:e.headers)||{}};return t==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),r))};async function K(t,e,r,n){var s;const i=Object.assign({},n==null?void 0:n.headers);i[fs]||(i[fs]=Fo["2024-01-01"].name),n!=null&&n.jwt&&(i.Authorization=`Bearer ${n.jwt}`);const o=(s=n==null?void 0:n.query)!==null&&s!==void 0?s:{};n!=null&&n.redirectTo&&(o.redirect_to=n.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=await wd(t,e,r+a,{headers:i,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(l):{data:Object.assign({},l),error:null}}async function wd(t,e,r,n,s,i){const o=yd(e,n,s,i);let a;try{a=await t(r,Object.assign({},o))}catch(l){throw console.error(l),new gs($t(l),0)}if(a.ok||await Oi(a),n!=null&&n.noResolveJson)return a;try{return await a.json()}catch(l){await Oi(l)}}function ht(t){var e;let r=null;_d(t)&&(r=Object.assign({},t),t.expires_at||(r.expires_at=td(t.expires_in)));const n=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:r,user:n},error:null}}function Ii(t){const e=ht(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((r,n)=>r&&typeof n=="string",!0)&&(e.data.weak_password=t.weak_password),e}function Nt(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function vd(t){return{data:t,error:null}}function xd(t){const{action_link:e,email_otp:r,hashed_token:n,redirect_to:s,verification_type:i}=t,o=_n(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:r,hashed_token:n,redirect_to:s,verification_type:i},l=Object.assign({},o);return{data:{properties:a,user:l},error:null}}function Pi(t){return t}function _d(t){return t.access_token&&t.refresh_token&&t.expires_in}const Jn=["global","local","others"];class kd{constructor({url:e="",headers:r={},fetch:n}){this.url=e,this.headers=r,this.fetch=zo(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,r=Jn[0]){if(Jn.indexOf(r)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Jn.join(", ")}`);try{return await K(this.fetch,"POST",`${this.url}/logout?scope=${r}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(B(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,r={}){try{return await K(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:r.data},headers:this.headers,redirectTo:r.redirectTo,xform:Nt})}catch(n){if(B(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:r}=e,n=_n(e,["options"]),s=Object.assign(Object.assign({},n),r);return"newEmail"in n&&(s.new_email=n==null?void 0:n.newEmail,delete s.newEmail),await K(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:xd,redirectTo:r==null?void 0:r.redirectTo})}catch(r){if(B(r))return{data:{properties:null,user:null},error:r};throw r}}async createUser(e){try{return await K(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Nt})}catch(r){if(B(r))return{data:{user:null},error:r};throw r}}async listUsers(e){var r,n,s,i,o,a,l;try{const u={nextPage:null,lastPage:0,total:0},d=await K(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=e==null?void 0:e.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:Pi});if(d.error)throw d.error;const g=await d.json(),h=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(l=(a=d.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return p.length>0&&(p.forEach(v=>{const b=parseInt(v.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(v.split(";")[1].split("=")[1]);u[`${m}Page`]=b}),u.total=parseInt(h)),{data:Object.assign(Object.assign({},g),u),error:null}}catch(u){if(B(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){Ht(e);try{return await K(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Nt})}catch(r){if(B(r))return{data:{user:null},error:r};throw r}}async updateUserById(e,r){Ht(e);try{return await K(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:r,headers:this.headers,xform:Nt})}catch(n){if(B(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,r=!1){Ht(e);try{return await K(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:r},xform:Nt})}catch(n){if(B(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){Ht(e.userId);try{const{data:r,error:n}=await K(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:r,error:n}}catch(r){if(B(r))return{data:null,error:r};throw r}}async _deleteFactor(e){Ht(e.userId),Ht(e.id);try{return{data:await K(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(r){if(B(r))return{data:null,error:r};throw r}}async _listOAuthClients(e){var r,n,s,i,o,a,l;try{const u={nextPage:null,lastPage:0,total:0},d=await K(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(r=e==null?void 0:e.page)===null||r===void 0?void 0:r.toString())!==null&&n!==void 0?n:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:Pi});if(d.error)throw d.error;const g=await d.json(),h=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(l=(a=d.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return p.length>0&&(p.forEach(v=>{const b=parseInt(v.split(";")[0].split("=")[1].substring(0,1)),m=JSON.parse(v.split(";")[1].split("=")[1]);u[`${m}Page`]=b}),u.total=parseInt(h)),{data:Object.assign(Object.assign({},g),u),error:null}}catch(u){if(B(u))return{data:{clients:[]},error:u};throw u}}async _createOAuthClient(e){try{return await K(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(B(r))return{data:null,error:r};throw r}}async _getOAuthClient(e){try{return await K(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(B(r))return{data:null,error:r};throw r}}async _updateOAuthClient(e,r){try{return await K(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:r,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(B(n))return{data:null,error:n};throw n}}async _deleteOAuthClient(e){try{return await K(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(r){if(B(r))return{data:null,error:r};throw r}}async _regenerateOAuthClientSecret(e){try{return await K(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(B(r))return{data:null,error:r};throw r}}}function Li(t={}){return{getItem:e=>t[e]||null,setItem:(e,r)=>{t[e]=r},removeItem:e=>{delete t[e]}}}const Kt={debug:!!(globalThis&&qo()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Wo extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Sd extends Wo{}async function Ed(t,e,r){Kt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),Kt.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){Kt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,s.name);try{return await r()}finally{Kt.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,s.name)}}else{if(e===0)throw Kt.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new Sd(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Kt.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await r()}}))}function Cd(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function Go(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function Rd(t){return parseInt(t,16)}function Td(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,n=>n.toString(16).padStart(2,"0")).join("")}function jd(t){var e;const{chainId:r,domain:n,expirationTime:s,issuedAt:i=new Date,nonce:o,notBefore:a,requestId:l,resources:u,scheme:d,uri:g,version:h}=t;{if(!Number.isInteger(r))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${r}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!g)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(h!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${h}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const p=Go(t.address),v=d?`${d}://${n}`:n,b=t.statement?`${t.statement}
`:"",m=`${v} wants you to sign in with your Ethereum account:
${p}

${b}`;let x=`URI: ${g}
Version: ${h}
Chain ID: ${r}${o?`
Nonce: ${o}`:""}
Issued At: ${i.toISOString()}`;if(s&&(x+=`
Expiration Time: ${s.toISOString()}`),a&&(x+=`
Not Before: ${a.toISOString()}`),l&&(x+=`
Request ID: ${l}`),u){let _=`
Resources:`;for(const w of u){if(!w||typeof w!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${w}`);_+=`
- ${w}`}x+=_}return`${m}
${x}`}class Ae extends Error{constructor({message:e,code:r,cause:n,name:s}){var i;super(e,{cause:n}),this.__isWebAuthnError=!0,this.name=(i=s??(n instanceof Error?n.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=r}}class cn extends Ae{constructor(e,r){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:r,message:e}),this.name="WebAuthnUnknownError",this.originalError=r}}function Ad({error:t,options:e}){var r,n,s;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Ae({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((r=i.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new Ae({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((n=i.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new Ae({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((s=i.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new Ae({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new Ae({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new Ae({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return i.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new Ae({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new Ae({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const o=window.location.hostname;if(Ho(o)){if(i.rp.id!==o)return new Ae({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new Ae({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new Ae({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new Ae({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Ae({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function Nd({error:t,options:e}){const{publicKey:r}=e;if(!r)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Ae({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new Ae({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const n=window.location.hostname;if(Ho(n)){if(r.rpId!==n)return new Ae({message:`The RP ID "${r.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new Ae({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new Ae({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new Ae({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class Od{createNewAbortSignal(){if(this.controller){const r=new Error("Cancelling existing WebAuthn API call for new one");r.name="AbortError",this.controller.abort(r)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const Id=new Od;function Pd(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:r,excludeCredentials:n}=t,s=_n(t,["challenge","user","excludeCredentials"]),i=tr(e).buffer,o=Object.assign(Object.assign({},r),{id:tr(r.id).buffer}),a=Object.assign(Object.assign({},s),{challenge:i,user:o});if(n&&n.length>0){a.excludeCredentials=new Array(n.length);for(let l=0;l<n.length;l++){const u=n[l];a.excludeCredentials[l]=Object.assign(Object.assign({},u),{id:tr(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return a}function Ld(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:r}=t,n=_n(t,["challenge","allowCredentials"]),s=tr(e).buffer,i=Object.assign(Object.assign({},n),{challenge:s});if(r&&r.length>0){i.allowCredentials=new Array(r.length);for(let o=0;o<r.length;o++){const a=r[o];i.allowCredentials[o]=Object.assign(Object.assign({},a),{id:tr(a.id).buffer,type:a.type||"public-key",transports:a.transports})}}return i}function Dd(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const r=t;return{id:t.id,rawId:t.id,response:{attestationObject:Bt(new Uint8Array(t.response.attestationObject)),clientDataJSON:Bt(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=r.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function $d(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const r=t,n=t.getClientExtensionResults(),s=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:Bt(new Uint8Array(s.authenticatorData)),clientDataJSON:Bt(new Uint8Array(s.clientDataJSON)),signature:Bt(new Uint8Array(s.signature)),userHandle:s.userHandle?Bt(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(e=r.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function Ho(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function Di(){var t,e;return!!(Me()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator==null?void 0:navigator.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function Ud(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new cn("Browser returned unexpected credential type",e)}:{data:null,error:new cn("Empty credential response",e)}}catch(e){return{data:null,error:Ad({error:e,options:t})}}}async function Md(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new cn("Browser returned unexpected credential type",e)}:{data:null,error:new cn("Empty credential response",e)}}catch(e){return{data:null,error:Nd({error:e,options:t})}}}const Fd={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},Bd={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function un(...t){const e=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),r=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),n={};for(const s of t)if(s)for(const i in s){const o=s[i];if(o!==void 0)if(Array.isArray(o))n[i]=o;else if(r(o))n[i]=o;else if(e(o)){const a=n[i];e(a)?n[i]=un(a,o):n[i]=un(o)}else n[i]=o}return n}function qd(t,e){return un(Fd,t,e||{})}function zd(t,e){return un(Bd,t,e||{})}class Wd{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:r,friendlyName:n,signal:s},i){try{const{data:o,error:a}=await this.client.mfa.challenge({factorId:e,webauthn:r});if(!o)return{data:null,error:a};const l=s??Id.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:u}=o.webauthn.credential_options.publicKey;u.name||(u.name=`${u.id}:${n}`),u.displayName||(u.displayName=u.name)}switch(o.webauthn.type){case"create":{const u=qd(o.webauthn.credential_options.publicKey,i==null?void 0:i.create),{data:d,error:g}=await Ud({publicKey:u,signal:l});return d?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:d}},error:null}:{data:null,error:g}}case"request":{const u=zd(o.webauthn.credential_options.publicKey,i==null?void 0:i.request),{data:d,error:g}=await Md(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:u,signal:l}));return d?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:d}},error:null}:{data:null,error:g}}}}catch(o){return B(o)?{data:null,error:o}:{data:null,error:new Mt("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:r,webauthn:n}){return this.client.mfa.verify({factorId:r,challengeId:e,webauthn:n})}async _authenticate({factorId:e,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},i){if(!r)return{data:null,error:new Ar("rpId is required for WebAuthn authentication")};try{if(!Di())return{data:null,error:new Mt("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this.challenge({factorId:e,webauthn:{rpId:r,rpOrigins:n},signal:s},{request:i});if(!o)return{data:null,error:a};const{webauthn:l}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:l.type,rpId:r,rpOrigins:n,credential_response:l.credential_response}})}catch(o){return B(o)?{data:null,error:o}:{data:null,error:new Mt("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:r=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},i){if(!r)return{data:null,error:new Ar("rpId is required for WebAuthn registration")};try{if(!Di())return{data:null,error:new Mt("Browser does not support WebAuthn",null)};const{data:o,error:a}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(d=>{var g;return(g=d.data)===null||g===void 0?void 0:g.all.find(h=>h.factor_type==="webauthn"&&h.friendly_name===e&&h.status!=="unverified")}).then(d=>d?this.client.mfa.unenroll({factorId:d==null?void 0:d.id}):void 0),{data:null,error:a};const{data:l,error:u}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:r,rpOrigins:n},signal:s},{create:i});return l?this._verify({factorId:o.id,challengeId:l.challengeId,webauthn:{rpId:r,rpOrigins:n,type:l.webauthn.type,credential_response:l.webauthn.credential_response}}):{data:null,error:u}}catch(o){return B(o)?{data:null,error:o}:{data:null,error:new Mt("Unexpected error in register",o)}}}}Cd();const Gd={url:Fu,storageKey:Bu,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:qu,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function $i(t,e,r){return await r()}const Vt={};class Nr{get jwks(){var e,r;return(r=(e=Vt[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&r!==void 0?r:{keys:[]}}set jwks(e){Vt[this.storageKey]=Object.assign(Object.assign({},Vt[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,r;return(r=(e=Vt[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&r!==void 0?r:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Vt[this.storageKey]=Object.assign(Object.assign({},Vt[this.storageKey]),{cachedAt:e})}constructor(e){var r,n,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const i=Object.assign(Object.assign({},Gd),e);if(this.storageKey=i.storageKey,this.instanceID=(r=Nr.nextInstanceID[this.storageKey])!==null&&r!==void 0?r:0,Nr.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&Me()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new kd({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=zo(i.fetch),this.lock=i.lock||$i,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,this.lockAcquireTimeout=i.lockAcquireTimeout,i.lock?this.lock=i.lock:this.persistSession&&Me()&&(!((n=globalThis==null?void 0:globalThis.navigator)===null||n===void 0)&&n.locks)?this.lock=Ed:this.lock=$i,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new Wd(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:qo()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Li(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=Li(this.memoryStorage)),Me()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${Mo}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let r={},n="none";if(Me()&&(r=nd(window.location.href),this._isImplicitGrantCallback(r)?n="implicit":await this._isPKCECallback(r)&&(n="pkce")),Me()&&this.detectSessionInUrl&&n!=="none"){const{data:s,error:i}=await this._getSessionFromURL(r,n);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),Vu(i)){const l=(e=i.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:i}}return{error:i}}const{session:o,redirectType:a}=s;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return B(r)?this._returnResult({error:r}):this._returnResult({error:new Mt("Unexpected error during initialization",r)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var r,n,s;try{const i=await K(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(r=e==null?void 0:e.options)===null||r===void 0?void 0:r.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:ht}),{data:o,error:a}=i;if(a||!o)return this._returnResult({data:{user:null,session:null},error:a});const l=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(i){if(B(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(e){var r,n,s;try{let i;if("email"in e){const{email:d,password:g,options:h}=e;let p=null,v=null;this.flowType==="pkce"&&([p,v]=await Gt(this.storage,this.storageKey)),i=await K(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:h==null?void 0:h.emailRedirectTo,body:{email:d,password:g,data:(r=h==null?void 0:h.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:p,code_challenge_method:v},xform:ht})}else if("phone"in e){const{phone:d,password:g,options:h}=e;i=await K(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:g,data:(n=h==null?void 0:h.data)!==null&&n!==void 0?n:{},channel:(s=h==null?void 0:h.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken}},xform:ht})}else throw new Vr("You must provide either an email or phone number and a password");const{data:o,error:a}=i;if(a||!o)return await Ue(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:a});const l=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(i){if(await Ue(this.storage,`${this.storageKey}-code-verifier`),B(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(e){try{let r;if("email"in e){const{email:i,password:o,options:a}=e;r=await K(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:Ii})}else if("phone"in e){const{phone:i,password:o,options:a}=e;r=await K(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:Ii})}else throw new Vr("You must provide either an email or phone number and a password");const{data:n,error:s}=r;if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!n||!n.session||!n.user){const i=new Wt;return this._returnResult({data:{user:null,session:null},error:i})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(r){if(B(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOAuth(e){var r,n,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:r}=e;switch(r){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${r}"`)}}async signInWithEthereum(e){var r,n,s,i,o,a,l,u,d,g,h;let p,v;if("message"in e)p=e.message,v=e.signature;else{const{chain:b,wallet:m,statement:x,options:_}=e;let w;if(Me())if(typeof m=="object")w=m;else{const L=window;if("ethereum"in L&&typeof L.ethereum=="object"&&"request"in L.ethereum&&typeof L.ethereum.request=="function")w=L.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof m!="object"||!(_!=null&&_.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=m}const C=new URL((r=_==null?void 0:_.url)!==null&&r!==void 0?r:window.location.href),P=await w.request({method:"eth_requestAccounts"}).then(L=>L).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!P||P.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const k=Go(P[0]);let E=(n=_==null?void 0:_.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!E){const L=await w.request({method:"eth_chainId"});E=Rd(L)}const A={domain:C.host,address:k,statement:x,uri:C.href,version:"1",chainId:E,nonce:(s=_==null?void 0:_.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(o=(i=_==null?void 0:_.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(a=_==null?void 0:_.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=_==null?void 0:_.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(u=_==null?void 0:_.signInWithEthereum)===null||u===void 0?void 0:u.requestId,resources:(d=_==null?void 0:_.signInWithEthereum)===null||d===void 0?void 0:d.resources};p=jd(A),v=await w.request({method:"personal_sign",params:[Td(p),k]})}try{const{data:b,error:m}=await K(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:p,signature:v},!((g=e.options)===null||g===void 0)&&g.captchaToken?{gotrue_meta_security:{captcha_token:(h=e.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:ht});if(m)throw m;if(!b||!b.session||!b.user){const x=new Wt;return this._returnResult({data:{user:null,session:null},error:x})}return b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),this._returnResult({data:Object.assign({},b),error:m})}catch(b){if(B(b))return this._returnResult({data:{user:null,session:null},error:b});throw b}}async signInWithSolana(e){var r,n,s,i,o,a,l,u,d,g,h,p;let v,b;if("message"in e)v=e.message,b=e.signature;else{const{chain:m,wallet:x,statement:_,options:w}=e;let C;if(Me())if(typeof x=="object")C=x;else{const k=window;if("solana"in k&&typeof k.solana=="object"&&("signIn"in k.solana&&typeof k.solana.signIn=="function"||"signMessage"in k.solana&&typeof k.solana.signMessage=="function"))C=k.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof x!="object"||!(w!=null&&w.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");C=x}const P=new URL((r=w==null?void 0:w.url)!==null&&r!==void 0?r:window.location.href);if("signIn"in C&&C.signIn){const k=await C.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w==null?void 0:w.signInWithSolana),{version:"1",domain:P.host,uri:P.href}),_?{statement:_}:null));let E;if(Array.isArray(k)&&k[0]&&typeof k[0]=="object")E=k[0];else if(k&&typeof k=="object"&&"signedMessage"in k&&"signature"in k)E=k;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in E&&"signature"in E&&(typeof E.signedMessage=="string"||E.signedMessage instanceof Uint8Array)&&E.signature instanceof Uint8Array)v=typeof E.signedMessage=="string"?E.signedMessage:new TextDecoder().decode(E.signedMessage),b=E.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in C)||typeof C.signMessage!="function"||!("publicKey"in C)||typeof C!="object"||!C.publicKey||!("toBase58"in C.publicKey)||typeof C.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");v=[`${P.host} wants you to sign in with your Solana account:`,C.publicKey.toBase58(),..._?["",_,""]:[""],"Version: 1",`URI: ${P.href}`,`Issued At: ${(s=(n=w==null?void 0:w.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((i=w==null?void 0:w.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((o=w==null?void 0:w.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((a=w==null?void 0:w.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((l=w==null?void 0:w.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((u=w==null?void 0:w.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((g=(d=w==null?void 0:w.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||g===void 0)&&g.length?["Resources",...w.signInWithSolana.resources.map(E=>`- ${E}`)]:[]].join(`
`);const k=await C.signMessage(new TextEncoder().encode(v),"utf8");if(!k||!(k instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");b=k}}try{const{data:m,error:x}=await K(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:v,signature:Bt(b)},!((h=e.options)===null||h===void 0)&&h.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:ht});if(x)throw x;if(!m||!m.session||!m.user){const _=new Wt;return this._returnResult({data:{user:null,session:null},error:_})}return m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",m.session)),this._returnResult({data:Object.assign({},m),error:x})}catch(m){if(B(m))return this._returnResult({data:{user:null,session:null},error:m});throw m}}async _exchangeCodeForSession(e){const r=await Dt(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(r??"").split("/");try{if(!n&&this.flowType==="pkce")throw new Ju;const{data:i,error:o}=await K(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:ht});if(await Ue(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!i||!i.session||!i.user){const a=new Wt;return this._returnResult({data:{user:null,session:null,redirectType:null},error:a})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:o})}catch(i){if(await Ue(this.storage,`${this.storageKey}-code-verifier`),B(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(e){try{const{options:r,provider:n,token:s,access_token:i,nonce:o}=e,a=await K(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},xform:ht}),{data:l,error:u}=a;if(u)return this._returnResult({data:{user:null,session:null},error:u});if(!l||!l.session||!l.user){const d=new Wt;return this._returnResult({data:{user:null,session:null},error:d})}return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),this._returnResult({data:l,error:u})}catch(r){if(B(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async signInWithOtp(e){var r,n,s,i,o;try{if("email"in e){const{email:a,options:l}=e;let u=null,d=null;this.flowType==="pkce"&&([u,d]=await Gt(this.storage,this.storageKey));const{error:g}=await K(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(r=l==null?void 0:l.data)!==null&&r!==void 0?r:{},create_user:(n=l==null?void 0:l.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},code_challenge:u,code_challenge_method:d},redirectTo:l==null?void 0:l.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:g})}if("phone"in e){const{phone:a,options:l}=e,{data:u,error:d}=await K(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(s=l==null?void 0:l.data)!==null&&s!==void 0?s:{},create_user:(i=l==null?void 0:l.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken},channel:(o=l==null?void 0:l.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:d})}throw new Vr("You must provide either an email or phone number.")}catch(a){if(await Ue(this.storage,`${this.storageKey}-code-verifier`),B(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async verifyOtp(e){var r,n;try{let s,i;"options"in e&&(s=(r=e.options)===null||r===void 0?void 0:r.redirectTo,i=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:o,error:a}=await K(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:ht});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const l=o.session,u=o.user;return l!=null&&l.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),this._returnResult({data:{user:u,session:l},error:null})}catch(s){if(B(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithSSO(e){var r,n,s,i,o;try{let a=null,l=null;this.flowType==="pkce"&&([a,l]=await Gt(this.storage,this.storageKey));const u=await K(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(r=e.options)===null||r===void 0?void 0:r.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:l}),headers:this.headers,xform:vd});return!((i=u.data)===null||i===void 0)&&i.url&&Me()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(u.data.url),this._returnResult(u)}catch(a){if(await Ue(this.storage,`${this.storageKey}-code-verifier`),B(a))return this._returnResult({data:null,error:a});throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:r},error:n}=e;if(n)throw n;if(!r)throw new et;const{error:s}=await K(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return this._returnResult({data:{user:null,session:null},error:s})})}catch(e){if(B(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const r=`${this.url}/resend`;if("email"in e){const{email:n,type:s,options:i}=e,{error:o}=await K(this.fetch,"POST",r,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:n,type:s,options:i}=e,{data:o,error:a}=await K(this.fetch,"POST",r,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a})}throw new Vr("You must provide either an email or phone number and a type")}catch(r){if(B(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async r=>r))}async _acquireLock(e,r){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await r()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=r();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const r=await this.__loadSession();return await e(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const r=await Dt(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?e=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<Gn:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const o=await Dt(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=Vn()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=md(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:s},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const r=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return r.data.user&&(this.suppressGetSessionWarning=!0),r}async _getUser(e){try{return e?await K(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Nt}):await this._useSession(async r=>{var n,s,i;const{data:o,error:a}=r;if(a)throw a;return!(!((n=o.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new et}:await K(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:Nt})})}catch(r){if(B(r))return Ku(r)&&(await this._removeSession(),await Ue(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:r});throw r}}async updateUser(e,r={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,r))}async _updateUser(e,r={}){try{return await this._useSession(async n=>{const{data:s,error:i}=n;if(i)throw i;if(!s.session)throw new et;const o=s.session;let a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await Gt(this.storage,this.storageKey));const{data:u,error:d}=await K(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r==null?void 0:r.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:o.access_token,xform:Nt});if(d)throw d;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(n){if(await Ue(this.storage,`${this.storageKey}-code-verifier`),B(n))return this._returnResult({data:{user:null},error:n});throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new et;const r=Date.now()/1e3;let n=r,s=!0,i=null;const{payload:o}=Kn(e.access_token);if(o.exp&&(n=o.exp,s=n<=r),s){const{data:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return this._returnResult({data:{user:null,session:null},error:l});if(!a)return{data:{user:null,session:null},error:null};i=a}else{const{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;i={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:n-r,expires_at:n},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(r){if(B(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async r=>{var n;if(!e){const{data:o,error:a}=r;if(a)throw a;e=(n=o.session)!==null&&n!==void 0?n:void 0}if(!(e!=null&&e.refresh_token))throw new et;const{data:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):s?this._returnResult({data:{user:s.user,session:s},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(r){if(B(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async _getSessionFromURL(e,r){try{if(!Me())throw new Jr("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Jr(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new Ci("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Jr("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Ci("No code detected.");const{data:_,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const C=new URL(window.location.href);return C.searchParams.delete("code"),window.history.replaceState(window.history.state,"",C.toString()),{data:{session:_.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:i,refresh_token:o,expires_in:a,expires_at:l,token_type:u}=e;if(!i||!a||!o||!u)throw new Jr("No session defined in URL");const d=Math.round(Date.now()/1e3),g=parseInt(a);let h=d+g;l&&(h=parseInt(l));const p=h-d;p*1e3<=Xt&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${g}s`);const v=h-g;d-v>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",v,h,d):d-v<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",v,h,d);const{data:b,error:m}=await this._getUser(i);if(m)throw m;const x={provider_token:n,provider_refresh_token:s,access_token:i,expires_in:g,expires_at:h,refresh_token:o,token_type:u,user:b.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:x,redirectType:e.type},error:null})}catch(n){if(B(n))return this._returnResult({data:{session:null,redirectType:null},error:n});throw n}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const r=await Dt(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&r)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async r=>{var n;const{data:s,error:i}=r;if(i)return this._returnResult({error:i});const o=(n=s.session)===null||n===void 0?void 0:n.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(Hu(a)&&(a.status===404||a.status===401||a.status===403)))return this._returnResult({error:a})}return e!=="others"&&(await this._removeSession(),await Ue(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const r=rd(),n={id:r,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,n),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async r=>{var n,s;try{const{data:{session:i},error:o}=r;if(o)throw o;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,r={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await Gt(this.storage,this.storageKey,!0));try{return await K(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(i){if(await Ue(this.storage,`${this.storageKey}-code-verifier`),B(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var e;try{const{data:r,error:n}=await this.getUser();if(n)throw n;return this._returnResult({data:{identities:(e=r.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(r){if(B(r))return this._returnResult({data:null,error:r});throw r}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var r;try{const{data:n,error:s}=await this._useSession(async i=>{var o,a,l,u,d;const{data:g,error:h}=i;if(h)throw h;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await K(this.fetch,"GET",p,{headers:this.headers,jwt:(d=(u=g.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:void 0})});if(s)throw s;return Me()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),this._returnResult({data:{provider:e.provider,url:n==null?void 0:n.url},error:null})}catch(n){if(B(n))return this._returnResult({data:{provider:e.provider,url:null},error:n});throw n}}async linkIdentityIdToken(e){return await this._useSession(async r=>{var n;try{const{error:s,data:{session:i}}=r;if(s)throw s;const{options:o,provider:a,token:l,access_token:u,nonce:d}=e,g=await K(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=i==null?void 0:i.access_token)!==null&&n!==void 0?n:void 0,body:{provider:a,id_token:l,access_token:u,nonce:d,link_identity:!0,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:ht}),{data:h,error:p}=g;return p?this._returnResult({data:{user:null,session:null},error:p}):!h||!h.session||!h.user?this._returnResult({data:{user:null,session:null},error:new Wt}):(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("USER_UPDATED",h.session)),this._returnResult({data:h,error:p}))}catch(s){if(await Ue(this.storage,`${this.storageKey}-code-verifier`),B(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}})}async unlinkIdentity(e){try{return await this._useSession(async r=>{var n,s;const{data:i,error:o}=r;if(o)throw o;return await K(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(n=i.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(r){if(B(r))return this._returnResult({data:null,error:r});throw r}}async _refreshAccessToken(e){const r=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{const n=Date.now();return await od(async s=>(s>0&&await id(200*Math.pow(2,s-1)),this._debug(r,"refreshing attempt",s),await K(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:ht})),(s,i)=>{const o=200*Math.pow(2,s);return i&&Hn(i)&&Date.now()+o-n<Xt})}catch(n){if(this._debug(r,"error",n),B(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}finally{this._debug(r,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,r){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",r,"url",n),Me()&&!r.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,r;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const s=await Dt(this.storage,this.storageKey);if(s&&this.userStorage){let o=await Dt(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:s.user},await Qt(this.userStorage,this.storageKey+"-user",o)),s.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:Vn()}else if(s&&!s.user&&!s.user){const o=await Dt(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(s.user=o.user,await Ue(this.storage,this.storageKey+"-user"),await Qt(this.storage,this.storageKey,s)):s.user=Vn()}if(this._debug(n,"session from storage",s),!this._isValidSession(s)){this._debug(n,"session is not valid"),s!==null&&await this._removeSession();return}const i=((r=s.expires_at)!==null&&r!==void 0?r:1/0)*1e3-Date.now()<Gn;if(this._debug(n,`session has${i?"":" not"} expired with margin of ${Gn}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:o}=await this._callRefreshToken(s.refresh_token);o&&(console.error(o),Hn(o)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:a}=await this._getUser(s.access_token);!a&&(o!=null&&o.user)?(s.user=o.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(n,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(n,"error",s),console.error(s);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var r,n;if(!e)throw new et;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Sn;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new et;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const a={data:i.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(i){if(this._debug(s,"error",i),B(i)){const o={data:null,error:i};return Hn(i)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(o),o}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,r,n=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",r,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:r});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,r)}catch(l){i.push(l)}});if(await Promise.all(o),i.length>0){for(let a=0;a<i.length;a+=1)console.error(i[a]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Ue(this.storage,`${this.storageKey}-code-verifier`);const r=Object.assign({},e),n=r.user&&r.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&r.user&&await Qt(this.userStorage,this.storageKey+"-user",{user:r.user});const s=Object.assign({},r);delete s.user;const i=Ni(s);await Qt(this.storage,this.storageKey,i)}else{const s=Ni(r);await Qt(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Ue(this.storage,this.storageKey),await Ue(this.storage,this.storageKey+"-code-verifier"),await Ue(this.storage,this.storageKey+"-user"),this.userStorage&&await Ue(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Me()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Xt);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e);const r=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=r,r&&typeof r=="object"&&typeof r.unref=="function"?r.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(r)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);const r=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,r&&clearTimeout(r)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async r=>{const{data:{session:n}}=r;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-e)/Xt);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Xt}ms, refresh threshold is ${hs} ticks`),s<=hs&&await this._callRefreshToken(n.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Wo)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Me()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const r=`#_onVisibilityChanged(${e})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,r,n){const s=[`provider=${encodeURIComponent(r)}`];if(n!=null&&n.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[i,o]=await Gt(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(a.toString())}if(n!=null&&n.queryParams){const i=new URLSearchParams(n.queryParams);s.push(i.toString())}return n!=null&&n.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async r=>{var n;const{data:s,error:i}=r;return i?this._returnResult({data:null,error:i}):await K(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token})})}catch(r){if(B(r))return this._returnResult({data:null,error:r});throw r}}async _enroll(e){try{return await this._useSession(async r=>{var n,s;const{data:i,error:o}=r;if(o)return this._returnResult({data:null,error:o});const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:l,error:u}=await K(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(n=i==null?void 0:i.session)===null||n===void 0?void 0:n.access_token});return u?this._returnResult({data:null,error:u}):(e.factorType==="totp"&&l.type==="totp"&&(!((s=l==null?void 0:l.totp)===null||s===void 0)&&s.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),this._returnResult({data:l,error:null}))})}catch(r){if(B(r))return this._returnResult({data:null,error:r});throw r}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async r=>{var n;const{data:s,error:i}=r;if(i)return this._returnResult({data:null,error:i});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?Dd(e.webauthn.credential_response):$d(e.webauthn.credential_response)})}:{code:e.code}),{data:a,error:l}=await K(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});return l?this._returnResult({data:null,error:l}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),this._returnResult({data:a,error:l}))})}catch(r){if(B(r))return this._returnResult({data:null,error:r});throw r}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async r=>{var n;const{data:s,error:i}=r;if(i)return this._returnResult({data:null,error:i});const o=await K(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});if(o.error)return o;const{data:a}=o;if(a.type!=="webauthn")return{data:a,error:null};switch(a.webauthn.type){case"create":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:Pd(a.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},a),{webauthn:Object.assign(Object.assign({},a.webauthn),{credential_options:Object.assign(Object.assign({},a.webauthn.credential_options),{publicKey:Ld(a.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(r){if(B(r))return this._returnResult({data:null,error:r});throw r}})}async _challengeAndVerify(e){const{data:r,error:n}=await this._challenge({factorId:e.factorId});return n?this._returnResult({data:null,error:n}):await this._verify({factorId:e.factorId,challengeId:r.id,code:e.code})}async _listFactors(){var e;const{data:{user:r},error:n}=await this.getUser();if(n)return{data:null,error:n};const s={all:[],phone:[],totp:[],webauthn:[]};for(const i of(e=r==null?void 0:r.factors)!==null&&e!==void 0?e:[])s.all.push(i),i.status==="verified"&&s[i.factor_type].push(i);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(){var e,r;const{data:{session:n},error:s}=await this.getSession();if(s)return this._returnResult({data:null,error:s});if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=Kn(n.access_token);let o=null;i.aal&&(o=i.aal);let a=o;((r=(e=n.user.factors)===null||e===void 0?void 0:e.filter(d=>d.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(a="aal2");const u=i.amr||[];return{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:u},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async r=>{const{data:{session:n},error:s}=r;return s?this._returnResult({data:null,error:s}):n?await K(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:n.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new et})})}catch(r){if(B(r))return this._returnResult({data:null,error:r});throw r}}async _approveAuthorization(e,r){try{return await this._useSession(async n=>{const{data:{session:s},error:i}=n;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new et});const o=await K(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"approve"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&Me()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(n){if(B(n))return this._returnResult({data:null,error:n});throw n}}async _denyAuthorization(e,r){try{return await this._useSession(async n=>{const{data:{session:s},error:i}=n;if(i)return this._returnResult({data:null,error:i});if(!s)return this._returnResult({data:null,error:new et});const o=await K(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"deny"},xform:a=>({data:a,error:null})});return o.data&&o.data.redirect_url&&Me()&&!(r!=null&&r.skipBrowserRedirect)&&window.location.assign(o.data.redirect_url),o})}catch(n){if(B(n))return this._returnResult({data:null,error:n});throw n}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:r},error:n}=e;return n?this._returnResult({data:null,error:n}):r?await K(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,xform:s=>({data:s,error:null})}):this._returnResult({data:null,error:new et})})}catch(e){if(B(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async r=>{const{data:{session:n},error:s}=r;return s?this._returnResult({data:null,error:s}):n?(await K(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new et})})}catch(r){if(B(r))return this._returnResult({data:null,error:r});throw r}}async fetchJwk(e,r={keys:[]}){let n=r.keys.find(a=>a.kid===e);if(n)return n;const s=Date.now();if(n=this.jwks.keys.find(a=>a.kid===e),n&&this.jwks_cached_at+Wu>s)return n;const{data:i,error:o}=await K(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=s,n=i.keys.find(a=>a.kid===e),!n)?null:n}async getClaims(e,r={}){try{let n=e;if(!n){const{data:p,error:v}=await this.getSession();if(v||!p.session)return this._returnResult({data:null,error:v});n=p.session.access_token}const{header:s,payload:i,signature:o,raw:{header:a,payload:l}}=Kn(n);r!=null&&r.allowExpired||fd(i.exp);const u=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,r!=null&&r.keys?{keys:r.keys}:r==null?void 0:r.jwks);if(!u){const{error:p}=await this.getUser(n);if(p)throw p;return{data:{claims:i,header:s,signature:o},error:null}}const d=gd(s.alg),g=await crypto.subtle.importKey("jwk",u,d,!0,["verify"]);if(!await crypto.subtle.verify(d,g,o,ed(`${a}.${l}`)))throw new ps("Invalid JWT signature");return{data:{claims:i,header:s,signature:o},error:null}}catch(n){if(B(n))return this._returnResult({data:null,error:n});throw n}}}Nr.nextInstanceID={};const Hd=Nr,Kd="2.90.1";let br="";typeof Deno<"u"?br="deno":typeof document<"u"?br="web":typeof navigator<"u"&&navigator.product==="ReactNative"?br="react-native":br="node";const Vd={"X-Client-Info":`supabase-js-${br}/${Kd}`},Jd={headers:Vd},Yd={schema:"public"},Xd={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Qd={};function Or(t){"@babel/helpers - typeof";return Or=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Or(t)}function Zd(t,e){if(Or(t)!="object"||!t)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var n=r.call(t,e);if(Or(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function eh(t){var e=Zd(t,"string");return Or(e)=="symbol"?e:e+""}function th(t,e,r){return(e=eh(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ui(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),r.push.apply(r,n)}return r}function Re(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Ui(Object(r),!0).forEach(function(n){th(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Ui(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}const rh=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),nh=()=>Headers,sh=(t,e,r)=>{const n=rh(r),s=nh();return async(i,o)=>{var a;const l=(a=await e())!==null&&a!==void 0?a:t;let u=new s(o==null?void 0:o.headers);return u.has("apikey")||u.set("apikey",t),u.has("Authorization")||u.set("Authorization",`Bearer ${l}`),n(i,Re(Re({},o),{},{headers:u}))}};function ih(t){return t.endsWith("/")?t:t+"/"}function oh(t,e){var r,n;const{db:s,auth:i,realtime:o,global:a}=t,{db:l,auth:u,realtime:d,global:g}=e,h={db:Re(Re({},l),s),auth:Re(Re({},u),i),realtime:Re(Re({},d),o),storage:{},global:Re(Re(Re({},g),a),{},{headers:Re(Re({},(r=g==null?void 0:g.headers)!==null&&r!==void 0?r:{}),(n=a==null?void 0:a.headers)!==null&&n!==void 0?n:{})}),accessToken:async()=>""};return t.accessToken?h.accessToken=t.accessToken:delete h.accessToken,h}function ah(t){const e=t==null?void 0:t.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(ih(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var lh=class extends Hd{constructor(t){super(t)}},ch=class{constructor(t,e,r){var n,s;this.supabaseUrl=t,this.supabaseKey=e;const i=ah(t);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const o=`sb-${i.hostname.split(".")[0]}-auth-token`,a={db:Yd,realtime:Qd,auth:Re(Re({},Xd),{},{storageKey:o}),global:Jd},l=oh(r??{},a);if(this.storageKey=(n=l.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(s=l.global.headers)!==null&&s!==void 0?s:{},l.accessToken)this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(d,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}});else{var u;this.auth=this._initSupabaseAuthClient((u=l.auth)!==null&&u!==void 0?u:{},this.headers,l.global.fetch)}this.fetch=sh(e,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Re({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.accessToken&&this.accessToken().then(d=>this.realtime.setAuth(d)).catch(d=>console.warn("Failed to set initial Realtime auth token:",d)),this.rest=new qc(new URL("rest/v1",i).href,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),this.storage=new Mu(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),l.accessToken||this._listenForAuthEvents()}get functions(){return new $c(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},r={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,e,r)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t=this,e,r;if(t.accessToken)return await t.accessToken();const{data:n}=await t.auth.getSession();return(e=(r=n.session)===null||r===void 0?void 0:r.access_token)!==null&&e!==void 0?e:t.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:r,storage:n,userStorage:s,storageKey:i,flowType:o,lock:a,debug:l,throwOnError:u},d,g){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new lh({url:this.authUrl.href,headers:Re(Re({},h),d),storageKey:i,autoRefreshToken:t,persistSession:e,detectSessionInUrl:r,storage:n,userStorage:s,flowType:o,lock:a,debug:l,throwOnError:u,fetch:g,hasCustomAuthorizationHeader:Object.keys(this.headers).some(p=>p.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new iu(this.realtimeUrl.href,Re(Re({},t),{},{params:Re(Re({},{apikey:this.supabaseKey}),t==null?void 0:t.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,e)=>{this._handleTokenChanged(t,"CLIENT",e==null?void 0:e.access_token)})}_handleTokenChanged(t,e,r){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const Ds=(t,e,r)=>new ch(t,e,r);function uh(){if(typeof window<"u")return!1;const t=globalThis.process;if(!t)return!1;const e=t.version;if(e==null)return!1;const r=e.match(/^v(\d+)\./);return r?parseInt(r[1],10)<=18:!1}uh()&&console.warn("âš ï¸  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");function Ko(t){let e=t.trim();return/^https?:\/\//i.test(e)||(e="https://"+e),e}function Ot(t){const e=Ko(t),r=new URL(e);r.hostname=r.hostname.toLowerCase(),(r.protocol==="https:"&&r.port==="443"||r.protocol==="http:"&&r.port==="80")&&(r.port="");const n=new Set(["fbclid","gclid","igshid","mc_cid","mc_eid","msclkid","ref","ref_src","spm"]);for(const i of Array.from(r.searchParams.keys()))(i.toLowerCase().startsWith("utm_")||n.has(i.toLowerCase()))&&r.searchParams.delete(i);const s=Array.from(r.searchParams.entries()).sort(([i],[o])=>i.localeCompare(o));r.search="";for(const[i,o]of s)r.searchParams.append(i,o);return r.pathname!=="/"&&(r.pathname=r.pathname.replace(/\/+$/,"")),r.hash="",r.toString()}function ms(t){try{return new URL(Ko(t)).hostname.toLowerCase()}catch{return""}}async function dh(t){const e=await crypto.subtle.digest("SHA-256",t),r=new Uint8Array(e);return Array.from(r).map(n=>n.toString(16).padStart(2,"0")).join("")}const hh="https://sudmwgwwlsdkpoxrnsji.supabase.co",fh="sb_publishable_NmAqx6bPjCKyu1BAAjhMVA_v2_JKJS2";let Yr=null;function qt(){if(Yr)return Yr;try{return Yr=Ds(hh,fh),Yr}catch(t){return console.error("Failed to initialize Supabase:",t),null}}async function gh(t){const e=qt();if(!e)return;const r=Ot(t.url),n=ms(r);if(!(!r||!n))try{const{data:s,error:i}=await e.from("gateway_metadata").select("canonical_url").eq("canonical_url",r).maybeSingle();if(i){console.warn("[GatewayMetadata] select failed:",i);return}if(s!=null&&s.canonical_url)return;const o={canonical_url:r,hostname:n,site_title:t.title??null,icon_url:t.iconUrl??null,updated_at:new Date().toISOString()},{error:a}=await e.from("gateway_metadata").insert(o);a&&console.warn("[GatewayMetadata] insert failed:",a)}catch(s){console.warn("[GatewayMetadata] upsert-if-missing failed:",s)}}async function ph(t){const e=qt();if(!e)return[];try{const{data:r,error:n}=await e.from("user_gateway_overrides").select("user_id, canonical_url, custom_title, custom_logo_path, custom_logo_url, custom_logo_signed_url, custom_logo_hash, updated_at").eq("user_id",t);return n?(console.warn("[GatewayOverrides] fetch failed:",n),[]):r||[]}catch(r){return console.warn("[GatewayOverrides] fetch exception:",r),[]}}async function mh(t){const e=qt();if(e)try{const{error:r}=await e.from("user_gateway_overrides").upsert({...t,updated_at:new Date().toISOString()},{onConflict:"user_id,canonical_url"});r&&console.warn("[GatewayOverrides] upsert failed:",r)}catch(r){console.warn("[GatewayOverrides] upsert exception:",r)}}async function bh(t){const e=qt();if(!e)return console.warn("[GatewayLogo] Supabase client not available"),null;try{const r=encodeURIComponent(t.canonicalUrl),n=`${t.userId}/${r}/${t.hash}.webp`;console.log("[GatewayLogo] Uploading logo:",{path:n,size:t.file.size,contentType:t.contentType});const{error:s}=await e.storage.from("gateway-logos").upload(n,t.file,{upsert:!0,contentType:t.contentType});if(s){const l=s.message||String(s);return console.error("[GatewayLogo] Upload failed:",{error:s,message:l}),l.includes("Bucket not found")||l.includes("not found")?console.error('[GatewayLogo] Bucket "gateway-logos" does not exist. Please create it in Supabase Storage.'):(l.includes("row-level security")||l.includes("RLS")||l.includes("permission")||l.includes("Forbidden")||l.includes("403"))&&console.error("[GatewayLogo] Permission denied. Check Storage bucket RLS policies. You may need to allow authenticated users to upload."),null}console.log("[GatewayLogo] Upload successful:",n);const{data:i}=e.storage.from("gateway-logos").getPublicUrl(n),o=(i==null?void 0:i.publicUrl)||null;let a=null;if(o)console.log("[GatewayLogo] Public URL:",o);else{console.log("[GatewayLogo] Bucket is private, generating signed URL...");try{const{data:l,error:u}=await e.storage.from("gateway-logos").createSignedUrl(n,31536e3);u?console.warn("[GatewayLogo] Failed to create signed URL:",u):l!=null&&l.signedUrl&&(a=l.signedUrl,console.log("[GatewayLogo] Signed URL generated (valid for 1 year)"))}catch(l){console.warn("[GatewayLogo] Exception creating signed URL:",l)}}return{path:n,publicUrl:o,signedUrl:a}}catch(r){return console.error("[GatewayLogo] Upload exception:",r),null}}async function yh(t){var r,n,s,i;if(!t.user)return;const e=qt();if(!e){const o=`cloud_sync_${t.user.id}`,a={links:t.links,requests:t.requests,language:t.language,theme:t.theme,version:t.version,updatedAt:new Date().toISOString()};localStorage.setItem(o,JSON.stringify(a));return}try{const o={links:t.links||[],requests:t.requests||[],language:t.language||"English",theme:t.theme||"light",version:t.version||"1.0.0",pinnedSnippetId:t.pinnedSnippetId||null};console.log("[Sync] Syncing to Supabase:",{userId:t.user.id,linksCount:o.links.length,requestsCount:o.requests.length});const{data:a,error:l}=await e.from("user_data").upsert({user_id:t.user.id,email:t.user.email,data:o,updated_at:new Date().toISOString()},{onConflict:"user_id"}).select();if(l)throw console.error("[Sync] Supabase error:",l),console.error("[Sync] Error details:",{code:l.code,message:l.message,details:l.details,hint:l.hint}),l;if(a&&a.length>0){const u=a[0].data;console.log(`[Sync] Successfully synced data for ${t.user.email}`,{links:((r=u.links)==null?void 0:r.length)||0,requests:((n=u.requests)==null?void 0:n.length)||0,language:u.language,theme:u.theme,savedAt:a[0].updated_at}),((s=u.links)==null?void 0:s.length)!==o.links.length&&console.warn("[Sync] Link count mismatch!",{sent:o.links.length,saved:(i=u.links)==null?void 0:i.length})}else console.warn("[Sync] Upsert succeeded but no data returned")}catch(o){console.error("[Sync] Failed to sync to cloud:",o);const a=`cloud_sync_${t.user.id}`;localStorage.setItem(a,JSON.stringify({links:t.links,requests:t.requests,language:t.language,theme:t.theme,version:t.version,updatedAt:new Date().toISOString()}))}}async function wh(t){var r,n;const e=qt();if(!e){const s=`cloud_sync_${t}`,i=localStorage.getItem(s);if(i)try{return JSON.parse(i)}catch{return null}return null}try{const{data:s,error:i}=await e.from("user_data").select("data, updated_at").eq("user_id",t).single();if(i){if(i.code==="PGRST116")return console.log("[Sync] No existing data for user, will create on first sync"),null;throw i}return s&&s.data?(console.log(`[Sync] Fetched data for user ${t}`,{links:((r=s.data.links)==null?void 0:r.length)||0,requests:((n=s.data.requests)==null?void 0:n.length)||0,language:s.data.language,theme:s.data.theme,lastUpdated:s.updated_at}),s.data):null}catch(s){console.error("[Sync] Failed to fetch from cloud:",s);const i=`cloud_sync_${t}`,o=localStorage.getItem(i);if(o)try{return JSON.parse(o)}catch{return null}return null}}async function Mi(t){if(t.user)try{await yh(t)}catch(e){console.warn("[Sync] Supabase sync failed, using localStorage fallback:",e);const r=`cloud_sync_${t.user.id}`,n={links:t.links,requests:t.requests,language:t.language,theme:t.theme,version:t.version,updatedAt:new Date().toISOString()};localStorage.setItem(r,JSON.stringify(n))}}async function vh(t){try{const n=await wh(t);if(n)return n}catch(n){console.warn("[Sync] Supabase fetch failed, trying localStorage fallback:",n)}const e=`cloud_sync_${t}`,r=localStorage.getItem(e);if(r)try{return JSON.parse(r)}catch{return null}return null}const xh="https://sudmwgwwlsdkpoxrnsji.supabase.co",_h="sb_publishable_NmAqx6bPjCKyu1BAAjhMVA_v2_JKJS2";let Xr=null;function $s(){if(Xr)return Xr;try{return Xr=Ds(xh,_h),Xr}catch(t){return console.error("[Subscription] Failed to initialize Supabase:",t),null}}async function Us(t){const e=$s();if(!e)return console.log("[Subscription] Supabase not configured, defaulting to free tier"),{isSubscribed:!1,subscriptionPlan:"free",subscriptionStatus:"active",subscriptionExpiresAt:null};try{const{data:r,error:n}=await e.from("user_subscriptions").select("is_subscribed, subscription_plan, subscription_status, subscription_expires_at").eq("user_id",t).single();if(n){if(n.code==="PGRST116"){console.log("[Subscription] No subscription record found, creating default free tier");const s={isSubscribed:!1,subscriptionPlan:"free",subscriptionStatus:"active",subscriptionExpiresAt:null};return await kh(t,s),s}return console.warn("[Subscription] fetchSubscriptionState error (ignored):",n),{isSubscribed:!1,subscriptionPlan:"free",subscriptionStatus:"active",subscriptionExpiresAt:null}}if(r){const s={isSubscribed:r.is_subscribed||!1,subscriptionPlan:r.subscription_plan||"free",subscriptionStatus:r.subscription_status||"active",subscriptionExpiresAt:r.subscription_expires_at||null};return console.log("[Subscription] Fetched subscription state:",s),s}return{isSubscribed:!1,subscriptionPlan:"free",subscriptionStatus:"active",subscriptionExpiresAt:null}}catch(r){return console.error("[Subscription] Failed to fetch subscription state:",r),{isSubscribed:!1,subscriptionPlan:"free",subscriptionStatus:"active",subscriptionExpiresAt:null}}}async function kh(t,e){const r=$s();if(r)try{const{error:n}=await r.from("user_subscriptions").insert({user_id:t,is_subscribed:e.isSubscribed,subscription_plan:e.subscriptionPlan,subscription_status:e.subscriptionStatus,subscription_expires_at:e.subscriptionExpiresAt});n&&console.error("[Subscription] Failed to create subscription record:",n)}catch(n){console.error("[Subscription] Error creating subscription record:",n)}}async function Sh(t,e){const r=$s();if(!r)return console.warn("[Subscription] Cannot update subscription: Supabase not configured"),!1;try{const n={};e.isSubscribed!==void 0&&(n.is_subscribed=e.isSubscribed),e.subscriptionPlan!==void 0&&(n.subscription_plan=e.subscriptionPlan),e.subscriptionStatus!==void 0&&(n.subscription_status=e.subscriptionStatus),e.subscriptionExpiresAt!==void 0&&(n.subscription_expires_at=e.subscriptionExpiresAt);const{error:s}=await r.from("user_subscriptions").upsert({user_id:t,...n,updated_at:new Date().toISOString()},{onConflict:"user_id"});return s?(console.error("[Subscription] Failed to update subscription:",s),!1):(console.log("[Subscription] Successfully updated subscription state"),!0)}catch(n){return console.error("[Subscription] Error updating subscription:",n),!1}}function Ft(t){if(!t)return"unauthenticated";const e=t.redeemEnabled??!0,r=t.memberViaRedeem===!0&&e,n=t.isSubscribed===!0,s=t.subscriptionStatus||"active",i=t.subscriptionExpiresAt;return n&&i&&new Date(i)<new Date?r?"authenticated_subscribed":"authenticated_free":n&&s==="active"||r?"authenticated_subscribed":"authenticated_free"}const vt={GATEWAYS:{FREE:5,SUBSCRIBED:1/0},INTENTIONS:{UNAUTHENTICATED:1,FREE:2,SUBSCRIBED:1/0}};function sr(t){if(!t.user)return"unauthenticated";const e=Ft(t.user);return e==="authenticated_free"&&t.subscriptionTier==="authenticated_subscribed"?t.subscriptionTier:e}function pr(t){return sr(t)==="authenticated_subscribed"}function Yn(t){return sr(t)==="unauthenticated"&&dn()>=2?{allowed:!1,reason:"context_needed"}:{allowed:!0}}function bs(t){const e=sr(t);if(e==="unauthenticated")return{allowed:!1,reason:"requires_auth"};if(e==="authenticated_free"){const r=t.links.length,n=vt.GATEWAYS.FREE;if(r>=n)return{allowed:!1,reason:"limit_reached"}}return{allowed:!0}}function Xn(t,e=!1){const r=sr(t);if(r==="unauthenticated")return e?t.requests.length>=vt.INTENTIONS.UNAUTHENTICATED?{allowed:!1,reason:"limit_reached"}:{allowed:!0}:{allowed:!1,reason:"requires_auth"};if(r==="authenticated_free"){const n=t.requests.filter(i=>i.active).length,s=vt.INTENTIONS.FREE;if(n>=s)return{allowed:!1,reason:"limit_reached"}}return{allowed:!0}}function dn(){const t=localStorage.getItem("perspectiveCount");return t?parseInt(t,10):0}function Fi(){const e=dn()+1;return localStorage.setItem("perspectiveCount",e.toString()),e}const Eh="https://sudmwgwwlsdkpoxrnsji.supabase.co",Ch="sb_publishable_NmAqx6bPjCKyu1BAAjhMVA_v2_JKJS2";let Qr=null;function En(){if(Qr)return Qr;try{return Qr=Ds(Eh,Ch),Qr}catch(t){return console.error("[Redeem] Failed to initialize Supabase:",t),null}}async function Rh(t,e){const r=En();if(!r)return{ok:!1,error_code:"NETWORK_ERROR",message:"Service unavailable. Please try again later."};if(!t||!t.id)return{ok:!1,error_code:"NOT_AUTHENTICATED",message:"Please sign in to redeem a code."};try{const n=e.trim().toUpperCase(),{data:s,error:i}=await r.from("redeem_codes").select("*").eq("code",n).single();if(i||!s)return{ok:!1,error_code:"INVALID_CODE",message:"Invalid code. Please check and try again."};if(s.status!=="enabled")return{ok:!1,error_code:"DISABLED_CODE",message:"This code has been disabled."};if(s.redeemed_at)return s.redeemed_by_user_id===t.id?{ok:!1,error_code:"ALREADY_REDEEMED",message:"You have already redeemed this code."}:{ok:!1,error_code:"ALREADY_REDEEMED",message:"This code has already been redeemed."};if(s.expires_at&&new Date(s.expires_at)<new Date)return{ok:!1,error_code:"EXPIRED_CODE",message:"This code has expired."};const o=new Date().toISOString(),{error:a}=await r.from("redeem_codes").update({redeemed_at:o,redeemed_by_user_id:t.id,redeemed_by_email:t.email}).eq("id",s.id).is("redeemed_at",null);if(a){const{data:d}=await r.from("redeem_codes").select("redeemed_at, redeemed_by_user_id").eq("id",s.id).single();return d!=null&&d.redeemed_at?d.redeemed_by_user_id===t.id?{ok:!1,error_code:"ALREADY_REDEEMED",message:"You have already redeemed this code."}:{ok:!1,error_code:"ALREADY_REDEEMED",message:"This code has already been redeemed."}:(console.error("[Redeem] Failed to update redeem code:",a),{ok:!1,error_code:"UNKNOWN_ERROR",message:"Failed to redeem code. Please try again."})}let l=null;const{data:u}=await r.from("user_membership").select("user_id, membership_since").eq("user_id",t.id).maybeSingle();if(u){const{error:d}=await r.from("user_membership").update({member_via_redeem:!0,redeem_code_id:s.id,membership_since:u.membership_since||o,updated_at:o}).eq("user_id",t.id);l=d,console.log("[Redeem] Updating existing membership")}else{const{error:d}=await r.from("user_data").upsert({user_id:t.id,email:t.email,data:{},updated_at:o},{onConflict:"user_id"});d&&console.warn("[Redeem] Failed to ensure user_data exists:",d);const{error:g}=await r.from("user_membership").insert({user_id:t.id,is_subscribed:!1,member_via_redeem:!0,redeem_code_id:s.id,membership_since:o,updated_at:o});l=g,console.log("[Redeem] Inserting new membership")}return l?(console.error("[Redeem] Failed to update membership:",l),console.error("[Redeem] Membership error details:",{code:l.code,message:l.message,details:l.details,hint:l.hint}),await r.from("redeem_codes").update({redeemed_at:null,redeemed_by_user_id:null,redeemed_by_email:null}).eq("id",s.id),{ok:!1,error_code:"UNKNOWN_ERROR",message:`Failed to update membership: ${l.message||"Please try again."}`}):{ok:!0,membership:{is_member:!0,member_via_redeem:!0}}}catch(n){return console.error("[Redeem] Error redeeming code:",n),{ok:!1,error_code:"UNKNOWN_ERROR",message:"An unexpected error occurred. Please try again."}}}async function xr(t){const e=En();if(!e)return null;try{const{data:r,error:n}=await e.from("user_membership").select("is_subscribed, member_via_redeem, membership_since").eq("user_id",t).single();return n?(n.code!=="PGRST116"&&console.warn("[Redeem] fetchUserMembership error (ignored):",n),{isSubscribed:!1,memberViaRedeem:!1,membershipSince:null}):{isSubscribed:r.is_subscribed||!1,memberViaRedeem:r.member_via_redeem||!1,membershipSince:r.membership_since||null}}catch(r){return console.error("[Redeem] Failed to fetch membership:",r),{isSubscribed:!1,memberViaRedeem:!1,membershipSince:null}}}async function _r(t){const e=En();if(!e){console.warn("[Redeem] Supabase not configured, checking localStorage fallback");try{const r=`user_settings_${t}`,n=localStorage.getItem(r);return n?{redeemEnabled:JSON.parse(n).redeem_enabled!==!1}:{redeemEnabled:!0}}catch(r){return console.error("[Redeem] Failed to read from localStorage:",r),{redeemEnabled:!0}}}try{const{data:r,error:n}=await e.from("user_settings").select("redeem_enabled").eq("user_id",t).single();return n?(n.code!=="PGRST116"&&console.warn("[Redeem] fetchUserSettings error (ignored):",n),{redeemEnabled:!0}):{redeemEnabled:r.redeem_enabled!==!1}}catch(r){console.error("[Redeem] Failed to fetch settings:",r);try{const n=`user_settings_${t}`,s=localStorage.getItem(n);if(s)return{redeemEnabled:JSON.parse(s).redeem_enabled!==!1}}catch(n){console.warn("[Redeem] localStorage fallback failed:",n)}return{redeemEnabled:!0}}}async function Th(t,e){const r=En();if(!r){console.warn("[Redeem] Supabase not configured, using localStorage fallback");try{const n=`user_settings_${t}`,s={redeem_enabled:e,updated_at:new Date().toISOString()};return localStorage.setItem(n,JSON.stringify(s)),console.log("[Redeem] Settings saved to localStorage:",s),!0}catch(n){return console.error("[Redeem] Failed to save to localStorage:",n),!1}}try{const{error:n}=await r.from("user_settings").upsert({user_id:t,redeem_enabled:e,updated_at:new Date().toISOString()},{onConflict:"user_id"});if(n){console.error("[Redeem] Failed to update settings:",n);try{const s=`user_settings_${t}`,i={redeem_enabled:e,updated_at:new Date().toISOString()};return localStorage.setItem(s,JSON.stringify(i)),console.log("[Redeem] Fallback: Settings saved to localStorage"),!0}catch(s){return console.error("[Redeem] Fallback to localStorage also failed:",s),!1}}return console.log("[Redeem] Settings updated successfully in Supabase"),!0}catch(n){console.error("[Redeem] Error toggling redeem feature:",n);try{const s=`user_settings_${t}`,i={redeem_enabled:e,updated_at:new Date().toISOString()};return localStorage.setItem(s,JSON.stringify(i)),console.log("[Redeem] Fallback: Settings saved to localStorage after exception"),!0}catch(s){return console.error("[Redeem] Fallback to localStorage also failed:",s),!1}}}const Vo="focus_tab_gateway_logo_cache";function jh(t){if(!t)return null;try{return JSON.parse(t)}catch{return null}}function Ms(){return jh(localStorage.getItem(Vo))||{}}function Jo(t){localStorage.setItem(Vo,JSON.stringify(t))}function Cn(t,e){const n=Ms()[t];return!n||e&&n.hash!==e?null:n.dataUrl}function ys(t,e){const r=Ms();r[t]=e,Jo(r)}function Ah(t){const e=Ms();delete e[t],Jo(e)}async function Nh(t,e,r,n){if(Cn(t,r))return!0;try{if(n)try{const l=qt();if(l){const{data:u,error:d}=await l.storage.from("gateway-logos").download(n);if(d)console.warn("[LogoCache] Supabase download failed, trying direct fetch:",d);else if(u){const g=new FileReader;return new Promise(h=>{g.onloadend=()=>{const p=g.result;p?(ys(t,{dataUrl:p,hash:r,updatedAt:Date.now()}),console.log(`[LogoCache] Downloaded and cached logo for ${t} (via Supabase)`),h(!0)):h(!1)},g.onerror=()=>{console.warn(`[LogoCache] Failed to read logo blob for ${t}`),h(!1)},g.readAsDataURL(u)})}}}catch(l){console.warn("[LogoCache] Supabase download exception, trying direct fetch:",l)}const i=await fetch(e,{mode:"cors",credentials:"omit"});if(!i.ok)return console.warn(`[LogoCache] Failed to download logo from ${e}:`,{status:i.status,statusText:i.statusText,url:e}),i.status===404&&console.warn(`[LogoCache] Logo file not found at ${e}. It may not have been uploaded successfully.`),!1;const o=await i.blob(),a=new FileReader;return new Promise(l=>{a.onloadend=()=>{const u=a.result;u?(ys(t,{dataUrl:u,hash:r,updatedAt:Date.now()}),console.log(`[LogoCache] Downloaded and cached logo for ${t}`),l(!0)):l(!1)},a.onerror=()=>{console.warn(`[LogoCache] Failed to read logo blob for ${t}`),l(!1)},a.readAsDataURL(o)})}catch(i){return console.warn(`[LogoCache] Exception downloading logo for ${t}:`,i),!1}}const hn="focus_tab_metadata_cache",Oh=30,Yo=60;function Ih(){const t=new Map;try{const e=localStorage.getItem(hn);if(e){const r=JSON.parse(e),n=Date.now();for(const[s,i]of Object.entries(r)){const o=i;if(o.cachedAt){const a=n-o.cachedAt,l=Yo*24*60*60*1e3;if(a<l){const{cachedAt:u,...d}=o;t.set(s,d)}}else t.set(s,o)}console.log(`[Metadata] Loaded ${t.size} cached items from storage`)}}catch(e){console.error("[Metadata] Failed to load cache from storage:",e)}return t}function Ph(t){try{const e={},r=Date.now();for(const[n,s]of t.entries())e[n]={...s,cachedAt:r};localStorage.setItem(hn,JSON.stringify(e))}catch(e){console.error("[Metadata] Failed to save cache to storage:",e);try{localStorage.removeItem(hn)}catch{}}}let Zr=null;function Bi(t){Zr&&clearTimeout(Zr),Zr=setTimeout(()=>{Ph(t),Zr=null},1e3)}function Lh(t){const r=Date.now()-t,n=Oh*24*60*60*1e3;return r>=n}function Dh(t){const r=Date.now()-t,n=Yo*24*60*60*1e3;return r>=n}function $h(t){try{const e=localStorage.getItem(hn);if(e){const n=JSON.parse(e)[t];return(n==null?void 0:n.cachedAt)||null}}catch{}return null}const Jt=Ih();function ws(t){const e=t.split("."),r=e.length>1?e[e.length-2]:e[0];return r.charAt(0).toUpperCase()+r.slice(1)}function Uh(t,e){return Promise.race([t,new Promise((r,n)=>setTimeout(()=>n(new Error("Timeout")),e))])}function Mh(t){const e=t.split(".");return e.length<=2?null:e.slice(-2).join(".")}function qi(t,e=1500){return new Promise(r=>{const n=new Image,s=setTimeout(()=>{n.onload=null,n.onerror=null,r(!1)},e);n.onload=()=>{clearTimeout(s),r(!0)},n.onerror=()=>{clearTimeout(s),r(!1)},n.src=t})}async function zi(t){const e=`https://www.google.com/s2/favicons?domain=${t}&sz=128`,r=`https://icons.duckduckgo.com/ip3/${t}.ico`,n=`https://${t}/favicon.ico`,s=[{url:e,priority:1},{url:r,priority:2},{url:n,priority:3}],i=await Promise.allSettled(s.map(({url:a})=>qi(a,1500).then(l=>l?a:Promise.reject())));for(const a of i)if(a.status==="fulfilled")return a.value;const o=Mh(t);if(o){const a=`https://www.google.com/s2/favicons?domain=${o}&sz=128`;if(await qi(a,1e3))return a}return e}async function Wi(t,e){const r=[`https://api.allorigins.win/get?url=${encodeURIComponent(t)}`,`https://corsproxy.io/?${encodeURIComponent(t)}`];try{const n=r.map(i=>Uh(fetch(i).then(o=>o.json()).then(o=>{var p,v,b;let a;if(o.contents)a=o.contents;else if(typeof o=="string")a=o;else throw new Error("No content found");const u=new DOMParser().parseFromString(a,"text/html"),d=(p=u.querySelector('meta[property="og:site_name"]'))==null?void 0:p.getAttribute("content");if(d)return d;const g=(v=u.querySelector('meta[name="application-name"]'))==null?void 0:v.getAttribute("content");if(g)return g;const h=(b=u.querySelector("title"))==null?void 0:b.textContent;if(h){const m=h.replace(/\s*[-|]\s*.+$/,"").trim();if(m)return m}throw new Error("No content found")}),2e3)),s=await Promise.allSettled(n);for(const i of s)if(i.status==="fulfilled")return i.value}catch(n){console.log("Failed to fetch site name:",n)}return ws(e)}async function Fh(t){try{const e=Ot(t),r=ms(e);if(!r)throw new Error("Invalid URL");const n=e,s=Jt.get(n);if(s){const o=$h(n);if(o)if(Dh(o))Jt.delete(n),console.log(`[Metadata] Cache expired for ${r}, fetching fresh data`);else return Lh(o)?(console.log(`[Metadata] Cache stale for ${r}, using cached data, refreshing in background`),Promise.all([zi(r).catch(()=>s.icon),Wi(e,r).catch(()=>s.title)]).then(([a,l])=>{const u={url:e,title:l,icon:a};Jt.set(n,u),Bi(Jt),console.log(`[Metadata] Background refresh completed for ${r}`)}).catch(a=>{console.log(`[Metadata] Background refresh failed for ${r}, keeping cached data:`,a)}),{...s,url:e}):{...s,url:e};else return{...s,url:e}}const i={url:e,title:ws(r),icon:`https://www.google.com/s2/favicons?domain=${r}&sz=128`};return Promise.all([zi(r).catch(()=>i.icon),Wi(e,r).catch(()=>i.title)]).then(([o,a])=>{const l={url:e,title:a,icon:o};Jt.set(n,l),Bi(Jt),gh({url:e,title:a,iconUrl:o}).catch(()=>{})}).catch(o=>{console.log("Background metadata fetch failed:",o)}),i}catch(e){console.error("Metadata fetch error:",e);try{const r=Ot(t),n=ms(r);return{url:r,title:ws(n||"link"),icon:`https://www.google.com/s2/favicons?domain=${n||"example.com"}&sz=128`}}catch{return null}}}async function Bh(t){const{file:e,size:r,quality:n}=t;try{const s=await createImageBitmap(e),i=document.createElement("canvas");i.width=r,i.height=r;const o=i.getContext("2d");if(!o)return null;const a=Math.min(s.width,s.height),l=(s.width-a)/2,u=(s.height-a)/2;o.drawImage(s,l,u,a,a,0,0,r,r);const g=await new Promise(m=>i.toBlob(x=>m(x),"image/webp",n))||await new Promise(m=>i.toBlob(x=>m(x),"image/png")),h=g.type||"image/webp",p=await g.arrayBuffer(),v=await dh(p),b=await new Promise(m=>{const x=new FileReader;x.onload=()=>m(x.result),x.readAsDataURL(g)});return{blob:g,dataUrl:b,hash:v,contentType:h}}catch{return null}}const qh=({isOpen:t,onClose:e,onUpgrade:r,feature:n,theme:s})=>{if(!t)return null;const o={gateways:{title:"Unlock more gateways",description:"Organize all your important destinations in one place.",highlight:"Unlimited Gateways",secondaryCta:"Maybe later"},intentions:{title:"More ways to start your day, softly",description:"Pro lets you create unlimited themes and rotate them naturally, so each day fits how you feel.",highlight:"Unlimited Intentions",secondaryCta:"Keep 2 themes"}}[n],a=()=>{r(),e()};return c.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center p-4 bg-black/20 dark:bg-black/80 backdrop-blur-xl animate-reveal",children:c.jsx("div",{className:"bg-white dark:bg-[#0F0F0F] w-full max-w-md rounded-[3.5rem] shadow-[0_40px_100px_-20px_rgba(0,0,0,0.25)] overflow-hidden",children:c.jsxs("div",{className:"px-12 pt-12 pb-8",children:[c.jsx("h2",{className:"serif text-3xl md:text-4xl font-normal text-gray-800 dark:text-gray-100 mb-4",children:o.title}),c.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 leading-relaxed mb-6",children:o.description}),c.jsx("div",{className:"mb-8 p-6 bg-indigo-50 dark:bg-indigo-950/20 rounded-3xl border border-indigo-100 dark:border-indigo-900/30",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("svg",{className:"w-6 h-6 text-indigo-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),c.jsx("span",{className:"text-sm font-semibold text-indigo-700 dark:text-indigo-300",children:o.highlight})]})}),c.jsxs("div",{className:"flex flex-col gap-4",children:[c.jsx("button",{onClick:a,className:"w-full py-5 bg-black dark:bg-white text-white dark:text-black rounded-full text-[11px] font-bold uppercase tracking-widest hover:opacity-90 transition-all active:scale-95 shadow-xl shadow-black/10",children:"Get Pro"}),c.jsx("button",{onClick:e,className:"w-full py-4 text-gray-500 dark:text-gray-400 text-sm font-medium hover:text-gray-700 dark:hover:text-gray-200 transition-colors",children:o.secondaryCta}),n==="intentions"&&c.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 text-center mt-2",children:"Cancel anytime Â· No ads"})]})]})})})},Xo=({isOpen:t,link:e,onClose:r,onSave:n,categories:s})=>{const[i,o]=f.useState(""),[a,l]=f.useState(""),[u,d]=f.useState(null),[g,h]=f.useState(null),[p,v]=f.useState(!1),[b,m]=f.useState("");f.useEffect(()=>{!t||!e||(o(e.url||""),l(e.customTitle||""),m(e.category||"Shortcuts"),d(null),h(null),v(!1))},[t,e]),f.useEffect(()=>{if(u){const w=URL.createObjectURL(u);return h(w),()=>{URL.revokeObjectURL(w)}}else h(null)},[u]);const x=f.useMemo(()=>{if(!e)return"";try{return e.canonicalUrl||Ot(e.url)}catch{return e.url}},[e]),_=f.useMemo(()=>{if(!e||p)return null;if(g)return g;if(x&&e.customLogoHash){const w=Cn(x,e.customLogoHash);if(w)return w}return e.customLogoUrl?e.customLogoUrl:e.icon||null},[e,x,p,g]);return!t||!e?null:c.jsx("div",{className:"fixed inset-0 z-[100050] flex items-center justify-center p-4 bg-black/20 dark:bg-black/80 backdrop-blur-xl animate-reveal",children:c.jsx("div",{className:"bg-white dark:bg-[#0F0F0F] w-full max-w-lg rounded-[3rem] shadow-[0_40px_100px_-20px_rgba(0,0,0,0.25)] overflow-hidden border border-black/5 dark:border-white/10",children:c.jsxs("div",{className:"p-8",children:[c.jsxs("div",{className:"flex items-start justify-between gap-6",children:[c.jsxs("div",{children:[c.jsx("h3",{className:"serif text-2xl text-gray-900 dark:text-gray-100",children:"Edit Gateway"}),c.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Customize details. Leave empty to use default."})]}),c.jsx("button",{onClick:()=>{i!==e.url||a!==(e.customTitle||"")||u!==null||p||b!==(e.category||"Shortcuts")?window.confirm("You have unsaved changes. Are you sure you want to discard them?")&&r():r()},className:"w-10 h-10 rounded-2xl bg-gray-100 dark:bg-white/5 flex items-center justify-center text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-100 transition-colors","aria-label":"Close",children:"Ã—"})]}),c.jsxs("div",{className:"mt-7 space-y-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:"URL"}),c.jsx("input",{type:"text",value:i,onChange:w=>o(w.target.value),className:"mt-2 w-full bg-gray-50 dark:bg-white/5 border border-black/5 dark:border-white/5 rounded-2xl px-5 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500/20 text-gray-800 dark:text-gray-100"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:"Group"}),c.jsx("select",{value:b,onChange:w=>m(w.target.value),className:"mt-2 w-full bg-gray-50 dark:bg-white/5 border border-black/5 dark:border-white/5 rounded-2xl px-5 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500/20 text-gray-800 dark:text-gray-100 appearance-none",children:s.map(w=>c.jsx("option",{value:w,children:w},w))})]}),c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"w-14 h-14 rounded-2xl bg-gray-100 dark:bg-white/5 border border-black/5 dark:border-white/10 flex items-center justify-center overflow-hidden",children:_?c.jsx("img",{src:_,alt:"",className:"w-9 h-9 object-contain opacity-90"}):c.jsx("div",{className:"w-3.5 h-3.5 rounded-full",style:{backgroundColor:e.color}})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:"Custom name"}),c.jsx("input",{type:"text",value:a,onChange:w=>l(w.target.value),disabled:p,placeholder:e.title,className:"mt-2 w-full bg-gray-50 dark:bg-white/5 border border-black/5 dark:border-white/5 rounded-2xl px-5 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500/20 text-gray-800 dark:text-gray-100 disabled:opacity-60"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:"Upload logo"}),c.jsxs("div",{className:"mt-2 flex items-center gap-3",children:[c.jsx("input",{type:"file",accept:"image/*",disabled:p,onChange:w=>{var C;return d(((C=w.target.files)==null?void 0:C[0])||null)},className:"flex-1 text-xs text-gray-600 dark:text-gray-300 file:mr-3 file:rounded-full file:border-0 file:bg-gray-100 file:px-4 file:py-2 file:text-[11px] file:font-bold file:uppercase file:tracking-widest file:text-gray-700 dark:file:bg-white/10 dark:file:text-gray-200"}),u&&c.jsx("span",{className:"text-[11px] text-gray-500 dark:text-gray-400 truncate max-w-[160px]",children:u.name})]}),c.jsx("p",{className:"text-[11px] text-gray-400 dark:text-gray-500 mt-2",children:"Weâ€™ll store the uploaded image locally for fast display and back it up to Supabase."})]}),c.jsxs("div",{className:"flex items-center justify-between bg-gray-50/50 dark:bg-white/5 border border-black/5 dark:border-white/10 rounded-2xl px-5 py-4",children:[c.jsxs("div",{children:[c.jsx("div",{className:"text-xs font-semibold text-gray-800 dark:text-gray-100",children:"Reset to default"}),c.jsx("div",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:"Clears custom name and logo."})]}),c.jsx("button",{type:"button",onClick:()=>v(w=>!w),className:`px-4 py-2 rounded-full text-[11px] font-bold uppercase tracking-widest transition-all ${p?"bg-black dark:bg-white text-white dark:text-black":"bg-white dark:bg-black/20 text-gray-700 dark:text-gray-200 border border-black/5 dark:border-white/10"}`,children:p?"Resetting":"Reset"})]})]}),c.jsxs("div",{className:"mt-8 flex items-center justify-end gap-3",children:[c.jsx("button",{onClick:r,className:"px-6 py-3 rounded-full text-[11px] font-bold uppercase tracking-widest bg-gray-100 dark:bg-white/5 text-gray-700 dark:text-gray-200 hover:opacity-90 transition-all",children:"Cancel"}),c.jsx("button",{onClick:()=>n({url:i,customTitle:a.trim()?a.trim():null,logoFile:u,reset:p,category:b}),className:"px-6 py-3 rounded-full text-[11px] font-bold uppercase tracking-widest bg-black dark:bg-white text-white dark:text-black hover:opacity-90 transition-all",children:"Save Changes"})]})]})})})},zh=({isOpen:t,onClose:e,state:r,updateState:n,addToast:s,onSignIn:i,onSignOut:o})=>{var Pe,je,j,q,M,O;const[a,l]=f.useState(""),[u,d]=f.useState(""),[g,h]=f.useState("links"),[p,v]=f.useState(!1),[b,m]=f.useState(!1),[x,_]=f.useState(null),[w,C]=f.useState(!1),[P,k]=f.useState("gateways"),[E,A]=f.useState(null),[L,X]=f.useState(!1),[J,re]=f.useState(""),[me,Ne]=f.useState(!1),[ye,Ve]=f.useState({type:null,message:""});if(f.useEffect(()=>{if(!t||!r.user)return;(g==="links"||g==="snippets")&&(async()=>{try{const[I,D]=await Promise.all([xr(r.user.id),_r(r.user.id)]);if(I||D){const $=r.user,Y={...$,...I&&{memberViaRedeem:I.memberViaRedeem,membershipSince:I.membershipSince},...D&&{redeemEnabled:D.redeemEnabled}},Q=Ft(Y);(Y.memberViaRedeem!==$.memberViaRedeem||Y.redeemEnabled!==$.redeemEnabled||Q!==r.subscriptionTier)&&(n(H=>({...H,user:Y,subscriptionTier:Q})).catch(H=>console.error("[Settings] Failed to update state:",H)),console.log("[Settings] Membership state refreshed:",{memberViaRedeem:Y.memberViaRedeem,redeemEnabled:Y.redeemEnabled,subscriptionTier:Q}))}}catch(I){console.error("[Settings] Failed to refresh membership state:",I)}})()},[g,t]),!t)return null;const Ee=async S=>{if(S.preventDefault(),!a||b)return;sr(r);const I=!!r.user,D=r.links.length;if(I&&!pr(r)&&D>=vt.GATEWAYS.FREE){k("gateways"),C(!0);return}const $=bs(r);if(!$.allowed){$.reason==="limit_reached"?(k("gateways"),C(!0)):$.reason==="requires_auth"&&(s("Please sign in to add gateways","info"),i());return}m(!0);const Y=`gateway-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;_(Y);let Q=a.trim();/^https?:\/\//i.test(Q)||(Q="https://"+Q);let H;try{H=Ot(Q)}catch{H=void 0}let be="Gateway";try{const le=new URL(Q).hostname,se=le.split(".");be=se.length>1?se[se.length-2].charAt(0).toUpperCase()+se[se.length-2].slice(1):le.charAt(0).toUpperCase()+le.slice(1)}catch{}const ne={id:Y,url:H||Q,title:"Fetching details...",icon:null,color:ai[Math.floor(Math.random()*ai.length)],canonicalUrl:H},he={...r,links:[...r.links,ne]};n(he).catch(le=>console.error("[Settings] Optimistic update failed:",le));const Je=Q;l("");try{const le=await Fh(Je),se={id:Y,url:(le==null?void 0:le.url)||H||Q,title:(le==null?void 0:le.title)||be,icon:(le==null?void 0:le.icon)||null,color:ne.color,canonicalUrl:H||(le==null?void 0:le.url)||Q,customTitle:null,customLogoPath:null,customLogoUrl:null,customLogoHash:null},ce=he.links.map(Ze=>Ze.id===Y?se:Ze),Fe={...he,links:ce};try{await n(Fe),console.log("[Settings] Gateway added and synced to Supabase:",se.url),le?s("Gateway added","success"):s("Gateway added (using fallback details)","info")}catch(Ze){console.error("[Settings] Failed to sync gateway:",Ze),s("Gateway added locally, but sync failed. Please refresh and try again.","error")}}catch{const se={id:Y,url:H||Q,title:be,icon:null,color:ne.color,canonicalUrl:H||Q,customTitle:null,customLogoPath:null,customLogoUrl:null,customLogoHash:null},ce=he.links.map(Ze=>Ze.id===Y?se:Ze),Fe={...he,links:ce};try{await n(Fe),s("Gateway added (using fallback details)","info")}catch(Ze){console.error("[Settings] Failed to sync fallback gateway:",Ze),s("Gateway added locally, but sync failed.","error")}}finally{m(!1),_(null)}},st=S=>{A(S),X(!0)},qe=async S=>{var Je,le;if(!E)return;const I=(Je=r.user)==null?void 0:Je.id;let D=E.canonicalUrl;if(!D)try{D=Ot(E.url)}catch{D=E.url}const $=S.reset,Y=$?null:((le=S.customTitle)==null?void 0:le.trim())||null;let Q=$?null:E.customLogoHash||null,H=$?null:E.customLogoPath||null,be=$?null:E.customLogoUrl||null,ne=$?null:E.customLogoSignedUrl||null;if($&&Ah(D),!$&&S.logoFile)try{const se=await Bh({file:S.logoFile,size:128,quality:.86});if(se&&(ys(D,{dataUrl:se.dataUrl,hash:se.hash,updatedAt:Date.now()}),Q=se.hash,I))try{const ce=await bh({userId:I,canonicalUrl:D,file:se.blob,contentType:se.contentType,hash:se.hash});ce&&ce.path?(H=ce.path,be=ce.publicUrl||null,ne=ce.signedUrl||null,console.log("[Settings] Logo uploaded successfully:",{path:ce.path,hasPublicUrl:!!ce.publicUrl,hasSignedUrl:!!ce.signedUrl})):(console.error("[Settings] Upload returned null or no path"),s("Failed to upload logo to cloud. Logo saved locally only.","error"))}catch(ce){console.error("[Settings] Failed to upload logo to cloud:",ce);const Fe=(ce==null?void 0:ce.message)||"Unknown error";Fe.includes("Bucket not found")||Fe.includes("not found")?s("Storage bucket not found. Please check Supabase configuration.","error"):Fe.includes("row-level security")||Fe.includes("RLS")?s("Permission denied. Please check Storage bucket permissions.","error"):s("Failed to upload logo to cloud. Logo saved locally only.","error")}}catch(se){console.error("[Settings] Failed to process logo image:",se),s("Failed to process image. Please try another file.","error");return}const he={...r,links:r.links.map(se=>se.id!==E.id?se:{...se,canonicalUrl:D,customTitle:Y,customLogoHash:Q,customLogoPath:H,customLogoUrl:be,customLogoSignedUrl:ne})};if(await n(he),I){const se={customTitle:E.customTitle||null,customLogoPath:E.customLogoPath||null,customLogoUrl:E.customLogoUrl||null,customLogoSignedUrl:E.customLogoSignedUrl||null,customLogoHash:E.customLogoHash||null},ce={customTitle:Y,customLogoPath:H,customLogoUrl:be,customLogoSignedUrl:ne,customLogoHash:Q};(se.customTitle!==ce.customTitle||se.customLogoPath!==ce.customLogoPath||se.customLogoUrl!==ce.customLogoUrl||se.customLogoSignedUrl!==ce.customLogoSignedUrl||se.customLogoHash!==ce.customLogoHash)&&await mh({user_id:I,canonical_url:D,custom_title:ce.customTitle,custom_logo_path:ce.customLogoPath,custom_logo_url:ce.customLogoUrl,custom_logo_signed_url:ce.customLogoSignedUrl,custom_logo_hash:ce.customLogoHash})}s("Gateway updated","success"),X(!1),A(null)},it=async S=>{const I={...r,links:r.links.filter(D=>D.id!==S)};try{await n(I),console.log("[Settings] Gateway removed and synced to Supabase:",S),s("Gateway removed","success")}catch(D){console.error("[Settings] Failed to sync removal:",D),s("Failed to remove gateway. Please try again.","error"),n(r)}},Xe=async S=>{if(S.preventDefault(),!u)return;sr(r);const I=!!r.user,D=r.requests.filter(H=>H.active).length;if(I&&!pr(r)&&D>=vt.INTENTIONS.FREE){k("intentions"),C(!0);return}const $=Xn(r,!1);if(!$.allowed){$.reason==="limit_reached"?(k("intentions"),C(!0)):$.reason==="requires_auth"&&(s("Please sign in to add intentions","info"),i());return}const Y={id:Date.now().toString(),prompt:u,active:!0},Q={...r,requests:[...r.requests,Y]};try{await n(Q),d(""),s("Seed planted","success")}catch(H){console.error("[Settings] Failed to sync snippet:",H),s("Failed to save. Please try again.","error")}},Te=()=>{s("Subscription coming soon","info")},De=async S=>{const I=r.requests.find($=>$.id===S);if(!I)return;if(!I.active){const $=!!r.user,Y=r.requests.filter(H=>H.active).length;if($&&!pr(r)&&Y>=vt.INTENTIONS.FREE){k("intentions"),C(!0);return}const Q=Xn(r,!1);if(!Q.allowed&&Q.reason==="limit_reached"){k("intentions"),C(!0);return}}const D={...r,requests:r.requests.map($=>$.id===S?{...$,active:!$.active}:$)};try{await n(D)}catch($){console.error("[Settings] Failed to sync snippet toggle:",$),s("Failed to save. Please try again.","error")}},Qe=async S=>{const I={...r,requests:r.requests.filter(D=>D.id!==S)};try{await n(I),s("Seed removed","success")}catch(D){console.error("[Settings] Failed to sync snippet removal:",D),s("Failed to remove. Please try again.","error")}};return c.jsxs("div",{className:"fixed inset-0 z-[110] flex items-center justify-center p-4 bg-black/20 dark:bg-black/80 backdrop-blur-xl animate-reveal",children:[c.jsxs("div",{className:"bg-white dark:bg-[#0F0F0F] w-full max-w-2xl rounded-[3.5rem] shadow-[0_40px_100px_-20px_rgba(0,0,0,0.25)] overflow-hidden flex flex-col",style:{maxHeight:"min(80vh, 720px)"},children:[c.jsxs("div",{className:"px-12 pt-12 pb-8 flex justify-between items-end flex-shrink-0",children:[c.jsxs("div",{children:[c.jsx("h2",{className:"logo-text text-4xl md:text-5xl font-normal text-gray-800 dark:text-gray-100 tracking-tight",children:si.name}),c.jsx("p",{className:"text-[10px] font-bold text-indigo-500 uppercase tracking-[0.3em] mt-2",children:si.slogan})]}),c.jsx("button",{onClick:e,className:"p-4 bg-gray-50 dark:bg-white/5 hover:bg-gray-100 dark:hover:bg-white/10 rounded-2xl transition-all active:scale-95",children:c.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsx("div",{className:"flex px-12 border-b border-black/5 dark:border-white/5 no-scrollbar overflow-x-auto flex-shrink-0 sticky top-0 z-10 bg-white dark:bg-[#0F0F0F]",children:["links","snippets","language","redeem","account"].map(S=>c.jsx("button",{onClick:()=>h(S),className:`py-6 px-1 mr-10 whitespace-nowrap text-[10px] font-bold uppercase tracking-[0.2em] transition-all border-b-2 ${g===S?"border-indigo-500 text-indigo-500":"border-transparent text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"}`,children:S==="links"?"Gateways":S==="snippets"?"Intentions":S==="redeem"?"Redeem Code":S},S))}),c.jsxs("div",{className:"flex-1 overflow-y-auto px-12 py-10 no-scrollbar space-y-12",children:[g==="links"&&c.jsxs("div",{className:"space-y-10 animate-reveal",children:[r.user&&c.jsx("div",{className:"mb-6 p-4 bg-gray-50/50 dark:bg-white/5 rounded-2xl border border-black/5 dark:border-white/5",children:c.jsxs("div",{className:"flex items-center justify-between text-sm",children:[c.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Gateways"}),c.jsxs("span",{className:"font-semibold text-gray-800 dark:text-gray-200",children:[r.links.length," / ",pr(r)?"âˆ":vt.GATEWAYS.FREE]})]})}),(()=>{const S=bs(r),I=!S.allowed&&S.reason==="limit_reached";return!S.allowed&&S.reason==="requires_auth"?c.jsxs("div",{className:"space-y-4",children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:"Add Gateway"}),c.jsx("div",{className:"p-8 bg-gray-50 dark:bg-white/5 rounded-3xl border border-dashed border-gray-200 dark:border-white/10",children:c.jsxs("div",{className:"flex flex-col items-center text-center",children:[c.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6 leading-relaxed",children:"Sign in to add and sync your gateways across devices."}),c.jsx("button",{onClick:i,className:"px-6 py-3 bg-black dark:bg-white text-white dark:text-black rounded-full text-[11px] font-bold uppercase tracking-widest hover:opacity-90 transition-all",children:"Sign In"})]})})]}):I?c.jsxs("div",{className:"space-y-4",children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:"Add Gateway"}),c.jsx("div",{className:"p-8 bg-indigo-50 dark:bg-indigo-950/20 rounded-3xl border border-indigo-100 dark:border-indigo-900/30",children:c.jsxs("div",{className:"flex items-start gap-4",children:[c.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-xl bg-indigo-500 flex items-center justify-center",children:c.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"text-sm font-semibold text-gray-800 dark:text-gray-100 mb-2",children:"Gateway limit reached"}),c.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-4 leading-relaxed",children:"You've reached the maximum of 5 gateways on the free plan. Upgrade to unlock unlimited gateways and organize all your important destinations."}),c.jsx("button",{onClick:()=>{const $=window.location.origin+"/subscription";window.open($,"_blank")},className:"px-6 py-3 bg-black dark:bg-white text-white dark:text-black rounded-full text-[11px] font-bold uppercase tracking-widest hover:opacity-90 transition-all",children:"Upgrade"})]})]})})]}):c.jsxs("form",{onSubmit:Ee,className:"space-y-4",children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:"Add Gateway"}),c.jsxs("div",{className:"flex gap-4",children:[c.jsx("input",{type:"text",placeholder:"https://...",value:a,onChange:$=>l($.target.value),className:"flex-1 bg-gray-50 dark:bg-white/5 border border-black/5 dark:border-white/5 rounded-3xl px-6 py-4 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500/20 text-gray-800 dark:text-gray-100"}),c.jsx("button",{type:"submit",className:"bg-black dark:bg-white text-white dark:text-black px-8 rounded-3xl text-[11px] font-bold uppercase tracking-widest hover:opacity-90 transition-all",children:"Add"})]})]})})(),c.jsxs("div",{className:"space-y-4",children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:"Active Gateways"}),c.jsx("div",{className:"grid grid-cols-1 gap-3",children:r.links.map(S=>{const I=S.id===x&&b,D=S.canonicalUrl||(()=>{try{return Ot(S.url)}catch{return S.url}})(),Y=(S.customLogoHash?Cn(D,S.customLogoHash):null)||S.customLogoUrl||S.icon;return c.jsxs("div",{className:"flex items-center justify-between p-5 bg-gray-50/50 dark:bg-white/5 rounded-3xl border border-transparent hover:border-black/5 transition-all",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("div",{className:"w-11 h-11 rounded-xl bg-white dark:bg-gray-800 flex items-center justify-center shadow-sm",children:I?c.jsx("div",{className:"w-6 h-6 border-2 border-gray-300 dark:border-gray-600 border-t-transparent rounded-full animate-spin"}):Y?c.jsx("img",{src:Y,className:"w-6 h-6 object-contain opacity-60",alt:"",onError:Q=>{const H=Q.target;H.style.display="none";const be=H.parentElement;if(be){const ne=document.createElement("div");ne.className="w-3 h-3 rounded-full",ne.style.backgroundColor=S.color,be.appendChild(ne)}}}):c.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:S.color}})}),c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{className:`text-sm font-semibold ${I?"text-gray-400 dark:text-gray-600":"text-gray-700 dark:text-gray-200"}`,children:S.customTitle||S.title}),c.jsx("span",{className:"text-[10px] text-gray-400 truncate max-w-[200px]",children:S.url})]})]}),c.jsxs("div",{className:"flex items-center",children:[c.jsx("button",{onClick:()=>st(S),className:"p-3 text-gray-300 hover:text-gray-700 dark:hover:text-gray-100 transition-colors",disabled:I,"aria-label":"Edit gateway",children:c.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16.862 4.487a2.1 2.1 0 012.97 2.97L8.5 18.79 4 20l1.21-4.5L16.862 4.487z"})})}),c.jsx("button",{onClick:()=>it(S.id),className:"p-3 text-gray-300 hover:text-red-500 transition-colors",disabled:I,"aria-label":"Remove gateway",children:c.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7"})})})]})]},S.id)})})]})]}),c.jsx(Xo,{isOpen:L,link:E,onClose:()=>{X(!1),A(null)},onSave:qe}),g==="snippets"&&c.jsxs("div",{className:"space-y-10 animate-reveal",children:[r.user&&c.jsx("div",{className:"mb-6 p-4 bg-gray-50/50 dark:bg-white/5 rounded-2xl border border-black/5 dark:border-white/5",children:c.jsxs("div",{className:"flex items-center justify-between text-sm",children:[c.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Intentions"}),c.jsxs("span",{className:"font-semibold text-gray-800 dark:text-gray-200",children:[r.requests.filter(S=>S.active).length," / ",pr(r)?"âˆ":vt.INTENTIONS.FREE]})]})}),(()=>{const S=Xn(r),I=!S.allowed&&S.reason==="limit_reached";return!S.allowed&&S.reason==="requires_auth"?c.jsxs("div",{className:"space-y-4",children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:"New Seed"}),c.jsx("div",{className:"p-8 bg-gray-50 dark:bg-white/5 rounded-3xl border border-dashed border-gray-200 dark:border-white/10",children:c.jsxs("div",{className:"flex flex-col items-center text-center",children:[c.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6 leading-relaxed",children:"Sign in to create and manage your intentions."}),c.jsx("button",{onClick:i,className:"px-6 py-3 bg-black dark:bg-white text-white dark:text-black rounded-full text-[11px] font-bold uppercase tracking-widest hover:opacity-90 transition-all",children:"Sign In"})]})})]}):I?c.jsxs("div",{className:"space-y-4",children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:"New Seed"}),c.jsx("div",{className:"p-8 bg-indigo-50 dark:bg-indigo-950/20 rounded-3xl border border-indigo-100 dark:border-indigo-900/30",children:c.jsxs("div",{className:"flex items-start gap-4",children:[c.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-xl bg-indigo-500 flex items-center justify-center",children:c.jsx("svg",{className:"w-5 h-5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),c.jsxs("div",{className:"flex-1",children:[c.jsx("h3",{className:"text-sm font-semibold text-gray-800 dark:text-gray-100 mb-2",children:"Intention limit reached"}),c.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-4 leading-relaxed",children:"You can have 2 active intentions on the free plan. Upgrade to create and manage unlimited intentions for different days or contexts."}),c.jsx("button",{onClick:()=>{const $=window.location.origin+"/subscription";window.open($,"_blank")},className:"px-6 py-3 bg-black dark:bg-white text-white dark:text-black rounded-full text-[11px] font-bold uppercase tracking-widest hover:opacity-90 transition-all",children:"Upgrade"})]})]})})]}):c.jsxs("form",{onSubmit:Xe,className:"space-y-4",children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:"New Seed"}),c.jsxs("div",{className:"flex gap-4",children:[c.jsx("input",{type:"text",placeholder:"e.g. Tips for deep focus",value:u,onChange:$=>d($.target.value),className:"flex-1 bg-gray-50 dark:bg-white/5 border border-black/5 dark:border-white/5 rounded-3xl px-6 py-4 text-sm focus:outline-none text-gray-800 dark:text-gray-100"}),c.jsx("button",{type:"submit",className:"bg-black dark:bg-white text-white dark:text-black px-8 rounded-3xl text-[11px] font-bold uppercase tracking-widest transition-all",children:"Plant"})]})]})})(),c.jsx("div",{className:"space-y-4",children:r.requests.map(S=>c.jsxs("div",{className:"flex items-center justify-between p-5 bg-gray-50/50 dark:bg-white/5 rounded-3xl transition-all",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("button",{onClick:()=>De(S.id),className:`w-6 h-6 rounded-lg border-2 flex items-center justify-center transition-all ${S.active?"bg-indigo-500 border-indigo-500 text-white":"border-gray-200 dark:border-gray-800"}`,children:S.active&&c.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),c.jsx("span",{className:`text-sm font-medium ${S.active?"text-gray-700 dark:text-gray-200":"text-gray-300 dark:text-gray-600"}`,children:S.prompt})]}),c.jsx("button",{onClick:()=>Qe(S.id),className:"p-3 text-gray-300 hover:text-red-500",children:c.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7"})})})]},S.id))})]}),g==="redeem"&&c.jsx("div",{className:"space-y-10 animate-reveal",children:r.user?c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"space-y-4",children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:"Redeem Feature"}),c.jsxs("div",{className:"flex items-center justify-between p-5 bg-gray-50/50 dark:bg-white/5 rounded-3xl",children:[c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{className:"text-sm font-semibold text-gray-700 dark:text-gray-200",children:"Enable Redeem Code"}),c.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Turn on to use redeem codes"})]}),c.jsx("button",{onClick:async S=>{if(S.preventDefault(),S.stopPropagation(),!r.user){console.error("[Settings] No user found");return}const I=r.user.redeemEnabled??!0,D=!I;console.log("[Settings] Toggling redeem:",{userId:r.user.id,currentValue:I,newValue:D,currentUserState:r.user});const $={...r.user,redeemEnabled:D},Y=Ft($),Q={...r,user:$,subscriptionTier:Y};try{if(await n(Q),console.log("[Settings] Local state updated optimistically",{redeemEnabled:D,subscriptionTier:Y}),await Th(r.user.id,D)){console.log("[Settings] Database updated successfully");const[be,ne]=await Promise.all([xr(r.user.id),_r(r.user.id)]);if(be||ne){const he={...r.user,...be&&{memberViaRedeem:be.memberViaRedeem,membershipSince:be.membershipSince},...ne&&{redeemEnabled:ne.redeemEnabled}},Je=Ft(he);n(le=>({...le,user:he,subscriptionTier:Je})).catch(le=>console.error("[Settings] Failed to update state:",le)),console.log("[Settings] Membership state refreshed after toggle:",{redeemEnabled:he.redeemEnabled,memberViaRedeem:he.memberViaRedeem,subscriptionTier:Je})}s(D?"Redeem enabled":"Redeem disabled","info")}else console.warn("[Settings] Database update failed, but UI updated"),s("Setting updated locally, but sync failed","info")}catch(H){console.error("[Settings] Error updating state:",H),await n({...r,user:{...r.user,redeemEnabled:I},subscriptionTier:Ft({...r.user,redeemEnabled:I})}),s("Failed to update setting","error")}},className:`relative inline-flex h-7 w-12 items-center rounded-full transition-colors ${((Pe=r.user)==null?void 0:Pe.redeemEnabled)??!0?"bg-indigo-500":"bg-gray-300 dark:bg-gray-600"}`,children:c.jsx("span",{className:`inline-block h-5 w-5 transform rounded-full bg-white transition-transform ${((je=r.user)==null?void 0:je.redeemEnabled)??!0?"translate-x-6":"translate-x-1"}`})})]})]}),((j=r.user)==null?void 0:j.redeemEnabled)??!0?c.jsxs("div",{className:"space-y-4",children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest",children:"Redeem Code"}),c.jsxs("form",{onSubmit:async S=>{if(S.preventDefault(),!J.trim()||me)return;Ne(!0),Ve({type:null,message:""});const I=await Rh(r.user,J.trim());if(I.ok){Ve({type:"success",message:"Code redeemed successfully! Membership unlocked."}),re(""),s("Membership unlocked via redeem code","success");const[D,$]=await Promise.all([xr(r.user.id),_r(r.user.id)]);n(Y=>{const Q={...Y.user,memberViaRedeem:!0,membershipSince:new Date().toISOString(),...D&&{memberViaRedeem:D.memberViaRedeem,membershipSince:D.membershipSince},...$&&{redeemEnabled:$.redeemEnabled}},H=Ft(Q);return{...Y,user:Q,subscriptionTier:H}}).catch(Y=>console.error("[Settings] Failed to update state after redeem:",Y))}else{const D={INVALID_CODE:"Invalid code. Please check and try again.",DISABLED_CODE:"This code has been disabled.",ALREADY_REDEEMED:"This code has already been redeemed.",EXPIRED_CODE:"This code has expired.",NOT_AUTHENTICATED:"Please sign in to redeem a code.",NETWORK_ERROR:"Network error. Please try again later.",UNKNOWN_ERROR:"An error occurred. Please try again."};Ve({type:"error",message:I.message||D[I.error_code]||"Failed to redeem code."})}Ne(!1)},className:"space-y-4",children:[c.jsxs("div",{className:"flex gap-4",children:[c.jsx("input",{type:"text",placeholder:"ST-XXXX-XXXX-XXXX",value:J,onChange:S=>re(S.target.value.toUpperCase()),className:"flex-1 bg-gray-50 dark:bg-white/5 border border-black/5 dark:border-white/5 rounded-3xl px-6 py-4 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500/20 text-gray-800 dark:text-gray-100 uppercase",disabled:me}),c.jsx("button",{type:"submit",disabled:me||!J.trim(),className:"bg-black dark:bg-white text-white dark:text-black px-8 rounded-3xl text-[11px] font-bold uppercase tracking-widest hover:opacity-90 transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:me?"Redeeming...":"Redeem"})]}),ye.type&&c.jsx("div",{className:`p-4 rounded-2xl ${ye.type==="success"?"bg-green-50 dark:bg-green-950/20 border border-green-200 dark:border-green-900/30":"bg-red-50 dark:bg-red-950/20 border border-red-200 dark:border-red-900/30"}`,children:c.jsx("p",{className:`text-sm ${ye.type==="success"?"text-green-700 dark:text-green-300":"text-red-700 dark:text-red-300"}`,children:ye.message})})]})]}):c.jsx("div",{className:"p-8 bg-gray-50 dark:bg-white/5 rounded-3xl border border-dashed border-gray-200 dark:border-white/10",children:c.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 text-center",children:"Redeem is disabled. Turn it on to use codes."})}),((q=r.user)==null?void 0:q.memberViaRedeem)&&(((M=r.user)==null?void 0:M.redeemEnabled)??!0)&&c.jsx("div",{className:"p-6 bg-indigo-50 dark:bg-indigo-950/20 rounded-3xl border border-indigo-100 dark:border-indigo-900/30",children:c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("svg",{className:"w-6 h-6 text-indigo-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),c.jsxs("div",{children:[c.jsx("p",{className:"text-sm font-semibold text-indigo-700 dark:text-indigo-300",children:"Membership Active"}),c.jsxs("p",{className:"text-xs text-indigo-600 dark:text-indigo-400 mt-1",children:["Unlocked via redeem code",r.user.membershipSince&&c.jsxs(c.Fragment,{children:[" â€¢ ",new Date(r.user.membershipSince).toLocaleDateString()]})]})]})]})})]}):c.jsxs("div",{className:"text-center p-12 bg-gray-50/50 dark:bg-white/5 rounded-[3rem] border border-dashed border-gray-200 dark:border-white/10",children:[c.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6 leading-relaxed",children:"Sign in to redeem a code and unlock membership."}),c.jsx("button",{onClick:i,className:"px-6 py-3 bg-black dark:bg-white text-white dark:text-black rounded-full text-[11px] font-bold uppercase tracking-widest hover:opacity-90 transition-all",children:"Sign In"})]})}),g==="language"&&c.jsx("div",{className:"grid grid-cols-2 gap-4 animate-reveal",children:dc.map(S=>c.jsx("button",{onClick:()=>{n({...r,language:S.code}),s(`Language: ${S.name}`)},className:`p-6 rounded-[2rem] text-sm font-bold transition-all text-left border-2 ${r.language===S.code?"border-indigo-500 bg-indigo-500/5 text-indigo-600":"border-transparent bg-gray-50 dark:bg-white/5 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-white/10"}`,children:S.name},S.code))}),g==="account"&&c.jsx("div",{className:"space-y-8 animate-reveal",children:r.user?c.jsxs("div",{className:"flex flex-col gap-8",children:[c.jsxs("div",{className:"flex items-center gap-6 p-8 bg-indigo-500/5 dark:bg-indigo-400/5 rounded-[3rem] border border-indigo-500/10",children:[r.user.picture?c.jsx("img",{src:r.user.picture,className:"w-16 h-16 rounded-full shadow-lg",alt:""}):c.jsx("div",{className:"w-16 h-16 rounded-full bg-indigo-500 flex items-center justify-center text-white text-xl font-bold",children:(O=r.user.name)==null?void 0:O.charAt(0)}),c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{className:"text-lg font-bold text-gray-800 dark:text-gray-100",children:r.user.name}),c.jsx("span",{className:"text-sm text-gray-400",children:r.user.email})]})]}),c.jsx("button",{onClick:o,className:"w-full py-5 bg-white dark:bg-white/5 border border-red-500/20 text-red-500 rounded-[2rem] text-[11px] font-bold uppercase tracking-widest hover:bg-red-500/5 transition-all",children:"Sign Out"})]}):c.jsxs("div",{className:"text-center p-12 bg-gray-50/50 dark:bg-white/5 rounded-[3rem] border border-dashed border-gray-200 dark:border-white/10",children:[c.jsx("p",{className:"text-sm text-gray-500 mb-10 leading-relaxed max-w-xs mx-auto",children:"Sign in to securely sync your Studio settings and gateways across all devices."}),c.jsxs("button",{onClick:()=>{v(!0),i(),setTimeout(()=>v(!1),2e3)},disabled:p,className:"inline-flex items-center gap-4 bg-white dark:bg-white/10 border border-black/5 px-10 py-4 rounded-full shadow-xl hover:scale-105 transition-all",children:[c.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[c.jsx("path",{fill:"#EA4335",d:"M12 5.04c1.74 0 3.3.6 4.53 1.77l3.39-3.39C17.85 1.5 15.15 0 12 0 7.31 0 3.25 2.69 1.25 6.64l3.96 3.07C6.16 6.94 8.86 5.04 12 5.04z"}),c.jsx("path",{fill:"#4285F4",d:"M23.49 12.27c0-.79-.07-1.54-.19-2.27H12v4.51h6.47c-.29 1.48-1.14 2.73-2.4 3.58l3.76 2.91c2.2-2.02 3.46-4.99 3.46-8.73z"}),c.jsx("path",{fill:"#FBBC05",d:"M5.21 14.71c-.24-.7-.37-1.44-.37-2.21s.13-1.51.37-2.21L1.25 7.22C.45 8.71 0 10.33 0 12s.45 3.29 1.25 4.78l3.96-3.07z"}),c.jsx("path",{fill:"#34A853",d:"M12 24c3.24 0 5.95-1.08 7.93-2.91l-3.76-2.91c-1.08.72-2.45 1.16-4.17 1.16-3.14 0-5.84-1.9-6.84-4.73L1.25 17.68C3.25 21.31 7.31 24 12 24z"})]}),c.jsx("span",{className:"text-[10px] font-bold text-gray-700 dark:text-gray-300 uppercase tracking-widest",children:p?"Connecting...":"Continue with Google"})]})]})})]}),c.jsxs("div",{className:"p-12 bg-gray-50/50 dark:bg-black/40 flex justify-between items-center",children:[c.jsx("button",{onClick:e,className:"px-10 py-4 bg-black dark:bg-white text-white dark:text-black rounded-full text-[11px] font-bold uppercase tracking-widest transition-all hover:scale-105 active:scale-95 shadow-xl shadow-black/10",children:"Close Studio"}),c.jsxs("span",{className:"text-[9px] font-bold text-gray-300 uppercase tracking-widest",children:["StartlyTab v",r.version]})]})]}),c.jsx(qh,{isOpen:w,onClose:()=>C(!1),onUpgrade:Te,feature:P,theme:r.theme})]})},Wh=({isOpen:t,onClose:e,onSignIn:r,theme:n})=>{if(!t)return null;const s=()=>{r(),e()};return c.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center p-4 bg-black/20 dark:bg-black/80 backdrop-blur-xl animate-reveal",children:c.jsx("div",{className:"bg-white dark:bg-[#0F0F0F] w-full max-w-md rounded-[3.5rem] shadow-[0_40px_100px_-20px_rgba(0,0,0,0.25)] overflow-hidden",children:c.jsxs("div",{className:"px-12 pt-12 pb-8",children:[c.jsx("h2",{className:"serif text-3xl md:text-4xl font-normal text-gray-800 dark:text-gray-100 mb-4",children:"Continue your perspective"}),c.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 leading-relaxed mb-8",children:"Sign in to keep generating daily perspectives without limits."}),c.jsxs("div",{className:"flex flex-col gap-4",children:[c.jsxs("button",{onClick:s,className:"w-full py-5 bg-black dark:bg-white text-white dark:text-black rounded-full text-[11px] font-bold uppercase tracking-widest hover:opacity-90 transition-all active:scale-95 shadow-xl shadow-black/10 flex items-center justify-center gap-3",children:[c.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[c.jsx("path",{fill:"#EA4335",d:"M12 5.04c1.74 0 3.3.6 4.53 1.77l3.39-3.39C17.85 1.5 15.15 0 12 0 7.31 0 3.25 2.69 1.25 6.64l3.96 3.07C6.16 6.94 8.86 5.04 12 5.04z"}),c.jsx("path",{fill:"#4285F4",d:"M23.49 12.27c0-.79-.07-1.54-.19-2.27H12v4.51h6.47c-.29 1.48-1.14 2.73-2.4 3.58l3.76 2.91c2.2-2.02 3.46-4.99 3.46-8.73z"}),c.jsx("path",{fill:"#FBBC05",d:"M5.21 14.71c-.24-.7-.37-1.44-.37-2.21s.13-1.51.37-2.21L1.25 7.22C.45 8.71 0 10.33 0 12s.45 3.29 1.25 4.78l3.96-3.07z"}),c.jsx("path",{fill:"#34A853",d:"M12 24c3.24 0 5.95-1.08 7.93-2.91l-3.76-2.91c-1.08.72-2.45 1.16-4.17 1.16-3.14 0-5.84-1.9-6.84-4.73L1.25 17.68C3.25 21.31 7.31 24 12 24z"})]}),c.jsx("span",{children:"Sign in with Google"})]}),c.jsx("button",{onClick:e,className:"w-full py-4 text-gray-500 dark:text-gray-400 text-sm font-medium hover:text-gray-700 dark:hover:text-gray-200 transition-colors",children:"Not now"})]})]})})})},Gh=({isOpen:t,onClose:e,onSaveLocal:r,theme:n,isAuthenticated:s,onLogin:i})=>{const[o,a]=f.useState(""),[l,u]=f.useState(!1);f.useEffect(()=>{o.trim()&&!s&&localStorage.setItem("startly_intention_pending",o.trim())},[o,s]),f.useEffect(()=>{s&&t&&e()},[s,t,e]);const d=async()=>{if(o.trim()){u(!0);try{r(o.trim()),a(""),e()}finally{u(!1)}}};return t?c.jsx("div",{className:"fixed inset-0 z-[120] flex items-center justify-center p-4 bg-black/20 dark:bg-black/80 backdrop-blur-xl animate-reveal",children:c.jsx("div",{className:"bg-white dark:bg-[#0F0F0F] w-full max-w-md rounded-[3.5rem] shadow-[0_40px_100px_-20px_rgba(0,0,0,0.25)] overflow-hidden",children:c.jsxs("div",{className:"px-12 pt-12 pb-8",children:[c.jsx("h2",{className:"serif text-3xl md:text-4xl font-normal text-gray-800 dark:text-gray-100 mb-4",children:"What would you like to see each day?"}),c.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 leading-relaxed mb-6",children:["Write a simple sentence about the vibe you want.",c.jsx("br",{}),"Examples: a little gloomy, high-energy, poetic, light humor."]}),c.jsxs("div",{className:"mb-6",children:[c.jsx("textarea",{value:o,onChange:g=>a(g.target.value),placeholder:'E.g. "A bit gloomy and poetic, like a quiet diary."',className:"w-full px-5 py-4 bg-gray-50 dark:bg-white/5 border border-gray-200 dark:border-white/10 rounded-2xl text-sm text-gray-800 dark:text-gray-200 placeholder-gray-400 dark:placeholder-gray-500 resize-none focus:outline-none focus:ring-2 focus:ring-black dark:focus:ring-white focus:border-transparent transition-all",rows:4,maxLength:200}),c.jsxs("div",{className:"mt-2 text-xs text-gray-400 dark:text-gray-500 text-right",children:[o.length,"/200"]})]}),c.jsxs("div",{className:"flex flex-col gap-3",children:[!s&&c.jsx(c.Fragment,{children:c.jsxs("button",{onClick:i,className:"group relative flex items-center justify-center gap-3 w-full px-8 py-3 bg-white dark:bg-white/10 text-gray-700 dark:text-white rounded-full border border-gray-200 dark:border-white/10 hover:bg-gray-50 dark:hover:bg-white/20 hover:border-gray-300 dark:hover:border-white/20 transition-all duration-300 active:scale-[0.98] shadow-sm hover:shadow-md",children:[c.jsxs("svg",{className:"w-5 h-5 flex-shrink-0",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:[c.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),c.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),c.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),c.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),c.jsx("span",{className:"font-medium tracking-wide",children:"Sign in with Google"})]})}),s&&c.jsx("button",{onClick:d,disabled:!o.trim()||l,className:"w-full py-5 bg-black dark:bg-white text-white dark:text-black rounded-full text-[11px] font-bold uppercase tracking-widest hover:opacity-90 transition-all active:scale-95 shadow-xl shadow-black/10 disabled:opacity-50 disabled:cursor-not-allowed",children:l?"Saving...":"Save"}),c.jsx("button",{onClick:e,className:"w-full py-4 text-gray-500 dark:text-gray-400 text-sm font-medium hover:text-gray-700 dark:hover:text-gray-200 transition-colors",children:"Not now"})]}),!s&&c.jsxs("p",{className:"mt-6 text-xs text-gray-400 dark:text-gray-500 text-center leading-relaxed",children:["Saving on this device keeps your preference here.",c.jsx("br",{}),"Sign in with Google to unlock unlimited perspectives and sync across devices."]})]})})}):null};/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hh=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Kh=ks("check",Hh);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vh=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Gi=ks("pen",Vh);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jh=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],nn=ks("plus",Jh);function Yh(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return f.useMemo(()=>n=>{e.forEach(s=>s(n))},e)}const Rn=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function lr(t){const e=Object.prototype.toString.call(t);return e==="[object Window]"||e==="[object global]"}function Fs(t){return"nodeType"in t}function Ke(t){var e,r;return t?lr(t)?t:Fs(t)&&(e=(r=t.ownerDocument)==null?void 0:r.defaultView)!=null?e:window:window}function Bs(t){const{Document:e}=Ke(t);return t instanceof e}function Mr(t){return lr(t)?!1:t instanceof Ke(t).HTMLElement}function Qo(t){return t instanceof Ke(t).SVGElement}function cr(t){return t?lr(t)?t.document:Fs(t)?Bs(t)?t:Mr(t)||Qo(t)?t.ownerDocument:document:document:document}const pt=Rn?f.useLayoutEffect:f.useEffect;function Tn(t){const e=f.useRef(t);return pt(()=>{e.current=t}),f.useCallback(function(){for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return e.current==null?void 0:e.current(...n)},[])}function Xh(){const t=f.useRef(null),e=f.useCallback((n,s)=>{t.current=setInterval(n,s)},[]),r=f.useCallback(()=>{t.current!==null&&(clearInterval(t.current),t.current=null)},[]);return[e,r]}function Ir(t,e){e===void 0&&(e=[t]);const r=f.useRef(t);return pt(()=>{r.current!==t&&(r.current=t)},e),r}function Fr(t,e){const r=f.useRef();return f.useMemo(()=>{const n=t(r.current);return r.current=n,n},[...e])}function fn(t){const e=Tn(t),r=f.useRef(null),n=f.useCallback(s=>{s!==r.current&&(e==null||e(s,r.current)),r.current=s},[]);return[r,n]}function gn(t){const e=f.useRef();return f.useEffect(()=>{e.current=t},[t]),e.current}let Qn={};function Br(t,e){return f.useMemo(()=>{if(e)return e;const r=Qn[t]==null?0:Qn[t]+1;return Qn[t]=r,t+"-"+r},[t,e])}function Zo(t){return function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];return n.reduce((i,o)=>{const a=Object.entries(o);for(const[l,u]of a){const d=i[l];d!=null&&(i[l]=d+t*u)}return i},{...e})}}const rr=Zo(1),Pr=Zo(-1);function Qh(t){return"clientX"in t&&"clientY"in t}function jn(t){if(!t)return!1;const{KeyboardEvent:e}=Ke(t.target);return e&&t instanceof e}function Zh(t){if(!t)return!1;const{TouchEvent:e}=Ke(t.target);return e&&t instanceof e}function pn(t){if(Zh(t)){if(t.touches&&t.touches.length){const{clientX:e,clientY:r}=t.touches[0];return{x:e,y:r}}else if(t.changedTouches&&t.changedTouches.length){const{clientX:e,clientY:r}=t.changedTouches[0];return{x:e,y:r}}}return Qh(t)?{x:t.clientX,y:t.clientY}:null}const It=Object.freeze({Translate:{toString(t){if(!t)return;const{x:e,y:r}=t;return"translate3d("+(e?Math.round(e):0)+"px, "+(r?Math.round(r):0)+"px, 0)"}},Scale:{toString(t){if(!t)return;const{scaleX:e,scaleY:r}=t;return"scaleX("+e+") scaleY("+r+")"}},Transform:{toString(t){if(t)return[It.Translate.toString(t),It.Scale.toString(t)].join(" ")}},Transition:{toString(t){let{property:e,duration:r,easing:n}=t;return e+" "+r+"ms "+n}}}),Hi="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function ef(t){return t.matches(Hi)?t:t.querySelector(Hi)}const tf={display:"none"};function rf(t){let{id:e,value:r}=t;return xe.createElement("div",{id:e,style:tf},r)}function nf(t){let{id:e,announcement:r,ariaLiveType:n="assertive"}=t;const s={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return xe.createElement("div",{id:e,style:s,role:"status","aria-live":n,"aria-atomic":!0},r)}function sf(){const[t,e]=f.useState("");return{announce:f.useCallback(n=>{n!=null&&e(n)},[]),announcement:t}}const ea=f.createContext(null);function of(t){const e=f.useContext(ea);f.useEffect(()=>{if(!e)throw new Error("useDndMonitor must be used within a children of <DndContext>");return e(t)},[t,e])}function af(){const[t]=f.useState(()=>new Set),e=f.useCallback(n=>(t.add(n),()=>t.delete(n)),[t]);return[f.useCallback(n=>{let{type:s,event:i}=n;t.forEach(o=>{var a;return(a=o[s])==null?void 0:a.call(o,i)})},[t]),e]}const lf={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},cf={onDragStart(t){let{active:e}=t;return"Picked up draggable item "+e.id+"."},onDragOver(t){let{active:e,over:r}=t;return r?"Draggable item "+e.id+" was moved over droppable area "+r.id+".":"Draggable item "+e.id+" is no longer over a droppable area."},onDragEnd(t){let{active:e,over:r}=t;return r?"Draggable item "+e.id+" was dropped over droppable area "+r.id:"Draggable item "+e.id+" was dropped."},onDragCancel(t){let{active:e}=t;return"Dragging was cancelled. Draggable item "+e.id+" was dropped."}};function uf(t){let{announcements:e=cf,container:r,hiddenTextDescribedById:n,screenReaderInstructions:s=lf}=t;const{announce:i,announcement:o}=sf(),a=Br("DndLiveRegion"),[l,u]=f.useState(!1);if(f.useEffect(()=>{u(!0)},[]),of(f.useMemo(()=>({onDragStart(g){let{active:h}=g;i(e.onDragStart({active:h}))},onDragMove(g){let{active:h,over:p}=g;e.onDragMove&&i(e.onDragMove({active:h,over:p}))},onDragOver(g){let{active:h,over:p}=g;i(e.onDragOver({active:h,over:p}))},onDragEnd(g){let{active:h,over:p}=g;i(e.onDragEnd({active:h,over:p}))},onDragCancel(g){let{active:h,over:p}=g;i(e.onDragCancel({active:h,over:p}))}}),[i,e])),!l)return null;const d=xe.createElement(xe.Fragment,null,xe.createElement(rf,{id:n,value:s.draggable}),xe.createElement(nf,{id:a,announcement:o}));return r?Zt.createPortal(d,r):d}var Ie;(function(t){t.DragStart="dragStart",t.DragMove="dragMove",t.DragEnd="dragEnd",t.DragCancel="dragCancel",t.DragOver="dragOver",t.RegisterDroppable="registerDroppable",t.SetDroppableDisabled="setDroppableDisabled",t.UnregisterDroppable="unregisterDroppable"})(Ie||(Ie={}));function mn(){}function Ki(t,e){return f.useMemo(()=>({sensor:t,options:e??{}}),[t,e])}function df(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return f.useMemo(()=>[...e].filter(n=>n!=null),[...e])}const mt=Object.freeze({x:0,y:0});function ta(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function hf(t,e){const r=pn(t);if(!r)return"0 0";const n={x:(r.x-e.left)/e.width*100,y:(r.y-e.top)/e.height*100};return n.x+"% "+n.y+"%"}function ra(t,e){let{data:{value:r}}=t,{data:{value:n}}=e;return r-n}function ff(t,e){let{data:{value:r}}=t,{data:{value:n}}=e;return n-r}function Vi(t){let{left:e,top:r,height:n,width:s}=t;return[{x:e,y:r},{x:e+s,y:r},{x:e,y:r+n},{x:e+s,y:r+n}]}function na(t,e){if(!t||t.length===0)return null;const[r]=t;return r[e]}function Ji(t,e,r){return e===void 0&&(e=t.left),r===void 0&&(r=t.top),{x:e+t.width*.5,y:r+t.height*.5}}const gf=t=>{let{collisionRect:e,droppableRects:r,droppableContainers:n}=t;const s=Ji(e,e.left,e.top),i=[];for(const o of n){const{id:a}=o,l=r.get(a);if(l){const u=ta(Ji(l),s);i.push({id:a,data:{droppableContainer:o,value:u}})}}return i.sort(ra)},pf=t=>{let{collisionRect:e,droppableRects:r,droppableContainers:n}=t;const s=Vi(e),i=[];for(const o of n){const{id:a}=o,l=r.get(a);if(l){const u=Vi(l),d=s.reduce((h,p,v)=>h+ta(u[v],p),0),g=Number((d/4).toFixed(4));i.push({id:a,data:{droppableContainer:o,value:g}})}}return i.sort(ra)};function mf(t,e){const r=Math.max(e.top,t.top),n=Math.max(e.left,t.left),s=Math.min(e.left+e.width,t.left+t.width),i=Math.min(e.top+e.height,t.top+t.height),o=s-n,a=i-r;if(n<s&&r<i){const l=e.width*e.height,u=t.width*t.height,d=o*a,g=d/(l+u-d);return Number(g.toFixed(4))}return 0}const bf=t=>{let{collisionRect:e,droppableRects:r,droppableContainers:n}=t;const s=[];for(const i of n){const{id:o}=i,a=r.get(o);if(a){const l=mf(a,e);l>0&&s.push({id:o,data:{droppableContainer:i,value:l}})}}return s.sort(ff)};function yf(t,e,r){return{...t,scaleX:e&&r?e.width/r.width:1,scaleY:e&&r?e.height/r.height:1}}function sa(t,e){return t&&e?{x:t.left-e.left,y:t.top-e.top}:mt}function wf(t){return function(r){for(var n=arguments.length,s=new Array(n>1?n-1:0),i=1;i<n;i++)s[i-1]=arguments[i];return s.reduce((o,a)=>({...o,top:o.top+t*a.y,bottom:o.bottom+t*a.y,left:o.left+t*a.x,right:o.right+t*a.x}),{...r})}}const vf=wf(1);function ia(t){if(t.startsWith("matrix3d(")){const e=t.slice(9,-1).split(/, /);return{x:+e[12],y:+e[13],scaleX:+e[0],scaleY:+e[5]}}else if(t.startsWith("matrix(")){const e=t.slice(7,-1).split(/, /);return{x:+e[4],y:+e[5],scaleX:+e[0],scaleY:+e[3]}}return null}function xf(t,e,r){const n=ia(e);if(!n)return t;const{scaleX:s,scaleY:i,x:o,y:a}=n,l=t.left-o-(1-s)*parseFloat(r),u=t.top-a-(1-i)*parseFloat(r.slice(r.indexOf(" ")+1)),d=s?t.width/s:t.width,g=i?t.height/i:t.height;return{width:d,height:g,top:u,right:l+d,bottom:u+g,left:l}}const _f={ignoreTransform:!1};function ur(t,e){e===void 0&&(e=_f);let r=t.getBoundingClientRect();if(e.ignoreTransform){const{transform:u,transformOrigin:d}=Ke(t).getComputedStyle(t);u&&(r=xf(r,u,d))}const{top:n,left:s,width:i,height:o,bottom:a,right:l}=r;return{top:n,left:s,width:i,height:o,bottom:a,right:l}}function Yi(t){return ur(t,{ignoreTransform:!0})}function kf(t){const e=t.innerWidth,r=t.innerHeight;return{top:0,left:0,right:e,bottom:r,width:e,height:r}}function Sf(t,e){return e===void 0&&(e=Ke(t).getComputedStyle(t)),e.position==="fixed"}function Ef(t,e){e===void 0&&(e=Ke(t).getComputedStyle(t));const r=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(s=>{const i=e[s];return typeof i=="string"?r.test(i):!1})}function An(t,e){const r=[];function n(s){if(e!=null&&r.length>=e||!s)return r;if(Bs(s)&&s.scrollingElement!=null&&!r.includes(s.scrollingElement))return r.push(s.scrollingElement),r;if(!Mr(s)||Qo(s)||r.includes(s))return r;const i=Ke(t).getComputedStyle(s);return s!==t&&Ef(s,i)&&r.push(s),Sf(s,i)?r:n(s.parentNode)}return t?n(t):r}function oa(t){const[e]=An(t,1);return e??null}function Zn(t){return!Rn||!t?null:lr(t)?t:Fs(t)?Bs(t)||t===cr(t).scrollingElement?window:Mr(t)?t:null:null}function aa(t){return lr(t)?t.scrollX:t.scrollLeft}function la(t){return lr(t)?t.scrollY:t.scrollTop}function vs(t){return{x:aa(t),y:la(t)}}var Le;(function(t){t[t.Forward=1]="Forward",t[t.Backward=-1]="Backward"})(Le||(Le={}));function ca(t){return!Rn||!t?!1:t===document.scrollingElement}function ua(t){const e={x:0,y:0},r=ca(t)?{height:window.innerHeight,width:window.innerWidth}:{height:t.clientHeight,width:t.clientWidth},n={x:t.scrollWidth-r.width,y:t.scrollHeight-r.height},s=t.scrollTop<=e.y,i=t.scrollLeft<=e.x,o=t.scrollTop>=n.y,a=t.scrollLeft>=n.x;return{isTop:s,isLeft:i,isBottom:o,isRight:a,maxScroll:n,minScroll:e}}const Cf={x:.2,y:.2};function Rf(t,e,r,n,s){let{top:i,left:o,right:a,bottom:l}=r;n===void 0&&(n=10),s===void 0&&(s=Cf);const{isTop:u,isBottom:d,isLeft:g,isRight:h}=ua(t),p={x:0,y:0},v={x:0,y:0},b={height:e.height*s.y,width:e.width*s.x};return!u&&i<=e.top+b.height?(p.y=Le.Backward,v.y=n*Math.abs((e.top+b.height-i)/b.height)):!d&&l>=e.bottom-b.height&&(p.y=Le.Forward,v.y=n*Math.abs((e.bottom-b.height-l)/b.height)),!h&&a>=e.right-b.width?(p.x=Le.Forward,v.x=n*Math.abs((e.right-b.width-a)/b.width)):!g&&o<=e.left+b.width&&(p.x=Le.Backward,v.x=n*Math.abs((e.left+b.width-o)/b.width)),{direction:p,speed:v}}function Tf(t){if(t===document.scrollingElement){const{innerWidth:i,innerHeight:o}=window;return{top:0,left:0,right:i,bottom:o,width:i,height:o}}const{top:e,left:r,right:n,bottom:s}=t.getBoundingClientRect();return{top:e,left:r,right:n,bottom:s,width:t.clientWidth,height:t.clientHeight}}function da(t){return t.reduce((e,r)=>rr(e,vs(r)),mt)}function jf(t){return t.reduce((e,r)=>e+aa(r),0)}function Af(t){return t.reduce((e,r)=>e+la(r),0)}function ha(t,e){if(e===void 0&&(e=ur),!t)return;const{top:r,left:n,bottom:s,right:i}=e(t);oa(t)&&(s<=0||i<=0||r>=window.innerHeight||n>=window.innerWidth)&&t.scrollIntoView({block:"center",inline:"center"})}const Nf=[["x",["left","right"],jf],["y",["top","bottom"],Af]];class qs{constructor(e,r){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const n=An(r),s=da(n);this.rect={...e},this.width=e.width,this.height=e.height;for(const[i,o,a]of Nf)for(const l of o)Object.defineProperty(this,l,{get:()=>{const u=a(n),d=s[i]-u;return this.rect[l]+d},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class kr{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(r=>{var n;return(n=this.target)==null?void 0:n.removeEventListener(...r)})},this.target=e}add(e,r,n){var s;(s=this.target)==null||s.addEventListener(e,r,n),this.listeners.push([e,r,n])}}function Of(t){const{EventTarget:e}=Ke(t);return t instanceof e?t:cr(t)}function es(t,e){const r=Math.abs(t.x),n=Math.abs(t.y);return typeof e=="number"?Math.sqrt(r**2+n**2)>e:"x"in e&&"y"in e?r>e.x&&n>e.y:"x"in e?r>e.x:"y"in e?n>e.y:!1}var at;(function(t){t.Click="click",t.DragStart="dragstart",t.Keydown="keydown",t.ContextMenu="contextmenu",t.Resize="resize",t.SelectionChange="selectionchange",t.VisibilityChange="visibilitychange"})(at||(at={}));function Xi(t){t.preventDefault()}function If(t){t.stopPropagation()}var ae;(function(t){t.Space="Space",t.Down="ArrowDown",t.Right="ArrowRight",t.Left="ArrowLeft",t.Up="ArrowUp",t.Esc="Escape",t.Enter="Enter",t.Tab="Tab"})(ae||(ae={}));const fa={start:[ae.Space,ae.Enter],cancel:[ae.Esc],end:[ae.Space,ae.Enter,ae.Tab]},Pf=(t,e)=>{let{currentCoordinates:r}=e;switch(t.code){case ae.Right:return{...r,x:r.x+25};case ae.Left:return{...r,x:r.x-25};case ae.Down:return{...r,y:r.y+25};case ae.Up:return{...r,y:r.y-25}}};class zs{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:r}}=e;this.props=e,this.listeners=new kr(cr(r)),this.windowListeners=new kr(Ke(r)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(at.Resize,this.handleCancel),this.windowListeners.add(at.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(at.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:r}=this.props,n=e.node.current;n&&ha(n),r(mt)}handleKeyDown(e){if(jn(e)){const{active:r,context:n,options:s}=this.props,{keyboardCodes:i=fa,coordinateGetter:o=Pf,scrollBehavior:a="smooth"}=s,{code:l}=e;if(i.end.includes(l)){this.handleEnd(e);return}if(i.cancel.includes(l)){this.handleCancel(e);return}const{collisionRect:u}=n.current,d=u?{x:u.left,y:u.top}:mt;this.referenceCoordinates||(this.referenceCoordinates=d);const g=o(e,{active:r,context:n.current,currentCoordinates:d});if(g){const h=Pr(g,d),p={x:0,y:0},{scrollableAncestors:v}=n.current;for(const b of v){const m=e.code,{isTop:x,isRight:_,isLeft:w,isBottom:C,maxScroll:P,minScroll:k}=ua(b),E=Tf(b),A={x:Math.min(m===ae.Right?E.right-E.width/2:E.right,Math.max(m===ae.Right?E.left:E.left+E.width/2,g.x)),y:Math.min(m===ae.Down?E.bottom-E.height/2:E.bottom,Math.max(m===ae.Down?E.top:E.top+E.height/2,g.y))},L=m===ae.Right&&!_||m===ae.Left&&!w,X=m===ae.Down&&!C||m===ae.Up&&!x;if(L&&A.x!==g.x){const J=b.scrollLeft+h.x,re=m===ae.Right&&J<=P.x||m===ae.Left&&J>=k.x;if(re&&!h.y){b.scrollTo({left:J,behavior:a});return}re?p.x=b.scrollLeft-J:p.x=m===ae.Right?b.scrollLeft-P.x:b.scrollLeft-k.x,p.x&&b.scrollBy({left:-p.x,behavior:a});break}else if(X&&A.y!==g.y){const J=b.scrollTop+h.y,re=m===ae.Down&&J<=P.y||m===ae.Up&&J>=k.y;if(re&&!h.x){b.scrollTo({top:J,behavior:a});return}re?p.y=b.scrollTop-J:p.y=m===ae.Down?b.scrollTop-P.y:b.scrollTop-k.y,p.y&&b.scrollBy({top:-p.y,behavior:a});break}}this.handleMove(e,rr(Pr(g,this.referenceCoordinates),p))}}}handleMove(e,r){const{onMove:n}=this.props;e.preventDefault(),n(r)}handleEnd(e){const{onEnd:r}=this.props;e.preventDefault(),this.detach(),r()}handleCancel(e){const{onCancel:r}=this.props;e.preventDefault(),this.detach(),r()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}zs.activators=[{eventName:"onKeyDown",handler:(t,e,r)=>{let{keyboardCodes:n=fa,onActivation:s}=e,{active:i}=r;const{code:o}=t.nativeEvent;if(n.start.includes(o)){const a=i.activatorNode.current;return a&&t.target!==a?!1:(t.preventDefault(),s==null||s({event:t.nativeEvent}),!0)}return!1}}];function Qi(t){return!!(t&&"distance"in t)}function Zi(t){return!!(t&&"delay"in t)}class Ws{constructor(e,r,n){var s;n===void 0&&(n=Of(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=r;const{event:i}=e,{target:o}=i;this.props=e,this.events=r,this.document=cr(o),this.documentListeners=new kr(this.document),this.listeners=new kr(n),this.windowListeners=new kr(Ke(o)),this.initialCoordinates=(s=pn(i))!=null?s:mt,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:r,bypassActivationConstraint:n}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(at.Resize,this.handleCancel),this.windowListeners.add(at.DragStart,Xi),this.windowListeners.add(at.VisibilityChange,this.handleCancel),this.windowListeners.add(at.ContextMenu,Xi),this.documentListeners.add(at.Keydown,this.handleKeydown),r){if(n!=null&&n({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Zi(r)){this.timeoutId=setTimeout(this.handleStart,r.delay),this.handlePending(r);return}if(Qi(r)){this.handlePending(r);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,r){const{active:n,onPending:s}=this.props;s(n,e,this.initialCoordinates,r)}handleStart(){const{initialCoordinates:e}=this,{onStart:r}=this.props;e&&(this.activated=!0,this.documentListeners.add(at.Click,If,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(at.SelectionChange,this.removeTextSelection),r(e))}handleMove(e){var r;const{activated:n,initialCoordinates:s,props:i}=this,{onMove:o,options:{activationConstraint:a}}=i;if(!s)return;const l=(r=pn(e))!=null?r:mt,u=Pr(s,l);if(!n&&a){if(Qi(a)){if(a.tolerance!=null&&es(u,a.tolerance))return this.handleCancel();if(es(u,a.distance))return this.handleStart()}if(Zi(a)&&es(u,a.tolerance))return this.handleCancel();this.handlePending(a,u);return}e.cancelable&&e.preventDefault(),o(l)}handleEnd(){const{onAbort:e,onEnd:r}=this.props;this.detach(),this.activated||e(this.props.active),r()}handleCancel(){const{onAbort:e,onCancel:r}=this.props;this.detach(),this.activated||e(this.props.active),r()}handleKeydown(e){e.code===ae.Esc&&this.handleCancel()}removeTextSelection(){var e;(e=this.document.getSelection())==null||e.removeAllRanges()}}const Lf={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Gs extends Ws{constructor(e){const{event:r}=e,n=cr(r.target);super(e,Lf,n)}}Gs.activators=[{eventName:"onPointerDown",handler:(t,e)=>{let{nativeEvent:r}=t,{onActivation:n}=e;return!r.isPrimary||r.button!==0?!1:(n==null||n({event:r}),!0)}}];const Df={move:{name:"mousemove"},end:{name:"mouseup"}};var xs;(function(t){t[t.RightClick=2]="RightClick"})(xs||(xs={}));class $f extends Ws{constructor(e){super(e,Df,cr(e.event.target))}}$f.activators=[{eventName:"onMouseDown",handler:(t,e)=>{let{nativeEvent:r}=t,{onActivation:n}=e;return r.button===xs.RightClick?!1:(n==null||n({event:r}),!0)}}];const ts={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Uf extends Ws{constructor(e){super(e,ts)}static setup(){return window.addEventListener(ts.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(ts.move.name,e)};function e(){}}}Uf.activators=[{eventName:"onTouchStart",handler:(t,e)=>{let{nativeEvent:r}=t,{onActivation:n}=e;const{touches:s}=r;return s.length>1?!1:(n==null||n({event:r}),!0)}}];var Sr;(function(t){t[t.Pointer=0]="Pointer",t[t.DraggableRect=1]="DraggableRect"})(Sr||(Sr={}));var bn;(function(t){t[t.TreeOrder=0]="TreeOrder",t[t.ReversedTreeOrder=1]="ReversedTreeOrder"})(bn||(bn={}));function Mf(t){let{acceleration:e,activator:r=Sr.Pointer,canScroll:n,draggingRect:s,enabled:i,interval:o=5,order:a=bn.TreeOrder,pointerCoordinates:l,scrollableAncestors:u,scrollableAncestorRects:d,delta:g,threshold:h}=t;const p=Bf({delta:g,disabled:!i}),[v,b]=Xh(),m=f.useRef({x:0,y:0}),x=f.useRef({x:0,y:0}),_=f.useMemo(()=>{switch(r){case Sr.Pointer:return l?{top:l.y,bottom:l.y,left:l.x,right:l.x}:null;case Sr.DraggableRect:return s}},[r,s,l]),w=f.useRef(null),C=f.useCallback(()=>{const k=w.current;if(!k)return;const E=m.current.x*x.current.x,A=m.current.y*x.current.y;k.scrollBy(E,A)},[]),P=f.useMemo(()=>a===bn.TreeOrder?[...u].reverse():u,[a,u]);f.useEffect(()=>{if(!i||!u.length||!_){b();return}for(const k of P){if((n==null?void 0:n(k))===!1)continue;const E=u.indexOf(k),A=d[E];if(!A)continue;const{direction:L,speed:X}=Rf(k,A,_,e,h);for(const J of["x","y"])p[J][L[J]]||(X[J]=0,L[J]=0);if(X.x>0||X.y>0){b(),w.current=k,v(C,o),m.current=X,x.current=L;return}}m.current={x:0,y:0},x.current={x:0,y:0},b()},[e,C,n,b,i,o,JSON.stringify(_),JSON.stringify(p),v,u,P,d,JSON.stringify(h)])}const Ff={x:{[Le.Backward]:!1,[Le.Forward]:!1},y:{[Le.Backward]:!1,[Le.Forward]:!1}};function Bf(t){let{delta:e,disabled:r}=t;const n=gn(e);return Fr(s=>{if(r||!n||!s)return Ff;const i={x:Math.sign(e.x-n.x),y:Math.sign(e.y-n.y)};return{x:{[Le.Backward]:s.x[Le.Backward]||i.x===-1,[Le.Forward]:s.x[Le.Forward]||i.x===1},y:{[Le.Backward]:s.y[Le.Backward]||i.y===-1,[Le.Forward]:s.y[Le.Forward]||i.y===1}}},[r,e,n])}function qf(t,e){const r=e!=null?t.get(e):void 0,n=r?r.node.current:null;return Fr(s=>{var i;return e==null?null:(i=n??s)!=null?i:null},[n,e])}function zf(t,e){return f.useMemo(()=>t.reduce((r,n)=>{const{sensor:s}=n,i=s.activators.map(o=>({eventName:o.eventName,handler:e(o.handler,n)}));return[...r,...i]},[]),[t,e])}var Lr;(function(t){t[t.Always=0]="Always",t[t.BeforeDragging=1]="BeforeDragging",t[t.WhileDragging=2]="WhileDragging"})(Lr||(Lr={}));var _s;(function(t){t.Optimized="optimized"})(_s||(_s={}));const eo=new Map;function Wf(t,e){let{dragging:r,dependencies:n,config:s}=e;const[i,o]=f.useState(null),{frequency:a,measure:l,strategy:u}=s,d=f.useRef(t),g=m(),h=Ir(g),p=f.useCallback(function(x){x===void 0&&(x=[]),!h.current&&o(_=>_===null?x:_.concat(x.filter(w=>!_.includes(w))))},[h]),v=f.useRef(null),b=Fr(x=>{if(g&&!r)return eo;if(!x||x===eo||d.current!==t||i!=null){const _=new Map;for(let w of t){if(!w)continue;if(i&&i.length>0&&!i.includes(w.id)&&w.rect.current){_.set(w.id,w.rect.current);continue}const C=w.node.current,P=C?new qs(l(C),C):null;w.rect.current=P,P&&_.set(w.id,P)}return _}return x},[t,i,r,g,l]);return f.useEffect(()=>{d.current=t},[t]),f.useEffect(()=>{g||p()},[r,g]),f.useEffect(()=>{i&&i.length>0&&o(null)},[JSON.stringify(i)]),f.useEffect(()=>{g||typeof a!="number"||v.current!==null||(v.current=setTimeout(()=>{p(),v.current=null},a))},[a,g,p,...n]),{droppableRects:b,measureDroppableContainers:p,measuringScheduled:i!=null};function m(){switch(u){case Lr.Always:return!1;case Lr.BeforeDragging:return r;default:return!r}}}function Hs(t,e){return Fr(r=>t?r||(typeof e=="function"?e(t):t):null,[e,t])}function Gf(t,e){return Hs(t,e)}function Hf(t){let{callback:e,disabled:r}=t;const n=Tn(e),s=f.useMemo(()=>{if(r||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:i}=window;return new i(n)},[n,r]);return f.useEffect(()=>()=>s==null?void 0:s.disconnect(),[s]),s}function Nn(t){let{callback:e,disabled:r}=t;const n=Tn(e),s=f.useMemo(()=>{if(r||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:i}=window;return new i(n)},[r]);return f.useEffect(()=>()=>s==null?void 0:s.disconnect(),[s]),s}function Kf(t){return new qs(ur(t),t)}function to(t,e,r){e===void 0&&(e=Kf);const[n,s]=f.useState(null);function i(){s(l=>{if(!t)return null;if(t.isConnected===!1){var u;return(u=l??r)!=null?u:null}const d=e(t);return JSON.stringify(l)===JSON.stringify(d)?l:d})}const o=Hf({callback(l){if(t)for(const u of l){const{type:d,target:g}=u;if(d==="childList"&&g instanceof HTMLElement&&g.contains(t)){i();break}}}}),a=Nn({callback:i});return pt(()=>{i(),t?(a==null||a.observe(t),o==null||o.observe(document.body,{childList:!0,subtree:!0})):(a==null||a.disconnect(),o==null||o.disconnect())},[t]),n}function Vf(t){const e=Hs(t);return sa(t,e)}const ro=[];function Jf(t){const e=f.useRef(t),r=Fr(n=>t?n&&n!==ro&&t&&e.current&&t.parentNode===e.current.parentNode?n:An(t):ro,[t]);return f.useEffect(()=>{e.current=t},[t]),r}function Yf(t){const[e,r]=f.useState(null),n=f.useRef(t),s=f.useCallback(i=>{const o=Zn(i.target);o&&r(a=>a?(a.set(o,vs(o)),new Map(a)):null)},[]);return f.useEffect(()=>{const i=n.current;if(t!==i){o(i);const a=t.map(l=>{const u=Zn(l);return u?(u.addEventListener("scroll",s,{passive:!0}),[u,vs(u)]):null}).filter(l=>l!=null);r(a.length?new Map(a):null),n.current=t}return()=>{o(t),o(i)};function o(a){a.forEach(l=>{const u=Zn(l);u==null||u.removeEventListener("scroll",s)})}},[s,t]),f.useMemo(()=>t.length?e?Array.from(e.values()).reduce((i,o)=>rr(i,o),mt):da(t):mt,[t,e])}function no(t,e){e===void 0&&(e=[]);const r=f.useRef(null);return f.useEffect(()=>{r.current=null},e),f.useEffect(()=>{const n=t!==mt;n&&!r.current&&(r.current=t),!n&&r.current&&(r.current=null)},[t]),r.current?Pr(t,r.current):mt}function Xf(t){f.useEffect(()=>{if(!Rn)return;const e=t.map(r=>{let{sensor:n}=r;return n.setup==null?void 0:n.setup()});return()=>{for(const r of e)r==null||r()}},t.map(e=>{let{sensor:r}=e;return r}))}function Qf(t,e){return f.useMemo(()=>t.reduce((r,n)=>{let{eventName:s,handler:i}=n;return r[s]=o=>{i(o,e)},r},{}),[t,e])}function ga(t){return f.useMemo(()=>t?kf(t):null,[t])}const so=[];function Zf(t,e){e===void 0&&(e=ur);const[r]=t,n=ga(r?Ke(r):null),[s,i]=f.useState(so);function o(){i(()=>t.length?t.map(l=>ca(l)?n:new qs(e(l),l)):so)}const a=Nn({callback:o});return pt(()=>{a==null||a.disconnect(),o(),t.forEach(l=>a==null?void 0:a.observe(l))},[t]),s}function pa(t){if(!t)return null;if(t.children.length>1)return t;const e=t.children[0];return Mr(e)?e:t}function eg(t){let{measure:e}=t;const[r,n]=f.useState(null),s=f.useCallback(u=>{for(const{target:d}of u)if(Mr(d)){n(g=>{const h=e(d);return g?{...g,width:h.width,height:h.height}:h});break}},[e]),i=Nn({callback:s}),o=f.useCallback(u=>{const d=pa(u);i==null||i.disconnect(),d&&(i==null||i.observe(d)),n(d?e(d):null)},[e,i]),[a,l]=fn(o);return f.useMemo(()=>({nodeRef:a,rect:r,setRef:l}),[r,a,l])}const tg=[{sensor:Gs,options:{}},{sensor:zs,options:{}}],rg={current:{}},sn={draggable:{measure:Yi},droppable:{measure:Yi,strategy:Lr.WhileDragging,frequency:_s.Optimized},dragOverlay:{measure:ur}};class Er extends Map{get(e){var r;return e!=null&&(r=super.get(e))!=null?r:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:r}=e;return!r})}getNodeFor(e){var r,n;return(r=(n=this.get(e))==null?void 0:n.node.current)!=null?r:void 0}}const ng={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Er,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:mn},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:sn,measureDroppableContainers:mn,windowRect:null,measuringScheduled:!1},ma={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:mn,draggableNodes:new Map,over:null,measureDroppableContainers:mn},qr=f.createContext(ma),ba=f.createContext(ng);function sg(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Er}}}function ig(t,e){switch(e.type){case Ie.DragStart:return{...t,draggable:{...t.draggable,initialCoordinates:e.initialCoordinates,active:e.active}};case Ie.DragMove:return t.draggable.active==null?t:{...t,draggable:{...t.draggable,translate:{x:e.coordinates.x-t.draggable.initialCoordinates.x,y:e.coordinates.y-t.draggable.initialCoordinates.y}}};case Ie.DragEnd:case Ie.DragCancel:return{...t,draggable:{...t.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Ie.RegisterDroppable:{const{element:r}=e,{id:n}=r,s=new Er(t.droppable.containers);return s.set(n,r),{...t,droppable:{...t.droppable,containers:s}}}case Ie.SetDroppableDisabled:{const{id:r,key:n,disabled:s}=e,i=t.droppable.containers.get(r);if(!i||n!==i.key)return t;const o=new Er(t.droppable.containers);return o.set(r,{...i,disabled:s}),{...t,droppable:{...t.droppable,containers:o}}}case Ie.UnregisterDroppable:{const{id:r,key:n}=e,s=t.droppable.containers.get(r);if(!s||n!==s.key)return t;const i=new Er(t.droppable.containers);return i.delete(r),{...t,droppable:{...t.droppable,containers:i}}}default:return t}}function og(t){let{disabled:e}=t;const{active:r,activatorEvent:n,draggableNodes:s}=f.useContext(qr),i=gn(n),o=gn(r==null?void 0:r.id);return f.useEffect(()=>{if(!e&&!n&&i&&o!=null){if(!jn(i)||document.activeElement===i.target)return;const a=s.get(o);if(!a)return;const{activatorNode:l,node:u}=a;if(!l.current&&!u.current)return;requestAnimationFrame(()=>{for(const d of[l.current,u.current]){if(!d)continue;const g=ef(d);if(g){g.focus();break}}})}},[n,e,s,o,i]),null}function ya(t,e){let{transform:r,...n}=e;return t!=null&&t.length?t.reduce((s,i)=>i({transform:s,...n}),r):r}function ag(t){return f.useMemo(()=>({draggable:{...sn.draggable,...t==null?void 0:t.draggable},droppable:{...sn.droppable,...t==null?void 0:t.droppable},dragOverlay:{...sn.dragOverlay,...t==null?void 0:t.dragOverlay}}),[t==null?void 0:t.draggable,t==null?void 0:t.droppable,t==null?void 0:t.dragOverlay])}function lg(t){let{activeNode:e,measure:r,initialRect:n,config:s=!0}=t;const i=f.useRef(!1),{x:o,y:a}=typeof s=="boolean"?{x:s,y:s}:s;pt(()=>{if(!o&&!a||!e){i.current=!1;return}if(i.current||!n)return;const u=e==null?void 0:e.node.current;if(!u||u.isConnected===!1)return;const d=r(u),g=sa(d,n);if(o||(g.x=0),a||(g.y=0),i.current=!0,Math.abs(g.x)>0||Math.abs(g.y)>0){const h=oa(u);h&&h.scrollBy({top:g.y,left:g.x})}},[e,o,a,n,r])}const On=f.createContext({...mt,scaleX:1,scaleY:1});var At;(function(t){t[t.Uninitialized=0]="Uninitialized",t[t.Initializing=1]="Initializing",t[t.Initialized=2]="Initialized"})(At||(At={}));const cg=f.memo(function(e){var r,n,s,i;let{id:o,accessibility:a,autoScroll:l=!0,children:u,sensors:d=tg,collisionDetection:g=bf,measuring:h,modifiers:p,...v}=e;const b=f.useReducer(ig,void 0,sg),[m,x]=b,[_,w]=af(),[C,P]=f.useState(At.Uninitialized),k=C===At.Initialized,{draggable:{active:E,nodes:A,translate:L},droppable:{containers:X}}=m,J=E!=null?A.get(E):null,re=f.useRef({initial:null,translated:null}),me=f.useMemo(()=>{var F;return E!=null?{id:E,data:(F=J==null?void 0:J.data)!=null?F:rg,rect:re}:null},[E,J]),Ne=f.useRef(null),[ye,Ve]=f.useState(null),[Ee,st]=f.useState(null),qe=Ir(v,Object.values(v)),it=Br("DndDescribedBy",o),Xe=f.useMemo(()=>X.getEnabled(),[X]),Te=ag(h),{droppableRects:De,measureDroppableContainers:Qe,measuringScheduled:Pe}=Wf(Xe,{dragging:k,dependencies:[L.x,L.y],config:Te.droppable}),je=qf(A,E),j=f.useMemo(()=>Ee?pn(Ee):null,[Ee]),q=ee(),M=Gf(je,Te.draggable.measure);lg({activeNode:E!=null?A.get(E):null,config:q.layoutShiftCompensation,initialRect:M,measure:Te.draggable.measure});const O=to(je,Te.draggable.measure,M),S=to(je?je.parentElement:null),I=f.useRef({activatorEvent:null,active:null,activeNode:je,collisionRect:null,collisions:null,droppableRects:De,draggableNodes:A,draggingNode:null,draggingNodeRect:null,droppableContainers:X,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),D=X.getNodeFor((r=I.current.over)==null?void 0:r.id),$=eg({measure:Te.dragOverlay.measure}),Y=(n=$.nodeRef.current)!=null?n:je,Q=k?(s=$.rect)!=null?s:O:null,H=!!($.nodeRef.current&&$.rect),be=Vf(H?null:O),ne=ga(Y?Ke(Y):null),he=Jf(k?D??je:null),Je=Zf(he),le=ya(p,{transform:{x:L.x-be.x,y:L.y-be.y,scaleX:1,scaleY:1},activatorEvent:Ee,active:me,activeNodeRect:O,containerNodeRect:S,draggingNodeRect:Q,over:I.current.over,overlayNodeRect:$.rect,scrollableAncestors:he,scrollableAncestorRects:Je,windowRect:ne}),se=j?rr(j,L):null,ce=Yf(he),Fe=no(ce),Ze=no(ce,[O]),Et=rr(le,Fe),Ct=Q?vf(Q,le):null,Rt=me&&Ct?g({active:me,collisionRect:Ct,droppableRects:De,droppableContainers:Xe,pointerCoordinates:se}):null,dr=na(Rt,"id"),[ct,zr]=f.useState(null),In=H?le:rr(le,Ze),y=yf(In,(i=ct==null?void 0:ct.rect)!=null?i:null,O),T=f.useRef(null),R=f.useCallback((F,Z)=>{let{sensor:te,options:ie}=Z;if(Ne.current==null)return;const ue=A.get(Ne.current);if(!ue)return;const fe=F.nativeEvent,Ce=new te({active:Ne.current,activeNode:ue,event:fe,options:ie,context:I,onAbort(pe){if(!A.get(pe))return;const{onDragAbort:de}=qe.current,U={id:pe};de==null||de(U),_({type:"onDragAbort",event:U})},onPending(pe,oe,de,U){if(!A.get(pe))return;const{onDragPending:$e}=qe.current,ke={id:pe,constraint:oe,initialCoordinates:de,offset:U};$e==null||$e(ke),_({type:"onDragPending",event:ke})},onStart(pe){const oe=Ne.current;if(oe==null)return;const de=A.get(oe);if(!de)return;const{onDragStart:U}=qe.current,ge={activatorEvent:fe,active:{id:oe,data:de.data,rect:re}};Zt.unstable_batchedUpdates(()=>{U==null||U(ge),P(At.Initializing),x({type:Ie.DragStart,initialCoordinates:pe,active:oe}),_({type:"onDragStart",event:ge}),Ve(T.current),st(fe)})},onMove(pe){x({type:Ie.DragMove,coordinates:pe})},onEnd:ve(Ie.DragEnd),onCancel:ve(Ie.DragCancel)});T.current=Ce;function ve(pe){return async function(){const{active:de,collisions:U,over:ge,scrollAdjustedTranslate:$e}=I.current;let ke=null;if(de&&$e){const{cancelDrop:ze}=qe.current;ke={activatorEvent:fe,active:de,collisions:U,delta:$e,over:ge},pe===Ie.DragEnd&&typeof ze=="function"&&await Promise.resolve(ze(ke))&&(pe=Ie.DragCancel)}Ne.current=null,Zt.unstable_batchedUpdates(()=>{x({type:pe}),P(At.Uninitialized),zr(null),Ve(null),st(null),T.current=null;const ze=pe===Ie.DragEnd?"onDragEnd":"onDragCancel";if(ke){const ut=qe.current[ze];ut==null||ut(ke),_({type:ze,event:ke})}})}}},[A]),N=f.useCallback((F,Z)=>(te,ie)=>{const ue=te.nativeEvent,fe=A.get(ie);if(Ne.current!==null||!fe||ue.dndKit||ue.defaultPrevented)return;const Ce={active:fe};F(te,Z.options,Ce)===!0&&(ue.dndKit={capturedBy:Z.sensor},Ne.current=ie,R(te,Z))},[A,R]),z=zf(d,N);Xf(d),pt(()=>{O&&C===At.Initializing&&P(At.Initialized)},[O,C]),f.useEffect(()=>{const{onDragMove:F}=qe.current,{active:Z,activatorEvent:te,collisions:ie,over:ue}=I.current;if(!Z||!te)return;const fe={active:Z,activatorEvent:te,collisions:ie,delta:{x:Et.x,y:Et.y},over:ue};Zt.unstable_batchedUpdates(()=>{F==null||F(fe),_({type:"onDragMove",event:fe})})},[Et.x,Et.y]),f.useEffect(()=>{const{active:F,activatorEvent:Z,collisions:te,droppableContainers:ie,scrollAdjustedTranslate:ue}=I.current;if(!F||Ne.current==null||!Z||!ue)return;const{onDragOver:fe}=qe.current,Ce=ie.get(dr),ve=Ce&&Ce.rect.current?{id:Ce.id,rect:Ce.rect.current,data:Ce.data,disabled:Ce.disabled}:null,pe={active:F,activatorEvent:Z,collisions:te,delta:{x:ue.x,y:ue.y},over:ve};Zt.unstable_batchedUpdates(()=>{zr(ve),fe==null||fe(pe),_({type:"onDragOver",event:pe})})},[dr]),pt(()=>{I.current={activatorEvent:Ee,active:me,activeNode:je,collisionRect:Ct,collisions:Rt,droppableRects:De,draggableNodes:A,draggingNode:Y,draggingNodeRect:Q,droppableContainers:X,over:ct,scrollableAncestors:he,scrollAdjustedTranslate:Et},re.current={initial:Q,translated:Ct}},[me,je,Rt,Ct,A,Y,Q,De,X,ct,he,Et]),Mf({...q,delta:L,draggingRect:Ct,pointerCoordinates:se,scrollableAncestors:he,scrollableAncestorRects:Je});const W=f.useMemo(()=>({active:me,activeNode:je,activeNodeRect:O,activatorEvent:Ee,collisions:Rt,containerNodeRect:S,dragOverlay:$,draggableNodes:A,droppableContainers:X,droppableRects:De,over:ct,measureDroppableContainers:Qe,scrollableAncestors:he,scrollableAncestorRects:Je,measuringConfiguration:Te,measuringScheduled:Pe,windowRect:ne}),[me,je,O,Ee,Rt,S,$,A,X,De,ct,Qe,he,Je,Te,Pe,ne]),G=f.useMemo(()=>({activatorEvent:Ee,activators:z,active:me,activeNodeRect:O,ariaDescribedById:{draggable:it},dispatch:x,draggableNodes:A,over:ct,measureDroppableContainers:Qe}),[Ee,z,me,O,x,it,A,ct,Qe]);return xe.createElement(ea.Provider,{value:w},xe.createElement(qr.Provider,{value:G},xe.createElement(ba.Provider,{value:W},xe.createElement(On.Provider,{value:y},u)),xe.createElement(og,{disabled:(a==null?void 0:a.restoreFocus)===!1})),xe.createElement(uf,{...a,hiddenTextDescribedById:it}));function ee(){const F=(ye==null?void 0:ye.autoScrollEnabled)===!1,Z=typeof l=="object"?l.enabled===!1:l===!1,te=k&&!F&&!Z;return typeof l=="object"?{...l,enabled:te}:{enabled:te}}}),ug=f.createContext(null),io="button",dg="Draggable";function hg(t){let{id:e,data:r,disabled:n=!1,attributes:s}=t;const i=Br(dg),{activators:o,activatorEvent:a,active:l,activeNodeRect:u,ariaDescribedById:d,draggableNodes:g,over:h}=f.useContext(qr),{role:p=io,roleDescription:v="draggable",tabIndex:b=0}=s??{},m=(l==null?void 0:l.id)===e,x=f.useContext(m?On:ug),[_,w]=fn(),[C,P]=fn(),k=Qf(o,e),E=Ir(r);pt(()=>(g.set(e,{id:e,key:i,node:_,activatorNode:C,data:E}),()=>{const L=g.get(e);L&&L.key===i&&g.delete(e)}),[g,e]);const A=f.useMemo(()=>({role:p,tabIndex:b,"aria-disabled":n,"aria-pressed":m&&p===io?!0:void 0,"aria-roledescription":v,"aria-describedby":d.draggable}),[n,p,b,m,v,d.draggable]);return{active:l,activatorEvent:a,activeNodeRect:u,attributes:A,isDragging:m,listeners:n?void 0:k,node:_,over:h,setNodeRef:w,setActivatorNodeRef:P,transform:x}}function wa(){return f.useContext(ba)}const fg="Droppable",gg={timeout:25};function Ks(t){let{data:e,disabled:r=!1,id:n,resizeObserverConfig:s}=t;const i=Br(fg),{active:o,dispatch:a,over:l,measureDroppableContainers:u}=f.useContext(qr),d=f.useRef({disabled:r}),g=f.useRef(!1),h=f.useRef(null),p=f.useRef(null),{disabled:v,updateMeasurementsFor:b,timeout:m}={...gg,...s},x=Ir(b??n),_=f.useCallback(()=>{if(!g.current){g.current=!0;return}p.current!=null&&clearTimeout(p.current),p.current=setTimeout(()=>{u(Array.isArray(x.current)?x.current:[x.current]),p.current=null},m)},[m]),w=Nn({callback:_,disabled:v||!o}),C=f.useCallback((A,L)=>{w&&(L&&(w.unobserve(L),g.current=!1),A&&w.observe(A))},[w]),[P,k]=fn(C),E=Ir(e);return f.useEffect(()=>{!w||!P.current||(w.disconnect(),g.current=!1,w.observe(P.current))},[P,w]),f.useEffect(()=>(a({type:Ie.RegisterDroppable,element:{id:n,key:i,disabled:r,node:P,rect:h,data:E}}),()=>a({type:Ie.UnregisterDroppable,key:i,id:n})),[n]),f.useEffect(()=>{r!==d.current.disabled&&(a({type:Ie.SetDroppableDisabled,id:n,key:i,disabled:r}),d.current.disabled=r)},[n,i,r,a]),{active:o,rect:h,isOver:(l==null?void 0:l.id)===n,node:P,over:l,setNodeRef:k}}function pg(t){let{animation:e,children:r}=t;const[n,s]=f.useState(null),[i,o]=f.useState(null),a=gn(r);return!r&&!n&&a&&s(a),pt(()=>{if(!i)return;const l=n==null?void 0:n.key,u=n==null?void 0:n.props.id;if(l==null||u==null){s(null);return}Promise.resolve(e(u,i)).then(()=>{s(null)})},[e,n,i]),xe.createElement(xe.Fragment,null,r,n?f.cloneElement(n,{ref:o}):null)}const mg={x:0,y:0,scaleX:1,scaleY:1};function bg(t){let{children:e}=t;return xe.createElement(qr.Provider,{value:ma},xe.createElement(On.Provider,{value:mg},e))}const yg={position:"fixed",touchAction:"none"},wg=t=>jn(t)?"transform 250ms ease":void 0,vg=f.forwardRef((t,e)=>{let{as:r,activatorEvent:n,adjustScale:s,children:i,className:o,rect:a,style:l,transform:u,transition:d=wg}=t;if(!a)return null;const g=s?u:{...u,scaleX:1,scaleY:1},h={...yg,width:a.width,height:a.height,top:a.top,left:a.left,transform:It.Transform.toString(g),transformOrigin:s&&n?hf(n,a):void 0,transition:typeof d=="function"?d(n):d,...l};return xe.createElement(r,{className:o,style:h,ref:e},i)}),va=t=>e=>{let{active:r,dragOverlay:n}=e;const s={},{styles:i,className:o}=t;if(i!=null&&i.active)for(const[a,l]of Object.entries(i.active))l!==void 0&&(s[a]=r.node.style.getPropertyValue(a),r.node.style.setProperty(a,l));if(i!=null&&i.dragOverlay)for(const[a,l]of Object.entries(i.dragOverlay))l!==void 0&&n.node.style.setProperty(a,l);return o!=null&&o.active&&r.node.classList.add(o.active),o!=null&&o.dragOverlay&&n.node.classList.add(o.dragOverlay),function(){for(const[l,u]of Object.entries(s))r.node.style.setProperty(l,u);o!=null&&o.active&&r.node.classList.remove(o.active)}},xg=t=>{let{transform:{initial:e,final:r}}=t;return[{transform:It.Transform.toString(e)},{transform:It.Transform.toString(r)}]},_g={duration:250,easing:"ease",keyframes:xg,sideEffects:va({styles:{active:{opacity:"0"}}})};function kg(t){let{config:e,draggableNodes:r,droppableContainers:n,measuringConfiguration:s}=t;return Tn((i,o)=>{if(e===null)return;const a=r.get(i);if(!a)return;const l=a.node.current;if(!l)return;const u=pa(o);if(!u)return;const{transform:d}=Ke(o).getComputedStyle(o),g=ia(d);if(!g)return;const h=typeof e=="function"?e:Sg(e);return ha(l,s.draggable.measure),h({active:{id:i,data:a.data,node:l,rect:s.draggable.measure(l)},draggableNodes:r,dragOverlay:{node:o,rect:s.dragOverlay.measure(u)},droppableContainers:n,measuringConfiguration:s,transform:g})})}function Sg(t){const{duration:e,easing:r,sideEffects:n,keyframes:s}={..._g,...t};return i=>{let{active:o,dragOverlay:a,transform:l,...u}=i;if(!e)return;const d={x:a.rect.left-o.rect.left,y:a.rect.top-o.rect.top},g={scaleX:l.scaleX!==1?o.rect.width*l.scaleX/a.rect.width:1,scaleY:l.scaleY!==1?o.rect.height*l.scaleY/a.rect.height:1},h={x:l.x-d.x,y:l.y-d.y,...g},p=s({...u,active:o,dragOverlay:a,transform:{initial:l,final:h}}),[v]=p,b=p[p.length-1];if(JSON.stringify(v)===JSON.stringify(b))return;const m=n==null?void 0:n({active:o,dragOverlay:a,...u}),x=a.node.animate(p,{duration:e,easing:r,fill:"forwards"});return new Promise(_=>{x.onfinish=()=>{m==null||m(),_()}})}}let oo=0;function Eg(t){return f.useMemo(()=>{if(t!=null)return oo++,oo},[t])}const Cg=xe.memo(t=>{let{adjustScale:e=!1,children:r,dropAnimation:n,style:s,transition:i,modifiers:o,wrapperElement:a="div",className:l,zIndex:u=999}=t;const{activatorEvent:d,active:g,activeNodeRect:h,containerNodeRect:p,draggableNodes:v,droppableContainers:b,dragOverlay:m,over:x,measuringConfiguration:_,scrollableAncestors:w,scrollableAncestorRects:C,windowRect:P}=wa(),k=f.useContext(On),E=Eg(g==null?void 0:g.id),A=ya(o,{activatorEvent:d,active:g,activeNodeRect:h,containerNodeRect:p,draggingNodeRect:m.rect,over:x,overlayNodeRect:m.rect,scrollableAncestors:w,scrollableAncestorRects:C,transform:k,windowRect:P}),L=Hs(h),X=kg({config:n,draggableNodes:v,droppableContainers:b,measuringConfiguration:_}),J=L?m.setRef:void 0;return xe.createElement(bg,null,xe.createElement(pg,{animation:X},g&&E?xe.createElement(vg,{key:E,id:g.id,ref:J,as:a,activatorEvent:d,adjustScale:e,className:l,transition:i,rect:L,style:{zIndex:u,...s},transform:A},r):null))});function yn(t,e,r){const n=t.slice();return n.splice(r<0?n.length+r:r,0,n.splice(e,1)[0]),n}function Rg(t,e){return t.reduce((r,n,s)=>{const i=e.get(n);return i&&(r[s]=i),r},Array(t.length))}function en(t){return t!==null&&t>=0}function Tg(t,e){if(t===e)return!0;if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function jg(t){return typeof t=="boolean"?{draggable:t,droppable:t}:t}const Vs=t=>{let{rects:e,activeIndex:r,overIndex:n,index:s}=t;const i=yn(e,n,r),o=e[s],a=i[s];return!a||!o?null:{x:a.left-o.left,y:a.top-o.top,scaleX:a.width/o.width,scaleY:a.height/o.height}},xa="Sortable",_a=xe.createContext({activeIndex:-1,containerId:xa,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Vs,disabled:{draggable:!1,droppable:!1}});function Ag(t){let{children:e,id:r,items:n,strategy:s=Vs,disabled:i=!1}=t;const{active:o,dragOverlay:a,droppableRects:l,over:u,measureDroppableContainers:d}=wa(),g=Br(xa,r),h=a.rect!==null,p=f.useMemo(()=>n.map(k=>typeof k=="object"&&"id"in k?k.id:k),[n]),v=o!=null,b=o?p.indexOf(o.id):-1,m=u?p.indexOf(u.id):-1,x=f.useRef(p),_=!Tg(p,x.current),w=m!==-1&&b===-1||_,C=jg(i);pt(()=>{_&&v&&d(p)},[_,p,v,d]),f.useEffect(()=>{x.current=p},[p]);const P=f.useMemo(()=>({activeIndex:b,containerId:g,disabled:C,disableTransforms:w,items:p,overIndex:m,useDragOverlay:h,sortedRects:Rg(p,l),strategy:s}),[b,g,C.draggable,C.droppable,w,p,m,l,h,s]);return xe.createElement(_a.Provider,{value:P},e)}const Ng=t=>{let{id:e,items:r,activeIndex:n,overIndex:s}=t;return yn(r,n,s).indexOf(e)},Og=t=>{let{containerId:e,isSorting:r,wasDragging:n,index:s,items:i,newIndex:o,previousItems:a,previousContainerId:l,transition:u}=t;return!u||!n||a!==i&&s===o?!1:r?!0:o!==s&&e===l},Ig={duration:200,easing:"ease"},ka="transform",Pg=It.Transition.toString({property:ka,duration:0,easing:"linear"}),Lg={roleDescription:"sortable"};function Dg(t){let{disabled:e,index:r,node:n,rect:s}=t;const[i,o]=f.useState(null),a=f.useRef(r);return pt(()=>{if(!e&&r!==a.current&&n.current){const l=s.current;if(l){const u=ur(n.current,{ignoreTransform:!0}),d={x:l.left-u.left,y:l.top-u.top,scaleX:l.width/u.width,scaleY:l.height/u.height};(d.x||d.y)&&o(d)}}r!==a.current&&(a.current=r)},[e,r,n,s]),f.useEffect(()=>{i&&o(null)},[i]),i}function $g(t){let{animateLayoutChanges:e=Og,attributes:r,disabled:n,data:s,getNewIndex:i=Ng,id:o,strategy:a,resizeObserverConfig:l,transition:u=Ig}=t;const{items:d,containerId:g,activeIndex:h,disabled:p,disableTransforms:v,sortedRects:b,overIndex:m,useDragOverlay:x,strategy:_}=f.useContext(_a),w=Ug(n,p),C=d.indexOf(o),P=f.useMemo(()=>({sortable:{containerId:g,index:C,items:d},...s}),[g,s,C,d]),k=f.useMemo(()=>d.slice(d.indexOf(o)),[d,o]),{rect:E,node:A,isOver:L,setNodeRef:X}=Ks({id:o,data:P,disabled:w.droppable,resizeObserverConfig:{updateMeasurementsFor:k,...l}}),{active:J,activatorEvent:re,activeNodeRect:me,attributes:Ne,setNodeRef:ye,listeners:Ve,isDragging:Ee,over:st,setActivatorNodeRef:qe,transform:it}=hg({id:o,data:P,attributes:{...Lg,...r},disabled:w.draggable}),Xe=Yh(X,ye),Te=!!J,De=Te&&!v&&en(h)&&en(m),Qe=!x&&Ee,Pe=Qe&&De?it:null,j=De?Pe??(a??_)({rects:b,activeNodeRect:me,activeIndex:h,overIndex:m,index:C}):null,q=en(h)&&en(m)?i({id:o,items:d,activeIndex:h,overIndex:m}):C,M=J==null?void 0:J.id,O=f.useRef({activeId:M,items:d,newIndex:q,containerId:g}),S=d!==O.current.items,I=e({active:J,containerId:g,isDragging:Ee,isSorting:Te,id:o,index:C,items:d,newIndex:O.current.newIndex,previousItems:O.current.items,previousContainerId:O.current.containerId,transition:u,wasDragging:O.current.activeId!=null}),D=Dg({disabled:!I,index:C,node:A,rect:E});return f.useEffect(()=>{Te&&O.current.newIndex!==q&&(O.current.newIndex=q),g!==O.current.containerId&&(O.current.containerId=g),d!==O.current.items&&(O.current.items=d)},[Te,q,g,d]),f.useEffect(()=>{if(M===O.current.activeId)return;if(M!=null&&O.current.activeId==null){O.current.activeId=M;return}const Y=setTimeout(()=>{O.current.activeId=M},50);return()=>clearTimeout(Y)},[M]),{active:J,activeIndex:h,attributes:Ne,data:P,rect:E,index:C,newIndex:q,items:d,isOver:L,isSorting:Te,isDragging:Ee,listeners:Ve,node:A,overIndex:m,over:st,setNodeRef:Xe,setActivatorNodeRef:qe,setDroppableNodeRef:X,setDraggableNodeRef:ye,transform:D??j,transition:$()};function $(){if(D||S&&O.current.newIndex===C)return Pg;if(!(Qe&&!jn(re)||!u)&&(Te||I))return It.Transition.toString({...u,property:ka})}}function Ug(t,e){var r,n;return typeof t=="boolean"?{draggable:t,droppable:!1}:{draggable:(r=t==null?void 0:t.draggable)!=null?r:e.draggable,droppable:(n=t==null?void 0:t.droppable)!=null?n:e.droppable}}function wn(t){if(!t)return!1;const e=t.data.current;return!!(e&&"sortable"in e&&typeof e.sortable=="object"&&"containerId"in e.sortable&&"items"in e.sortable&&"index"in e.sortable)}const Mg=[ae.Down,ae.Right,ae.Up,ae.Left],Fg=(t,e)=>{let{context:{active:r,collisionRect:n,droppableRects:s,droppableContainers:i,over:o,scrollableAncestors:a}}=e;if(Mg.includes(t.code)){if(t.preventDefault(),!r||!n)return;const l=[];i.getEnabled().forEach(g=>{if(!g||g!=null&&g.disabled)return;const h=s.get(g.id);if(h)switch(t.code){case ae.Down:n.top<h.top&&l.push(g);break;case ae.Up:n.top>h.top&&l.push(g);break;case ae.Left:n.left>h.left&&l.push(g);break;case ae.Right:n.left<h.left&&l.push(g);break}});const u=pf({collisionRect:n,droppableRects:s,droppableContainers:l});let d=na(u,"id");if(d===(o==null?void 0:o.id)&&u.length>1&&(d=u[1].id),d!=null){const g=i.get(r.id),h=i.get(d),p=h?s.get(h.id):null,v=h==null?void 0:h.node.current;if(v&&p&&g&&h){const m=An(v).some((k,E)=>a[E]!==k),x=Sa(g,h),_=Bg(g,h),w=m||!x?{x:0,y:0}:{x:_?n.width-p.width:0,y:_?n.height-p.height:0},C={x:p.left,y:p.top};return w.x&&w.y?C:Pr(C,w)}}}};function Sa(t,e){return!wn(t)||!wn(e)?!1:t.data.current.sortable.containerId===e.data.current.sortable.containerId}function Bg(t,e){return!wn(t)||!wn(e)||!Sa(t,e)?!1:t.data.current.sortable.index<e.data.current.sortable.index}function qg({id:t,children:e,className:r,style:n}){const{setNodeRef:s,isOver:i}=Ks({id:`group-${t}`,data:{type:"group",category:t}});return c.jsx("div",{ref:s,style:n,className:`${r} ${i?"bg-blue-50/30 dark:bg-blue-900/10 rounded-xl transition-colors":""}`,children:e})}function zg({link:t,isEditMode:e,onDelete:r,onEdit:n,index:s}){const{attributes:i,listeners:o,setNodeRef:a,transform:l,transition:u,isDragging:d}=$g({id:t.id,data:{link:t}}),g={transform:It.Transform.toString(l),transition:u,opacity:d?.3:1,animationDelay:`${s*.03+.1}s`};return c.jsxs("div",{ref:a,style:g,...i,...o,className:`
                relative group flex items-center gap-4 p-3 pr-5
                bg-white dark:bg-[#1A1A1A] 
                rounded-xl shadow-sm hover:shadow-md
                transition-all duration-200 
                ${!e&&!d?"hover:-translate-y-0.5":""}
                h-16 w-full
                ${d?"":"animate-enter-card"}
                ${e?"cursor-grab active:cursor-grabbing animate-shake-infinite":"cursor-pointer"}
            `,onClick:h=>{e?(h.preventDefault(),n==null||n(t)):window.open(t.url,"_blank")},children:[c.jsxs("div",{className:"w-10 h-10 rounded-lg bg-gray-50 dark:bg-white/5 flex items-center justify-center border border-black/5 dark:border-white/5 shrink-0 pointer-events-none",children:[t.customLogoUrl||t.customLogoSignedUrl||t.icon?c.jsx("img",{src:t.customLogoUrl||t.customLogoSignedUrl||t.icon||"",alt:"",className:"w-6 h-6 object-contain",onError:h=>{h.currentTarget.style.display="none";const p=h.currentTarget.nextElementSibling;p&&(p.style.display="block")}}):null,c.jsx("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:t.color,display:t.customLogoUrl||t.customLogoSignedUrl||t.icon?"none":"block"}})]}),c.jsx("span",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 truncate pointer-events-none",children:t.customTitle||t.title}),e&&c.jsx("button",{className:"absolute -top-2 -right-2 w-6 h-6 bg-red-500 rounded-full flex items-center justify-center text-white shadow-md hover:scale-110 transition-transform cursor-pointer z-20",onPointerDown:h=>h.stopPropagation(),onClick:h=>{h.stopPropagation(),r==null||r(t.id)},children:c.jsx(ao,{className:"w-3 h-3"})})]})}function Wg({activeId:t}){const{setNodeRef:e,isOver:r}=Ks({id:"new-group-zone",data:{type:"new-group"}});return t?c.jsx("div",{ref:e,className:`
                mt-8 p-6 border-2 border-dashed rounded-[2rem] flex items-center justify-center
                transition-all duration-300
                ${r?"border-blue-500 bg-blue-50/50 dark:bg-blue-500/10 scale-105":"border-gray-300 dark:border-white/10 opacity-60"}
            `,children:c.jsxs("p",{className:"text-gray-500 dark:text-gray-400 font-medium flex items-center gap-2",children:[c.jsx(nn,{className:"w-5 h-5"}),"Drop here to create a new group"]})}):null}function Gg({isOpen:t,onClose:e,onConfirm:r}){return t?c.jsx("div",{className:"fixed inset-0 z-[100020] flex items-center justify-center p-4 bg-black/20 dark:bg-black/80 backdrop-blur-xl animate-in fade-in duration-200",children:c.jsxs("div",{className:"bg-white dark:bg-[#1A1A1A] w-full max-w-sm rounded-[2rem] shadow-2xl border border-black/5 dark:border-white/10 p-6 animate-in zoom-in-95 duration-200",children:[c.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-2",children:"Delete Shortcut?"}),c.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-6",children:"This action cannot be undone."}),c.jsxs("div",{className:"flex justify-end gap-3",children:[c.jsx("button",{onClick:e,className:"px-4 py-2 rounded-xl bg-gray-100 dark:bg-white/5 text-gray-600 dark:text-gray-300 text-xs font-bold uppercase tracking-wide hover:bg-gray-200 dark:hover:bg-white/10",children:"Cancel"}),c.jsx("button",{onClick:r,className:"px-4 py-2 rounded-xl bg-red-500 text-white text-xs font-bold uppercase tracking-wide hover:bg-red-600 shadow-lg shadow-red-500/20",children:"Delete"})]})]})}):null}function Hg({links:t,onUpdate:e,isAuthenticated:r,onLoginRequired:n,canAddMore:s}){const[i,o]=f.useState(!1),a=j=>{if(!r){n();return}if(!s){alert("You've reached your gateway limit. Please upgrade to Pro for more.");return}k({isOpen:!0,category:j})},[l,u]=f.useState(!1),[d,g]=f.useState(0),[h,p]=f.useState(t),v=f.useRef(h);f.useEffect(()=>{p(t),v.current=t},[t]),f.useEffect(()=>{v.current=h},[h]);const[b,m]=f.useState(!1),[x,_]=f.useState(null),[w,C]=f.useState(null),[P,k]=f.useState({isOpen:!1,category:""}),[E,A]=f.useState(null),[L,X]=f.useState(null),J=f.useRef(0),re=f.useRef(null),me=f.useRef(null),Ne=df(Ki(Gs,{activationConstraint:{distance:8}}),Ki(zs,{coordinateGetter:Fg})),ye=f.useMemo(()=>{const j={å¿«æ·æŒ‡ä»¤:[]};return h.forEach(q=>{let M=q.category||"å¿«æ·æŒ‡ä»¤";M==="Shortcuts"&&(M="å¿«æ·æŒ‡ä»¤"),j[M]||(j[M]=[]),j[M].push(q)}),j},[h]),Ve=f.useMemo(()=>Object.keys(ye).sort((j,q)=>{const M=j==="å¿«æ·æŒ‡ä»¤",O=q==="å¿«æ·æŒ‡ä»¤";return M&&!O?-1:!M&&O?1:0}),[ye]),Ee=j=>{_(j.active.id)},st=j=>{const q={id:crypto.randomUUID(),title:j.title||new URL(j.url).hostname,url:j.url,icon:null,color:"#cbd5e1",category:j.category,customLogoUrl:j.logoFile?URL.createObjectURL(j.logoFile):void 0};ye[j.category];const M=[...h,q];p(M),e(M),k({isOpen:!1,category:""});const O=`https://www.google.com/s2/favicons?sz=64&domain_url=${encodeURIComponent(j.url)}`,S=new Image;S.src=O,S.onload=()=>{p(I=>I.map(D=>D.id===q.id?{...D,icon:O}:D))}},qe=j=>{var Q;const{active:q,over:M}=j;if(!M)return;const O=q.id,S=M.id;if(O===S)return;if(typeof S=="string"&&S.startsWith("group-")){const H=(Q=M.data.current)==null?void 0:Q.category,be=h.find(ne=>ne.id===O);be&&H&&be.category!==H&&p(ne=>ne.map(he=>he.id===O?{...he,category:H}:he));return}const I=h.find(H=>H.id===q.id),D=h.find(H=>H.id===S);if(!I||!D)return;const $=I.category||"Shortcuts",Y=D.category||"Shortcuts";if($!==Y){const H=h.findIndex(he=>he.id===q.id),be=h.findIndex(he=>he.id===S);let ne=[...h];ne[H]={...ne[H],category:Y},ne=yn(ne,H,be),p(ne)}else{const H=h.findIndex(ne=>ne.id===q.id),be=h.findIndex(ne=>ne.id===S);H!==be&&p(yn(h,H,be))}},it=j=>{const{active:q,over:M}=j;if(_(null),!M){e(v.current);return}if(M.id==="new-group-zone"){const O=h.find(D=>D.id===q.id);if(!O)return;const S=`New Group ${Object.keys(ye).length}`,I=h.map(D=>D.id===O.id?{...D,category:S}:D);p(I),e(I),m(!0),C(S);return}e(v.current)},Xe=(j,q)=>{if(!q.trim()||j===q){C(null);return}const M=h.map(O=>O.category===j||!O.category&&j==="Shortcuts"?{...O,category:q}:O);p(M),e(M),C(null)},Te=j=>{if(!E)return;const q=h.map(M=>M.id===E.id?j.reset?{...M,url:j.url,customTitle:void 0,customLogoUrl:void 0,customLogoHash:void 0,category:j.category}:{...M,url:j.url,customTitle:j.customTitle||void 0,customLogoUrl:j.logoFile?URL.createObjectURL(j.logoFile):M.customLogoUrl,category:j.category}:M);p(q),e(q),A(null)},De=()=>{const j=`New Group ${Object.keys(ye).length}`,q={id:`ghost-${crypto.randomUUID()}`,title:"Ghost Link",url:"about:blank",icon:null,color:"transparent",category:j},M=[...h,q];p(M),e(M),m(!0),C(j)};f.useEffect(()=>{const j=me.current;if(!j)return;const q=150,M=.25,O=S=>{i||(S.preventDefault(),re.current&&window.clearTimeout(re.current),J.current+=S.deltaY,J.current<0&&(J.current=0),J.current>q?(o(!0),g(0),J.current=0):(g(J.current*M),re.current=window.setTimeout(()=>{g(0),J.current=0},150)))};return l&&j.addEventListener("wheel",O,{passive:!1}),()=>{j.removeEventListener("wheel",O),re.current&&window.clearTimeout(re.current)}},[l,i]),f.useEffect(()=>{const j=q=>{if(q.key==="Escape")if(P.isOpen)k({...P,isOpen:!1});else if(E)A(null);else if(b){const M={...ye},O=h.filter(S=>S.id.startsWith("ghost-")?(M[S.category||""]||[]).filter($=>!$.id.startsWith("ghost-")).length>0:!0);O.length!==h.length&&(p(O),e(O)),m(!1)}else i&&o(!1)};return window.addEventListener("keydown",j),()=>window.removeEventListener("keydown",j)},[i,b,P.isOpen,E]);const Qe={sideEffects:va({styles:{active:{opacity:"0.4"}}})},Pe=x?h.find(j=>j.id===x):null,je=f.useMemo(()=>h.filter(j=>(j.category==="Shortcuts"||j.category==="å¿«æ·æŒ‡ä»¤"||!j.category)&&!j.id.startsWith("ghost-")),[h]);return c.jsxs("div",{className:"w-full flex justify-center mb-10 relative z-10 font-sans px-8",children:[c.jsx("div",{className:"w-full max-w-7xl",children:c.jsx("div",{ref:me,onMouseEnter:()=>u(!0),onMouseLeave:()=>{u(!1),g(0),J.current=0},className:`
                    relative group transition-all duration-300 ease-out
                    rounded-[2rem] bg-white dark:bg-[#111111] 
                    border border-gray-100 dark:border-white/5 
                    shadow-sm dark:shadow-none
                    ${l?"shadow-lg border-blue-200/50 dark:border-blue-500/20":""}
                `,style:{transform:l&&d>0?`scale(${1+d*5e-4})`:"scale(1)"},role:"button",children:c.jsxs("div",{className:"overflow-hidden h-[200px] px-6 py-6 md:px-8 md:py-8 relative rounded-[2rem]",children:[c.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3 md:gap-4",style:{transform:`translateY(${-d}px)`},children:je.slice(0,18).map(j=>c.jsxs("div",{onClick:q=>{q.stopPropagation(),window.open(j.url,"_blank")},className:"flex items-center gap-3 px-3 py-3 rounded-xl border border-black/5 dark:border-white/5 bg-gray-50/50 dark:bg-white/5 h-[64px] w-full cursor-pointer hover:bg-black/5 dark:hover:bg-white/10 transition-colors",children:[c.jsx("div",{className:"w-10 h-10 rounded-xl bg-white dark:bg-gray-800 flex items-center justify-center border border-black/5 dark:border-white/5 flex-shrink-0",children:j.customLogoUrl||j.customLogoSignedUrl||j.icon?c.jsx("img",{src:j.customLogoUrl||j.customLogoSignedUrl||j.icon||"",className:"w-6 h-6 object-contain"}):c.jsx("div",{className:"w-3.5 h-3.5 rounded-full",style:{backgroundColor:j.color}})}),c.jsx("span",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200 truncate",children:j.customTitle||j.title})]},j.id))}),c.jsx("div",{className:`absolute bottom-0 left-0 w-full h-12 pointer-events-none rounded-b-[2rem] bg-gradient-to-t from-white via-white/60 dark:from-[#111111] dark:via-[#111111]/60 to-transparent transition-opacity duration-300 ${l?"opacity-0":"opacity-100"}`}),h.length>0&&c.jsx("div",{className:`
                            absolute bottom-6 left-1/2 -translate-x-1/2 pointer-events-none
                            transition-all duration-500 delay-100
                            ${l&&d<10?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}
                        `,children:c.jsx("div",{onClick:j=>{j.stopPropagation(),o(!0)},className:"bg-gray-900/90 dark:bg-white/90 backdrop-blur text-white dark:text-gray-900 text-[10px] font-bold px-4 py-2 rounded-full shadow-xl flex items-center gap-2 whitespace-nowrap border border-white/10 dark:border-black/5 pointer-events-auto cursor-pointer hover:scale-105 active:scale-95 transition-all",children:c.jsx("span",{children:"Expand"})})})]})})}),i&&Zt.createPortal(c.jsx(cg,{sensors:Ne,collisionDetection:gf,onDragStart:Ee,onDragOver:qe,onDragEnd:it,children:c.jsxs("div",{className:"fixed inset-0 z-[100000] opacity-100 visible font-sans",children:[c.jsx("div",{className:"absolute inset-0 bg-gray-200/95 dark:bg-black/95 backdrop-blur-3xl z-[100001]",onClick:()=>!b&&o(!1)}),c.jsx("div",{className:"absolute top-0 left-0 right-0 h-24 bg-gradient-to-b from-gray-200 via-gray-200/95 to-transparent dark:from-black dark:via-black/95 dark:to-transparent z-[100003] pointer-events-none"}),c.jsxs("div",{className:"absolute top-8 left-8 right-8 z-[100004] flex items-center justify-end gap-4",children:[c.jsxs("button",{onClick:De,className:"bg-white/50 dark:bg-white/5 text-blue-600 dark:text-blue-400 px-4 py-2.5 rounded-xl text-xs font-bold uppercase tracking-widest hover:bg-white dark:hover:bg-white/10 hover:shadow-lg transition-all flex items-center gap-2 border border-blue-200/50 dark:border-blue-500/20",children:[c.jsx(nn,{className:"w-4 h-4"}),c.jsx("span",{children:"New Group"})]}),c.jsxs("button",{onClick:()=>a("å¿«æ·æŒ‡ä»¤"),className:"bg-white/50 dark:bg-white/5 text-orange-600 dark:text-orange-400 px-4 py-2.5 rounded-xl text-xs font-bold uppercase tracking-widest hover:bg-white dark:hover:bg-white/10 hover:shadow-lg transition-all flex items-center gap-2 border border-orange-200/50 dark:border-orange-500/20",children:[c.jsx(nn,{className:"w-4 h-4"}),c.jsx("span",{children:"Add Gateway"})]}),c.jsx("div",{className:"w-px h-8 bg-black/5 dark:bg-white/5 mx-2"}),c.jsxs("button",{onClick:()=>{if(b){const j={...ye},q=h.filter(M=>M.id.startsWith("ghost-")?(j[M.category||""]||[]).filter(I=>!I.id.startsWith("ghost-")).length>0:!0);q.length!==h.length&&(p(q),e(q)),m(!1)}else m(!0)},className:`
                                    p-2.5 rounded-full transition-all flex items-center gap-2 px-5
                                    ${b?"bg-black text-white dark:bg-white dark:text-black shadow-lg scale-105":"bg-white/50 dark:bg-white/5 text-gray-600 dark:text-gray-300 hover:bg-white dark:hover:bg-white/10 border border-gray-200/50 dark:border-white/5"}
                                `,children:[b?c.jsx(Kh,{className:"w-4 h-4"}):c.jsx(Gi,{className:"w-4 h-4"}),c.jsx("span",{className:"font-bold text-[10px] tracking-widest",children:b?"DONE":"EDIT"})]}),c.jsx("button",{onClick:()=>{if(b){const j={...ye},q=h.filter(M=>M.id.startsWith("ghost-")?(j[M.category||""]||[]).filter(I=>!I.id.startsWith("ghost-")).length>0:!0);q.length!==h.length&&(p(q),e(q)),m(!1)}o(!1)},className:"p-2.5 bg-gray-100 dark:bg-white/5 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-white/10 transition-colors border border-transparent hover:border-black/5 dark:hover:border-white/5",children:c.jsx(ao,{className:"w-5 h-5"})})]}),c.jsx("div",{className:"relative z-[100002] w-full h-full overflow-y-auto",children:c.jsx("div",{className:"w-full max-w-[90%] mx-auto pt-24 pb-32 px-8",children:c.jsxs("div",{className:"space-y-12",children:[Ve.map((j,q)=>{const M=ye[j],O=j==="å¿«æ·æŒ‡ä»¤",S=(M==null?void 0:M.filter(I=>!I.id.startsWith("ghost-")))||[];return!b&&!O&&S.length===0?null:c.jsxs(qg,{id:j,className:"animate-in fade-in slide-in-from-bottom-4 duration-500 fill-mode-backwards",style:{animationDelay:`${q*.05}s`},children:[c.jsx("div",{className:"mb-5 pl-1 group/title",children:c.jsx("div",{className:"flex items-center gap-4",children:w===j&&!O?c.jsx("input",{autoFocus:!0,defaultValue:j,onBlur:I=>Xe(j,I.currentTarget.value),onKeyDown:I=>{I.key==="Enter"&&Xe(j,I.currentTarget.value)},className:"text-2xl font-bold bg-transparent border-b-2 border-blue-500 outline-none text-gray-900 dark:text-white pb-1"}):c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",onDoubleClick:()=>b&&!O&&C(j),children:j==="Shortcuts"?"å¿«æ·æŒ‡ä»¤":j}),b&&!O&&c.jsx("button",{onClick:()=>C(j),className:"opacity-0 group-hover/title:opacity-100 p-1.5 hover:bg-black/5 dark:hover:bg-white/10 rounded-lg text-gray-400 transition-opacity",children:c.jsx(Gi,{className:"w-4 h-4"})})]}),O&&c.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-medium",children:"å¸¸ç”¨å¿«æ·æŒ‡ä»¤ä¸å·¥å…·é›†åˆ"})]})})}),c.jsx(Ag,{items:S.map(I=>I.id),strategy:Vs,children:c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-7 2xl:grid-cols-8 gap-4",children:[S.map((I,D)=>c.jsx(xe.Fragment,{children:c.jsx(zg,{link:I,isEditMode:b,index:q*10+D,onDelete:$=>X($),onEdit:$=>A($)})},I.id)),c.jsx("button",{onClick:()=>a(j==="Shortcuts"?"å¿«æ·æŒ‡ä»¤":j),className:`
                                                                flex items-center justify-center p-3
                                                                bg-white/50 dark:bg-white/5 border-2 border-dashed border-gray-300 dark:border-white/10
                                                                rounded-xl hover:bg-white dark:hover:bg-white/10 hover:border-orange-400 dark:hover:border-orange-500
                                                                transition-all h-16 w-full group
                                                                ${b?"opacity-40 pointer-events-none":""}
                                                            `,children:c.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-100 dark:bg-white/10 flex items-center justify-center group-hover:scale-110 transition-transform",children:c.jsx(nn,{className:"w-5 h-5 text-gray-400 group-hover:text-orange-500 transition-colors"})})})]})})]},j)}),b&&c.jsx(Wg,{activeId:x})]})})}),c.jsx(Cg,{dropAnimation:Qe,children:Pe?c.jsx("div",{className:"opacity-90 scale-105 cursor-grabbing",children:c.jsxs("div",{className:"flex items-center gap-4 p-3 pr-5 bg-white dark:bg-[#222] rounded-xl shadow-2xl border border-blue-500/30 h-16 w-[200px]",children:[c.jsx("div",{className:"w-10 h-10 rounded-lg bg-gray-50 dark:bg-white/5 flex items-center justify-center border border-black/5 dark:border-white/5 shrink-0",children:(Pe.customLogoUrl||Pe.icon)&&c.jsx("img",{src:Pe.customLogoUrl||Pe.icon||"",className:"w-6 h-6 object-contain"})}),c.jsx("span",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 truncate",children:Pe.title})]})}):null}),c.jsx(Oa,{isOpen:P.isOpen,initialCategory:P.category,categories:Ve,onClose:()=>k({isOpen:!1,category:""}),onSave:st}),c.jsx(Xo,{isOpen:!!E,link:E,categories:Ve,onClose:()=>A(null),onSave:Te}),c.jsx(Gg,{isOpen:!!L,onClose:()=>X(null),onConfirm:()=>{if(L){const j=h.filter(q=>q.id!==L);p(j),e(j),X(null)}}})]})}),document.body)]})}function Kg(t,e){const r=f.useRef(e);f.useEffect(()=>{r.current=e},[e]),f.useEffect(()=>{if(typeof chrome>"u"||!chrome.storage||!chrome.storage.local)return;const n={gateways:t.links,user:t.user||null,subscriptionTier:t.subscriptionTier||"unauthenticated",limits:vt};chrome.storage.local.set(n)},[t.links,t.user,t.subscriptionTier]),f.useEffect(()=>{if(typeof chrome>"u"||!chrome.storage||!chrome.storage.local)return;const n=(s,i)=>{if(i==="local"&&s.pendingGateway){const o=s.pendingGateway.newValue;if(!o)return;r.current(a=>a.links.some(u=>u.id===o.id)?a:{...a,links:[...a.links,o]}),chrome.storage.local.remove("pendingGateway")}};return chrome.storage.onChanged.addListener(n),()=>{chrome.storage.onChanged.removeListener(n)}},[])}const Vg=()=>{f.useEffect(()=>{document.documentElement.style.height="100%",document.body.style.height="100%";const y=document.getElementById("root");y&&(y.style.height="100%")},[]);const[t,e]=f.useState(()=>{const y=localStorage.getItem("focus_tab_state"),T=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";let R=null;try{const N=localStorage.getItem("focus_tab_user");N&&(R=JSON.parse(N))}catch(N){console.error("[App] Failed to parse saved user",N)}if(y)try{const N=JSON.parse(y);if(N.version===ni)return{...N,user:R}}catch(N){console.error("Restore failed",N)}return{version:ni,links:hc,requests:ii,pinnedSnippetId:null,language:"English",user:R,theme:T}}),[r,n]=f.useState(null),[s,i]=f.useState(!1),[o,a]=f.useState(!1),[l,u]=f.useState(!1),[d,g]=f.useState([]),[h,p]=f.useState(0),[v,b]=f.useState(!1),[m,x]=f.useState(!1),[_,w]=f.useState(!1),[C,P]=f.useState(!1),[k,E]=f.useState(!1),[A,L]=f.useState(!0),[X,J]=f.useState(0),re=!!t.user,[me,Ne]=f.useState(""),[ye,Ve]=f.useState(()=>localStorage.getItem("focus_tab_search_engine")||fc),[Ee,st]=f.useState(!1),[qe,it]=f.useState(!1),Xe=f.useRef(null),Te=f.useRef(null),De=f.useRef(null),[Qe,Pe]=f.useState(!1),je=f.useRef(null),j=f.useRef(0),q=f.useRef(!1),M=f.useRef(t);f.useEffect(()=>{M.current=t,M.current=t},[t]);const O=f.useCallback((y,T="info")=>{const R=Date.now().toString();g(N=>[...N,{id:R,message:y,type:T}]),setTimeout(()=>g(N=>N.filter(z=>z.id!==R)),3e3)},[]),S=f.useCallback(async(y,T=!1)=>{let R;if(typeof y=="function"?await new Promise(N=>{e(z=>(R=y(z),localStorage.setItem("focus_tab_state",JSON.stringify({...R,user:null})),N(),R))}):(R=y,localStorage.setItem("focus_tab_state",JSON.stringify({...R,user:null})),e(R)),R.user&&!T){u(!0);try{await Mi(R),console.log("[App] State saved and synced to Supabase successfully")}catch(N){throw console.error("[App] Failed to sync state to Supabase:",N),O("Failed to save changes. Please try again.","error"),N}finally{u(!1)}}},[O]);Kg(t,S);const I=f.useCallback(async y=>{try{u(!0);const[T,R,N]=await Promise.all([Us(y.id),xr(y.id),_r(y.id)]),z={...y,...T,...R&&{memberViaRedeem:R.memberViaRedeem,membershipSince:R.membershipSince},...N&&{redeemEnabled:N.redeemEnabled}},W=Ft(z);e(ue=>({...ue,user:z,subscriptionTier:W}));const[G,ee]=await Promise.all([vh(y.id),ph(y.id)]),F={};for(const ue of ee)F[ue.canonical_url]=ue;const Z=localStorage.getItem("startly_intention_local");let te=Array.isArray(G==null?void 0:G.requests)?G.requests:ii,ie=null;Z&&(te.some(fe=>fe.prompt===Z)||(ie=Z,te=[{id:"migrated_"+Date.now(),prompt:Z,active:!0},...te]),localStorage.removeItem("startly_intention_local"),P(!1)),e(ue=>{if(G){console.log("[App] Cloud data found, merging with current state");const fe=(G.links||[]).map(ve=>{let pe=ve.canonicalUrl||ve.url;try{pe=ve.canonicalUrl||Ot(ve.url)}catch{}const oe=F[pe],de={...ve,canonicalUrl:pe,customTitle:(oe==null?void 0:oe.custom_title)??ve.customTitle??null,customLogoPath:(oe==null?void 0:oe.custom_logo_path)??ve.customLogoPath??null,customLogoUrl:(oe==null?void 0:oe.custom_logo_url)??ve.customLogoUrl??null,customLogoSignedUrl:(oe==null?void 0:oe.custom_logo_signed_url)??ve.customLogoSignedUrl??null,customLogoHash:(oe==null?void 0:oe.custom_logo_hash)??ve.customLogoHash??null};if(de.customLogoHash&&!Cn(pe,de.customLogoHash)){const ge=de.customLogoUrl||de.customLogoSignedUrl;if(ge){let $e=ge;if(de.customLogoPath&&!ge.includes(".webp")){const ke=de.customLogoPath.split("/");ke[ke.length-1].includes(".")||($e=ge.replace(/([^/]+)$/,"$1.webp"))}Nh(pe,$e,de.customLogoHash,de.customLogoPath||void 0).then(ke=>{ke&&e(ze=>({...ze}))}).catch(ke=>console.warn("[App] Logo download failed:",ke))}}return de.customLogoPath&&(!de.customLogoSignedUrl||de.customLogoSignedUrl.includes("token=")),de}),Ce={...ue,links:fe,requests:te,language:G.language||ue.language,theme:G.theme||ue.theme,user:z,subscriptionTier:W,version:G.version||ue.version,pinnedSnippetId:G.pinnedSnippetId||ue.pinnedSnippetId};return S(Ce,!0).catch(ve=>console.error("[App] Failed to save merged state:",ve)),ie&&setTimeout(()=>$(!0),500),Ce}else{console.log("[App] No cloud data found, syncing current state");const fe={...ue,user:z,subscriptionTier:W,requests:te};return Mi(fe).catch(Ce=>console.error("[App] Failed to sync to cloud:",Ce)),ie&&setTimeout(()=>$(!0),500),fe}})}catch(T){console.error("Login flow failed",T),O("Login failed via Extension","error")}finally{u(!1)}},[S]),D=async()=>{Rc?await Ic(y=>{I(y),b(!1),O(`Welcome back, ${y.name.split(" ")[0]}`)}):Ac(y=>{y&&I(y)})},$=f.useCallback(async(y=!1)=>{if(!y){const W=Yn(t);if(!W.allowed){if(W.reason==="context_needed"){w(!0),E(!0),setTimeout(()=>E(!1),600);return}return}}if(!y&&!re&&(_||C)){E(!0),setTimeout(()=>E(!1),600);return}let T=t.requests.filter(W=>W.active);if(!t.user){const W=localStorage.getItem("startly_intention_local");W&&(T=[{id:"local_preference",prompt:W,active:!0}])}if(T.length===0)return;const R=T.length>1&&je.current?T.filter(W=>W.id!==je.current):T,N=R[Math.floor(Math.random()*R.length)],z=++j.current;if(!t.user&&!y&&!Yn(t).allowed){n(null),n("[h]Daily limit reached.[/h] Sign in for unlimited perspectives."),i(!1),O("Daily limit reached","error");return}if(!y)try{const W=localStorage.getItem("pending_perspective");if(W){const G=JSON.parse(W);if(Date.now()-G.timestamp<5400*1e3){console.log("[App] Zero-Latency Hit! Using cached perspective."),n(G.text);const ee=Un(),F=ci(G.text,"dynamic_plan",ee,{intent:G.plan.intent,style:G.plan.style,theme:G.plan.selected_theme});ui(F),t.user||Fi()>=2&&w(!0),p(Z=>Z+1),localStorage.removeItem("pending_perspective"),setTimeout(()=>Y(),5e3);return}else console.log("[App] Cache expired, discarding."),localStorage.removeItem("pending_perspective")}}catch(W){console.warn("[App] Cache parse failed",W),localStorage.removeItem("pending_perspective")}try{if(i(!0),n(null),!N)throw new Error("No eligible perspective prompts found");const W=Un(),G=new Date,ee={local_time:G.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),weekday:G.getDay(),is_weekend:G.getDay()===0||G.getDay()===6,session_count_today:hi(W),minutes_since_last:yc(W),late_night_streak:di(W),work_mode_disabled:!1,custom_themes:t.requests.filter(ie=>ie.active).map(ie=>ie.prompt),language:t.language,recent_history:W};if(!t.user){const ie=localStorage.getItem("startly_intention_local");ie&&!ee.custom_themes.includes(ie)&&(ee.custom_themes=[ie,...ee.custom_themes])}console.log("[App] Generating new perspective with Router Context...",{time:ee.local_time,themes:ee.custom_themes.length,todayCount:ee.session_count_today}),!t.user&&!y&&Fi()>=2&&w(!0);const{text:F,plan:Z}=await ss(ee,0);if(z!==j.current)return;console.log("[App] Generated perspective:",F.substring(0,50));const te=ci(F,"dynamic_plan",W,{intent:Z.intent,style:Z.style,theme:Z.selected_theme});ui(te),n(F),p(ie=>ie+1)}catch(W){if(z!==j.current)return;console.error("[App] Error generating perspective:",W),O("Failed to generate perspective","error")}finally{z===j.current&&i(!1),setTimeout(()=>Y(),2e3)}},[t]),Y=f.useCallback(async()=>{if(!(!Yn(t).allowed&&!t.user))try{console.log("[App] Prefetching next perspective in background...");const T=Un(),R=new Date,N={local_time:R.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"}),weekday:R.getDay(),is_weekend:R.getDay()===0||R.getDay()===6,session_count_today:hi(T),minutes_since_last:60,late_night_streak:di(T),work_mode_disabled:!1,custom_themes:t.requests.filter(G=>G.active).map(G=>G.prompt),language:t.language,recent_history:T};if(!t.user){const G=localStorage.getItem("startly_intention_local");G&&!N.custom_themes.includes(G)&&(N.custom_themes=[G,...N.custom_themes])}const{text:z,plan:W}=await ss(N);if(z){const G={text:z,plan:W,timestamp:Date.now()};localStorage.setItem("pending_perspective",JSON.stringify(G)),console.log("[App] Prefetch success, cached:",z.substring(0,30))}}catch(T){console.warn("[App] Prefetch failed (silent):",T)}},[t]),Q=f.useCallback(y=>{if(y.trim()){if(y.length>200){O("Preference too long (max 200 chars)","error");return}if(!t.user)localStorage.setItem("startly_intention_local",y),P(!0),O("Preference saved locally"),setTimeout(()=>$(!0),100);else{const T={id:"req_"+Date.now(),prompt:y,active:!0};S(R=>({...R,requests:[T,...R.requests]})).then(()=>{O("Preference saved to account"),setTimeout(()=>$(!0),100)})}x(!1)}},[t.user,O,S,$]),H=y=>y.split(/\[h\](.*?)\[\/h\]/g).map((R,N)=>N%2===1?c.jsx("span",{className:"text-purple-600 dark:text-purple-400",children:R},N):c.jsx("span",{children:R},N)),be=()=>c.jsxs("div",{className:"flex flex-col items-center gap-6 py-4 animate-pulse",role:"status","aria-label":"Loading perspective",children:[c.jsx("div",{className:"h-10 md:h-14 lg:h-16 bg-gray-200/60 dark:bg-white/5 rounded-2xl w-3/4"}),c.jsx("div",{className:"h-10 md:h-14 lg:h-16 bg-gray-200/40 dark:bg-white/5 rounded-2xl w-5/6"}),c.jsx("div",{className:"h-10 md:h-14 lg:h-16 bg-gray-200/20 dark:bg-white/5 rounded-2xl w-1/2"})]});f.useEffect(()=>{t.theme==="dark"?(document.documentElement.classList.add("dark"),document.body.classList.add("dark")):(document.documentElement.classList.remove("dark"),document.body.classList.remove("dark"))},[t.theme,re,o]),f.useEffect(()=>{localStorage.setItem("focus_tab_search_engine",ye)},[ye]),f.useEffect(()=>{const y=T=>{Xe.current&&!Xe.current.contains(T.target)&&st(!1)};if(Ee)return document.addEventListener("mousedown",y),()=>document.removeEventListener("mousedown",y)},[Ee]);const ne=()=>{if(!me.trim())return;const T=`${(gr.find(R=>R.id===ye)||gr[0]).searchUrl}${encodeURIComponent(me.trim())} `;window.open(T,"_blank","noopener,noreferrer"),Ne("")},he=y=>{y.key==="Enter"&&!qe&&(y.preventDefault(),ne())},Je=()=>{it(!0)},le=()=>{it(!1)},se=(y,T,R)=>{const N=T.split(" "),z=[];let W="";return N.forEach(G=>{const ee=W?`${W} ${G} `:G,{width:F}=y.measureText(ee);F>R?(W&&z.push(W),W=G):W=ee}),W&&z.push(W),z},ce=(y,T,R,N,z,W)=>{y.save();const G=2,ee=[];for(let F=0;F<=10;F++){const Z=F/10,te=T+Z*N,ie=R;ee.push({x:te+(Math.random()-.5)*G,y:ie+(Math.random()-.5)*G})}for(let F=0;F<=5;F++){const Z=F/5,te=T+N,ie=R+Z*z;ee.push({x:te+(Math.random()-.5)*G,y:ie+(Math.random()-.5)*G})}for(let F=10;F>=0;F--){const Z=F/10,te=T+Z*N,ie=R+z;ee.push({x:te+(Math.random()-.5)*G,y:ie+(Math.random()-.5)*G})}for(let F=5;F>=0;F--){const Z=F/5,te=T,ie=R+Z*z;ee.push({x:te+(Math.random()-.5)*G,y:ie+(Math.random()-.5)*G})}y.beginPath(),y.moveTo(ee[0].x,ee[0].y);for(let F=1;F<ee.length;F++)y.lineTo(ee[F].x,ee[F].y);y.closePath(),y.fillStyle=W,y.globalAlpha=.25,y.fill(),y.restore()},Fe=(y,T,R,N,z)=>{const W=y.createLinearGradient(N,z,N+R,z+R);W.addColorStop(0,"#E8E8E8"),W.addColorStop(1,"#D0D0D0"),y.beginPath(),y.arc(N+R/2,z+R/2,R/2,0,Math.PI*2),y.fillStyle=W,y.fill(),y.fillStyle="#666666",y.font=`500 ${R*.5}px "Inter", sans-serif`,y.textAlign="center",y.textBaseline="middle",y.fillText(T.toUpperCase(),N+R/2,z+R/2),y.textAlign="left",y.textBaseline="top"},Ze=y=>{const T=[],R=/\[h\](.*?)\[\/h\]/g;let N=0,z;for(;(z=R.exec(y))!==null;)z.index>N&&T.push({text:y.substring(N,z.index),highlighted:!1}),T.push({text:z[1],highlighted:!0}),N=R.lastIndex;return N<y.length&&T.push({text:y.substring(N),highlighted:!1}),T.length===0&&T.push({text:y,highlighted:!1}),T},Et=(y,T,R,N,z)=>{y.beginPath(),y.moveTo(T+12,R),y.lineTo(T+N-12,R),y.quadraticCurveTo(T+N,R,T+N,R+12),y.lineTo(T+N,R+z-12),y.quadraticCurveTo(T+N,R+z,T+N-12,R+z),y.lineTo(T+12,R+z),y.quadraticCurveTo(T,R+z,T,R+z-12),y.lineTo(T,R+12),y.quadraticCurveTo(T,R,T+12,R),y.closePath(),y.fillStyle="#FFFFFF",y.fill();const G=50;y.fillStyle="#F5F5F5",y.fillRect(T,R,N,G);const ee=12,F=R+G/2-ee/2,Z=18,te=T+20;y.beginPath(),y.arc(te,F+ee/2,ee/2,0,Math.PI*2),y.fillStyle="#FF5F57",y.fill(),y.beginPath(),y.arc(te+Z,F+ee/2,ee/2,0,Math.PI*2),y.fillStyle="#FFBD2E",y.fill(),y.beginPath(),y.arc(te+Z*2,F+ee/2,ee/2,0,Math.PI*2),y.fillStyle="#28CA42",y.fill();const ie=120,ue=35,fe=T+60,Ce=R+G;y.fillStyle="#FFFFFF",y.fillRect(fe,Ce,ie,ue),y.fillStyle="#FF9500",y.font='400 14px "Inter", sans-serif',y.textAlign="left",y.fillText("â—",fe+10,Ce+ue/2+5),y.fillStyle="#333333",y.fillText("StartlyTab",fe+25,Ce+ue/2+5);const ve=R+G+ue+40,pe=50,oe=40;y.fillStyle="#F8F8F8",y.fillRect(T+oe,ve,N-oe*2,pe),y.fillStyle="#999999",y.font='400 16px "Inter", sans-serif',y.fillText("ğŸ”",T+oe+15,ve+pe/2+5),y.fillStyle="#CCCCCC",y.fillText("Search",T+oe+40,ve+pe/2+5);const de=ve+pe+60;y.fillStyle="#111111",y.font='400 32px "Instrument Serif", serif',y.textAlign="center",y.fillText("Rest is not idleness,",N/2,de),y.fillText("but a necessary pause.",N/2,de+45);const U=de+100,ge=140,$e=40,ke=20;y.fillStyle="#000000",y.fillRect(N/2-ge-ke/2,U,ge,$e),y.fillStyle="#FFFFFF",y.font='600 10px "Inter", sans-serif',y.textAlign="center",y.fillText("NEW PERSPECTIVE",N/2-ke/2,U+$e/2+3),y.fillStyle="#FFFFFF",y.strokeStyle="#E0E0E0",y.lineWidth=1,y.strokeRect(N/2+ke/2,U,ge,$e),y.fillStyle="#666666",y.fillText("SHARE QUOTE",N/2+ge/2+ke/2,U+$e/2+3);const ze=U+$e+60;y.fillStyle="#111111",y.font='400 20px "Instrument Serif", serif',y.textAlign="left",y.fillText("Intentional Gateways",T+oe,ze),y.fillStyle="#999999",y.font='400 12px "Inter", sans-serif',y.fillText("Your personal shortcuts, always ready.",T+oe,ze+30);const ut=32,Be=50,Ye=T+oe,dt=ze+50;["â—","â—","â—","â—","â—"].forEach((Wr,hr)=>{y.fillStyle="#E0E0E0",y.fillRect(Ye+hr*Be,dt,ut,ut),y.fillStyle="#999999",y.font='400 16px "Inter", sans-serif',y.textAlign="center",y.fillText(Wr,Ye+hr*Be+ut/2,dt+ut/2+5)}),y.textAlign="left",y.save(),y.shadowColor="rgba(0, 0, 0, 0.08)",y.shadowBlur=20,y.shadowOffsetX=0,y.shadowOffsetY=4,y.beginPath(),y.moveTo(T+12,R),y.lineTo(T+N-12,R),y.quadraticCurveTo(T+N,R,T+N,R+12),y.lineTo(T+N,R+z-12),y.quadraticCurveTo(T+N,R+z,T+N-12,R+z),y.lineTo(T+12,R+z),y.quadraticCurveTo(T,R+z,T,R+z-12),y.lineTo(T,R+12),y.quadraticCurveTo(T,R,T+12,R),y.closePath(),y.fillStyle="transparent",y.fill(),y.restore()},Ct=async y=>{await document.fonts.ready;const T=1080,R=T*.12,N=T-R*2,z=Ze(y),W=y.replace(/\[h\](.*?)\[\/h\]/g,"$1"),ee=document.createElement("canvas").getContext("2d");if(!ee)return null;ee.font='400 72px "Instrument Serif", serif';const F=100,Z=se(ee,W,N),te=Z.length*F+40,ie=160+te,ue=120,fe=80,Ce=450,oe=ie+fe+ue+fe+Ce+fe+180+100,de=document.createElement("canvas");de.width=T,de.height=oe;const U=de.getContext("2d");if(!U)return null;U.fillStyle="#FAFAF8",U.fillRect(0,0,T,oe);let ge=120;U.fillStyle="#E8E8E6",U.font='400 140px "Instrument Serif", serif',U.textAlign="left",U.textBaseline="top",U.fillText('"',R,ge-30),U.font='400 72px "Instrument Serif", serif',U.textAlign="left",U.textBaseline="top";const $e=["#F5E6D3","#FFF8DC","#E6E6FA"];let ke=0;const ze=[],ut=ge;Z.forEach((We,Tt)=>{const Pn=ut+Tt*F;z.forEach(Ge=>{if(Ge.highlighted&&Ge.text.trim()){const Pt=Ge.text.trim(),Js=We.indexOf(Pt);if(Js!==-1){const Ta=We.substring(0,Js),ja=R+U.measureText(Ta).width,Aa=U.measureText(Pt).width,Ys=72*.85;ze.push({x:ja-8,y:Pn-Ys*.15,width:Aa+16,height:Ys,color:$e[ke%$e.length]}),ke++}}})}),ze.forEach(We=>{ce(U,We.x,We.y,We.width,We.height,We.color)}),U.fillStyle="#1A1A1A",Z.forEach((We,Tt)=>{U.fillText(We,R,ut+Tt*F)}),ge+=te+100;const Be=t.user,Ye=64,dt=R,yt=ge;if(Be){if(Be.picture)try{const Ge=new Image;if(Ge.crossOrigin="anonymous",await new Promise(Pt=>{Ge.onload=()=>Pt(),Ge.onerror=()=>Pt(),Ge.src=Be.picture}),Ge.complete&&Ge.naturalWidth>0)U.save(),U.beginPath(),U.arc(dt+Ye/2,yt+Ye/2,Ye/2,0,Math.PI*2),U.clip(),U.drawImage(Ge,dt,yt,Ye,Ye),U.restore();else{const Pt=(Be.name||Be.email||"U")[0];Fe(U,Pt,Ye,dt,yt)}}catch{const Ge=(Be.name||Be.email||"U")[0];Fe(U,Ge,Ye,dt,yt)}else{const Ge=(Be.name||Be.email||"U")[0];Fe(U,Ge,Ye,dt,yt)}const We=dt+Ye+20,Tt=yt+8;U.fillStyle="#2A2A2A",U.font='500 20px "Inter", sans-serif',U.textAlign="left";const Pn=Be.name||(Be.email?`${Be.email.split("@")[0].substring(0,1)}*** @${Be.email.split("@")[1]} `:"User");U.fillText(Pn,We,Tt),U.fillStyle="#888888",U.font='400 14px "Inter", sans-serif',U.fillText("Shared via StartlyTab",We,Tt+32)}else Fe(U,"U",Ye,dt,yt),U.fillStyle="#2A2A2A",U.font='500 20px "Inter", sans-serif',U.fillText("Shared via StartlyTab",dt+Ye+20,yt+20);ge+=ue+fe;const Wr=T*.85,hr=Ce,Ra=(T-Wr)/2;return Et(U,Ra,ge,Wr,hr),ge+=hr+fe,U.textAlign="center",U.fillStyle="#1A1A1A",U.font='500 36px "Inter", sans-serif',U.fillText("StartlyTab",T/2,ge),ge+=50,U.fillStyle="#666666",U.font='400 22px "Inter", sans-serif',U.fillText("Start your day softly",T/2,ge),ge+=50,U.fillStyle="#777777",U.font='400 18px "Inter", sans-serif',U.fillText("A warm browser start page for focused minds.",T/2,ge),ge+=50,U.fillStyle="#555555",U.font='400 18px "Inter", sans-serif',U.fillText("www.startlytab.com",T/2,ge),U.textAlign="left",await new Promise(We=>{de.toBlob(Tt=>We(Tt),"image/png",1)})},Rt=gr.find(y=>y.id===ye)||gr[0],[dr,ct]=f.useState(!1),zr=t.links.slice(0,10);Math.max(0,t.links.length-zr.length);const In=async()=>{if(!dr&&r)try{ct(!0);const y=await Ct(r);if(!y)throw new Error("Failed to create image");const T=URL.createObjectURL(y),R=document.createElement("a");R.href=T,R.download=`startlytab-quote-${Date.now()}.png`,R.click(),URL.revokeObjectURL(T),O("Quote ready to share","success")}catch(y){console.error(y),O("Share failed","error")}finally{ct(!1)}};return f.useEffect(()=>{if(!r){Pe(!1);return}const y=()=>{if(De.current){const R=De.current,N=parseFloat(window.getComputedStyle(R).lineHeight),z=R.scrollHeight;Pe(z<=N*1.5)}},T=setTimeout(y,100);return window.addEventListener("resize",y),()=>{clearTimeout(T),window.removeEventListener("resize",y)}},[r,h]),f.useEffect(()=>{console.log("[App] Initializing Google Auth..."),L(!0),Tc(async y=>{L(!1),y?await I(y):console.log("[App] No user, rendering Google button")}),q.current||(q.current=!0,$())},[I]),f.useEffect(()=>{let y=!1;const T=async R=>{if(R.key==="focus_tab_user"){if(y){console.log("[App] Storage event already processing, skipping...");return}y=!0,console.log("[App] Detected user login/logout in another tab, syncing...");try{let N=null;if(R.newValue)try{N=JSON.parse(R.newValue)}catch(F){console.error("[App] Failed to parse user from storage event:",F),y=!1;return}const W=M.current.user,G=(W==null?void 0:W.id)||null,ee=(N==null?void 0:N.id)||null;G!==ee?(console.log("[App] User state changed:",{from:G?"logged in":"logged out",to:ee?"logged in":"logged out"}),N?(console.log("[App] User logged in in another tab, updating state..."),L(!0),await I(N),L(!1),O("Logged in from another tab","success")):(console.log("[App] User logged out in another tab, updating state..."),e(F=>{const Z={...F,user:null,subscriptionTier:void 0};return S(Z,!0).catch(te=>console.error("[App] Failed to save logout state:",te)),Z}),O("Logged out from another tab","info"))):console.log("[App] User state unchanged, skipping update")}finally{y=!1}}if(R.key==="focus_tab_state"){if(!R.newValue)return;try{const N=JSON.parse(R.newValue),z=M.current;N.links&&JSON.stringify(N.links)!==JSON.stringify(z.links)&&(console.log("[App] Detected Gateway changes in another tab, syncing..."),e(W=>({...W,links:N.links||W.links})))}catch(N){console.error("[App] Failed to parse state from storage event:",N)}}R.key==="focus_tab_gateway_logo_cache"&&J(N=>N+1)};return window.addEventListener("storage",T),()=>{window.removeEventListener("storage",T)}},[I,S,O]),f.useEffect(()=>{if(re)w(!1),P(!1);else{dn()>=2?w(!0):w(!1);const T=localStorage.getItem("startly_intention_local");P(!!T)}},[re]),f.useEffect(()=>{re||dn()>=2&&w(!0)},[re,t.user]),c.jsxs("div",{className:"relative min-h-screen w-full flex flex-col items-center overflow-x-hidden selection:bg-indigo-100 dark:selection:bg-indigo-900/40",children:[c.jsxs("div",{className:"fixed inset-0 pointer-events-none z-0",children:[c.jsxs("div",{className:`theme-overlay bg-[#FBFBFE] ${t.theme==="light"?"opacity-100":"opacity-0"} `,children:[c.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-[80%] h-[80%] bg-indigo-50/50 rounded-full blur-[160px] animate-breathing-slow"}),c.jsx("div",{className:"absolute bottom-[-20%] right-[-10%] w-[70%] h-[70%] bg-purple-50/40 rounded-full blur-[140px] animate-breathing-slow",style:{animationDelay:"-5s"}}),c.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full h-full bg-[radial-gradient(circle_at_center,rgba(255,255,255,0)_0%,rgba(251,251,254,1)_100%)]"})]}),c.jsxs("div",{className:`theme-overlay bg-[#0A0A0B] ${t.theme==="dark"?"opacity-100":"opacity-0"} `,children:[c.jsx("div",{className:"absolute top-[10%] left-[20%] w-[40%] h-[40%] bg-indigo-950/20 rounded-full blur-[120px] animate-lunar-drift"}),c.jsx("div",{className:"absolute bottom-[20%] right-[15%] w-[35%] h-[35%] bg-purple-950/10 rounded-full blur-[100px] animate-lunar-drift",style:{animationDelay:"-8s"}})]})]}),c.jsxs("nav",{className:"w-full px-8 md:px-12 lg:px-16 py-10 flex justify-between items-center z-20 animate-reveal",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("img",{src:"/icons/icon-64x64.png",alt:"StartlyTab",className:"w-11 h-11 object-contain"}),c.jsx("span",{className:"logo-text text-xl text-gray-800 dark:text-gray-200",children:"StartlyTab"}),l&&c.jsx("div",{className:"ml-2 w-1.5 h-1.5 bg-indigo-500 rounded-full animate-ping"}),c.jsxs("div",{className:"ml-6 relative",ref:Xe,children:[c.jsxs("div",{className:"flex items-center bg-white/50 dark:bg-white/5 border border-black/5 dark:border-white/5 rounded-[999px] overflow-hidden relative h-[50px] min-h-[50px] w-[380px]",children:[c.jsxs("button",{onClick:()=>st(!Ee),className:"flex items-center justify-center w-[44px] h-full hover:bg-white/50 dark:hover:bg-white/10 transition-colors relative","aria-label":"Select search engine",children:[c.jsx("img",{src:Rt.icon,alt:Rt.name,className:"w-[18px] h-[18px]"}),c.jsx("div",{className:"absolute right-0 top-1/2 -translate-y-1/2 w-px h-[30px] bg-black/5 dark:bg-white/5"})]}),c.jsx("input",{ref:Te,id:"search-input",type:"text",placeholder:"Search",value:me,onChange:y=>Ne(y.target.value),onKeyDown:he,onCompositionStart:Je,onCompositionEnd:le,className:"flex-1 px-[18px] py-[12px] pr-[60px] bg-transparent text-gray-800 dark:text-gray-200 placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none",style:{fontSize:"15px",lineHeight:"1.5"}}),c.jsx("button",{onClick:ne,className:"absolute right-2 top-1/2 -translate-y-1/2 w-[34px] h-[34px] rounded-full bg-black flex items-center justify-center hover:bg-[#1A1A1A] active:bg-[#111] transition-colors cursor-pointer","aria-label":"Search",children:c.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),Ee&&c.jsx("div",{className:"absolute top-full left-0 mt-2 bg-white dark:bg-gray-800 border border-black/5 dark:border-white/5 rounded-2xl shadow-lg overflow-hidden z-30 min-w-[200px]",children:gr.map(y=>c.jsxs("button",{onClick:()=>{Ve(y.id),st(!1)},className:`w-full flex items-center gap-3 px-4 py-3 hover: bg-gray-50 dark: hover: bg-white / 5 transition-colors ${ye===y.id?"bg-gray-50 dark:bg-white/5":""} `,children:[c.jsx("img",{src:y.icon,alt:y.name,className:"w-4 h-4"}),c.jsx("span",{className:"text-sm text-gray-800 dark:text-gray-200",children:y.name})]},y.id))})]})]}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("button",{onClick:()=>{const y=t.theme==="light"?"dark":"light";S({...t,theme:y}),O(`Theme: ${y} `,"info")},className:"p-3.5 bg-white/50 dark:bg-white/5 backdrop-blur-md rounded-2xl border border-black/5 dark:border-white/5 hover:bg-white dark:hover:bg-white/10 transition-all active:scale-95 group","aria-label":"Toggle Theme",children:t.theme==="light"?c.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})}):c.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 3v1m0 16v1m9-9h-1M4 9H3m15.364-6.364l-.707.707M6.343 17.657l-.707.707m12.728 0l-.707-.707M6.343 6.343l-.707-.707M15 12a3 3 0 11-6 0 3 3 0 016 0z"})})}),c.jsx("button",{onClick:()=>a(!0),className:"px-6 py-3.5 bg-black dark:bg-white text-white dark:text-black rounded-full text-[11px] font-bold uppercase tracking-[0.15em] hover:opacity-90 transition-all active:scale-95 shadow-xl shadow-indigo-500/10",children:"Studio"})]})]}),c.jsx("main",{className:"flex-1 w-full flex flex-col items-center justify-center px-8 z-10 pt-8 pb-16",children:c.jsxs("div",{className:`animate-reveal transition-all duration-500 ease-out text-center flex flex-col items-center 
          ${((r==null?void 0:r.length)||0)>26?"max-w-[90%] lg:max-w-7xl":"max-w-4xl"} 
          ${Qe?"-mt-8 md:-mt-12 lg:-mt-16":""}`,children:[c.jsx("div",{className:"max-h-[50vh] overflow-y-auto no-scrollbar w-full px-4 md:px-8",children:c.jsx("h1",{ref:De,className:`serif editorial-title font-normal leading-[1.35] md:leading-[1.3] lg:leading-[1.3] tracking-[-0.02em] text-black dark:text-white transition-all duration-300
                ${((r==null?void 0:r.length)||0)>26?"text-4xl md:text-6xl lg:text-7xl":"text-5xl md:text-7xl lg:text-8xl"}
              `,children:r?H(r):c.jsx(be,{})})}),c.jsxs("div",{className:"mt-10 flex flex-col items-center gap-4",children:[c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("button",{onClick:()=>$(),disabled:s,className:"px-10 py-5 bg-black dark:bg-white text-white dark:text-black rounded-full text-xs font-bold uppercase tracking-widest shadow-2xl transition-all hover:scale-105 active:scale-95 flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed",children:s?"Reflecting...":"New Perspective"}),c.jsxs("button",{onClick:In,disabled:dr||!r,className:"px-6 py-4 rounded-full border border-black/10 dark:border-white/10 bg-white/60 dark:bg-white/5 text-xs font-semibold uppercase tracking-[0.14em] text-gray-600 dark:text-gray-200 transition-all hover:bg-white/80 dark:hover:bg-white/10 active:scale-95 flex items-center gap-2 disabled:opacity-60",children:[c.jsxs("svg",{className:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round",strokeLinejoin:"round",children:[c.jsx("path",{d:"M4 12v7a1 1 0 001 1h14a1 1 0 001-1v-7"}),c.jsx("path",{d:"M12 16V4"}),c.jsx("path",{d:"M8 8l4-4 4 4"})]}),c.jsx("span",{children:"Share Quote"})]})]}),!re&&(_||C)&&c.jsx("div",{className:`max-w-md w-full text-center animate-reveal mt-2 ${k?"animate-shake":""} `,children:C?c.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Saved locally."," ",c.jsx("button",{onClick:D,className:"text-blue-600 dark:text-blue-400 hover:underline font-medium",children:"Sign in with Google"})," ","to unlock unlimited perspectives and sync across devices."]}):c.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Still looking for the right tone?"," ",c.jsx("button",{onClick:()=>x(!0),className:"text-blue-600 dark:text-blue-400 hover:underline font-medium",children:"Tell us what you like"})," ","to get better matches."]})})]})]},h)}),re?c.jsx(Hg,{links:t.links,onUpdate:y=>S(T=>({...T,links:y})),isAuthenticated:re,onLoginRequired:()=>b(!0),canAddMore:bs(t).allowed}):c.jsx("section",{className:"w-full max-w-7xl px-8 pb-14 z-10 animate-reveal",style:{animationDelay:"0.4s"},children:c.jsx("div",{className:"soft-card p-6 md:p-8 rounded-[2rem] shadow-xl shadow-black/5 overflow-hidden flex flex-col items-center",children:c.jsx("div",{className:"w-full flex flex-col items-center justify-center py-6",children:c.jsxs("div",{className:"max-w-md w-full flex flex-col items-center text-center",children:[c.jsx("h2",{className:"serif text-3xl md:text-4xl text-gray-800 dark:text-gray-100 mb-2 whitespace-nowrap",children:"Start your day softly â€” with everything ready"}),c.jsx("p",{className:"text-gray-400 dark:text-gray-500 text-sm leading-relaxed mb-6",children:"Unlimited shortcuts, always one click away."}),c.jsx("div",{className:"flex flex-col items-center gap-4 w-full",children:c.jsxs("button",{onClick:D,className:"group relative flex items-center justify-center gap-3 w-full px-8 py-3 bg-white dark:bg-white/10 text-gray-700 dark:text-white rounded-full border border-gray-200 dark:border-white/10 hover:bg-gray-50 dark:hover:bg-white/20 hover:border-gray-300 dark:hover:border-white/20 transition-all duration-300 active:scale-[0.98] shadow-sm hover:shadow-md",children:[c.jsxs("svg",{className:"w-5 h-5 flex-shrink-0",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:[c.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),c.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),c.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),c.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),c.jsx("span",{className:"font-medium tracking-wide",children:"Sign in with Google"})]})})]})})})}),c.jsx("div",{className:"fixed bottom-12 right-12 flex flex-col gap-3 z-[100]",children:d.map(y=>c.jsx("div",{className:"px-8 py-5 bg-black dark:bg-white text-white dark:text-black text-xs font-bold uppercase tracking-widest rounded-3xl shadow-2xl animate-reveal border border-white/10 dark:border-black/5",children:y.message},y.id))}),c.jsx(zh,{isOpen:o,onClose:()=>a(!1),state:t,updateState:S,addToast:O,onSignIn:D,onSignOut:()=>{Nc();const y={...t,user:null,subscriptionTier:void 0};S(y),O("Signed out")}}),c.jsx(Wh,{isOpen:v,onClose:()=>b(!1),onSignIn:D,theme:t.theme}),c.jsx(Gh,{isOpen:m,onClose:()=>x(!1),onSaveLocal:Q,theme:t.theme,isAuthenticated:re,onLogin:D})]})},Jg=[{id:"free",label:"Free",subtitle:"Complete and calm for simple starts.",price:0,billingLine:"Always free",bullets:["2 gentle New Perspective refreshes each session","Up to 2 intentions to set your tone","Up to 8 shortcuts for daily essentials","Local preferences that sync when you sign in"]},{id:"pro",label:"Startly Pro",subtitle:"For a soft, intentional start every day.",price:4.99,billingLine:"$4.99 / month",bullets:["Refresh your perspective anytime you need it","As many intentions as you like, with natural rotation","As many shortcuts as you like, neatly organized","Full cross-device sync Â· No ads Â· No tracking"]},{id:"lifetime",label:"Lifetime",subtitle:"For those who want calm to be permanent.",price:79,billingLine:"One-time payment",bullets:["All Pro features, without a subscription","Keep your daily ritual, even if tools change","No renewals, no expiry to track","A quiet, long-term way to support StartlyTab"]}],Yg=({user:t,onSubscriptionUpdate:e})=>{const[r,n]=f.useState(!1),[s,i]=f.useState("free"),[o,a]=f.useState("yearly");f.useEffect(()=>{t!=null&&t.id&&Us(t.id).then(h=>{h.subscriptionPlan&&h.subscriptionPlan!=="free"&&h.isSubscribed?i("pro"):i("free")})},[t]);const l=async h=>{if(!(!(t!=null&&t.id)||!e)&&h!=="free"&&!(s==="pro"&&h==="pro"))try{await new Promise(m=>setTimeout(m,1200));const p=Date.now(),v=h==="lifetime"?new Date(p+10*365*24*60*60*1e3).toISOString():o==="yearly"?new Date(p+365*24*60*60*1e3).toISOString():new Date(p+720*60*60*1e3).toISOString(),b={...t,isSubscribed:!0,subscriptionPlan:"pro",subscriptionStatus:"active",subscriptionExpiresAt:v};i("pro"),n(!0),await e(b)}catch(p){console.error("[Subscription] Plan selection failed:",p)}},u=s==="pro",d=()=>o==="monthly"?4.99:39,g=()=>o==="monthly"?"/ month":"/ year";return c.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50/30 to-blue-50/40 relative overflow-hidden",children:[c.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[c.jsx("div",{className:"absolute top-0 left-1/4 w-96 h-96 bg-purple-200/20 rounded-full blur-3xl"}),c.jsx("div",{className:"absolute bottom-0 right-1/4 w-96 h-96 bg-pink-200/20 rounded-full blur-3xl"})]}),c.jsxs("div",{className:"max-w-[1120px] mx-auto px-10 py-12 flex flex-col gap-10 relative z-10",children:[c.jsxs("div",{className:"space-y-3",children:[c.jsx("p",{className:"text-xs tracking-[0.28em] uppercase text-gray-500/70",children:"STARTLYTAB"}),c.jsx("p",{className:"serif text-base text-gray-700/80",children:"A calm start is worth protecting."}),c.jsx("h1",{className:"serif text-4xl md:text-[2.6rem] font-normal text-gray-800",children:"Subscriptions"}),c.jsx("p",{className:"text-sm md:text-base text-gray-600/75 max-w-xl leading-relaxed",children:"Free is enough for a simple morning. Pro is for people who want their browser to feel like a gentle, daily ritual."})]}),r&&c.jsxs("div",{className:"flex items-center gap-2 px-4 py-3 bg-white/60 backdrop-blur-md rounded-2xl border border-white/30 shadow-[0_8px_24px_rgba(0,0,0,0.08)]",children:[c.jsx("svg",{className:"w-4 h-4 text-emerald-600/80",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),c.jsx("span",{className:"text-sm text-gray-700",children:"You're all set. Changes apply to your next start."})]}),c.jsx("div",{className:"flex items-stretch justify-center gap-5",children:Jg.map(h=>{const p=h.id==="pro",v=h.id==="lifetime",b=u&&p,m=p?d():h.price,x=p?g():h.billingLine;return c.jsxs("div",{className:`relative rounded-2xl border backdrop-blur-md transition-transform duration-200 ease-out ${p?"bg-white/70 border-white/40 shadow-[0_20px_40px_rgba(0,0,0,0.1)]":"bg-white/60 border-white/30 shadow-[0_12px_32px_rgba(0,0,0,0.08)]"} px-6 py-7 flex flex-col justify-between`,style:{width:h.id==="pro"?360:320,transform:h.id==="pro"?"scale(1.05)":"scale(1)"},children:[p&&c.jsx("div",{className:"absolute -top-6 left-1/2 -translate-x-1/2",children:c.jsx("div",{className:"px-4 py-1 rounded-full bg-white/80 backdrop-blur-sm border border-white/40 shadow-[0_8px_20px_rgba(0,0,0,0.1)] text-[11px] font-medium text-gray-700",children:"Most chosen"})}),c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{children:[c.jsx("p",{className:"text-xs font-semibold tracking-[0.18em] uppercase text-gray-500/80 mb-1",children:h.id==="pro"?"Pro":h.id==="lifetime"?"Lifetime Access":"Free"}),c.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:h.label}),c.jsx("p",{className:"text-xs text-gray-600/80 mt-1 leading-relaxed",children:h.subtitle})]}),p&&c.jsx("div",{className:"mt-4 mb-2",children:c.jsxs("div",{className:"flex items-center gap-1.5 bg-white/50 backdrop-blur-sm rounded-full p-1 border border-white/30",children:[c.jsx("button",{onClick:()=>a("monthly"),className:`px-4 py-1.5 rounded-full text-xs font-medium transition-all duration-200 ease-out ${o==="monthly"?"bg-purple-500 text-white shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"Monthly"}),c.jsx("button",{onClick:()=>a("yearly"),className:`px-4 py-1.5 rounded-full text-xs font-medium transition-all duration-200 ease-out ${o==="yearly"?"bg-purple-500 text-white shadow-sm":"text-gray-600 hover:text-gray-800"}`,children:"Yearly"})]})}),c.jsx("div",{className:"mt-3",children:c.jsxs("div",{className:"flex items-baseline gap-2",children:[c.jsx("span",{className:`font-semibold ${h.id==="pro"?"text-[2rem]":"text-[1.8rem]"} text-gray-800`,children:m===0?"$0":`$${m}`}),c.jsx("span",{className:"text-gray-600/75 text-sm",children:h.id==="free"?"":x}),h.id==="free"&&c.jsx("span",{className:"text-gray-500/70 text-sm",children:"Always free"}),v&&c.jsx("span",{className:"ml-1 text-xs text-gray-500/75",children:"Pay once, keep forever"}),p&&o==="yearly"&&c.jsx("span",{className:"ml-1 text-xs text-gray-500/70",children:"billed yearly"})]})})]}),c.jsx("div",{className:"mt-5 mb-5",children:b?c.jsx("div",{className:"py-3 text-center text-sm text-gray-500/55 font-medium",children:"You're on Pro"}):c.jsx("button",{onClick:()=>l(h.id),className:`w-full py-3.5 rounded-full text-sm font-medium transition-all duration-200 ease-out ${h.id==="pro"?"bg-purple-500 text-white hover:bg-purple-600 active:scale-[0.98] shadow-md":h.id==="free"?"bg-white/80 backdrop-blur-sm text-gray-700 border border-gray-200/50 hover:bg-white/90":"bg-white/80 backdrop-blur-sm text-gray-800 border border-gray-300/50 hover:border-gray-400/70"}`,children:h.id==="free"?"Continue with Free":h.id==="pro"?"Upgrade to Pro":"Get Lifetime"})}),c.jsx("div",{className:"space-y-2.5 pt-2",children:h.bullets.slice(0,4).map((_,w)=>c.jsxs("div",{className:"flex items-start gap-2 text-sm text-gray-700/85 leading-relaxed",children:[c.jsx("span",{className:"mt-1 inline-flex w-3.5 h-3.5 rounded-full bg-purple-100/70 text-purple-600/80 items-center justify-center flex-shrink-0",children:c.jsx("svg",{className:"w-2 h-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.4,d:"M5 13l4 4L19 7"})})}),c.jsx("span",{children:_})]},w))})]},h.id)})}),c.jsx("div",{className:"text-center text-sm text-gray-500/70 pb-2",children:"Cancel anytime Â· No ads Â· No tracking Â· Designed for quiet mornings"})]})]})},Xg=()=>c.jsxs("div",{className:"flex flex-col items-center justify-center p-10 bg-white dark:bg-gray-950 rounded-2xl w-full h-80 relative overflow-hidden transition-colors",role:"status",children:[c.jsx("style",{children:`
        @keyframes shimmer-slide {
          0% { transform: translateX(-150%); }
          100% { transform: translateX(150%); }
        }
        .shimmer-mask {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: linear-gradient(
            90deg, 
            transparent 0%, 
            rgba(255,255,255,0.8) 50%, 
            transparent 100%
          );
          opacity: 0.6;
          transform: skewX(-20deg) translateX(-150%);
          animation: shimmer-slide 2s infinite ease-in-out; 
          pointer-events: none;
        }
        .dark .shimmer-mask {
           background: linear-gradient(
            90deg, 
            transparent 0%, 
            rgba(255,255,255,0.1) 50%, 
            transparent 100%
          );
        }
      `}),c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:"text-2xl font-light tracking-[0.2em] text-gray-400 dark:text-gray-500 font-sans",children:"REFLECTING..."}),c.jsx("div",{className:"absolute inset-0 text-2xl font-light tracking-[0.2em] font-sans text-transparent bg-gradient-to-r from-transparent via-gray-800 to-transparent dark:via-gray-200 bg-clip-text",style:{backgroundSize:"200% 100%",animation:"text-shimmer 2s infinite linear"},children:"REFLECTING..."}),c.jsx("style",{children:`
            @keyframes text-shimmer {
                0% { background-position: 200% 0; }
                100% { background-position: -200% 0; }
            }
          `})]}),c.jsx("p",{className:"mt-20 text-xs text-gray-400 font-light tracking-wide uppercase opacity-60",children:"Variant A: Breathing Light"})]}),Qg=()=>c.jsxs("div",{className:"flex flex-col items-center justify-center p-10 bg-white dark:bg-gray-950 rounded-2xl w-full h-80 relative transition-colors overflow-hidden",children:[c.jsx("svg",{style:{position:"absolute",width:0,height:0},children:c.jsx("defs",{children:c.jsxs("filter",{id:"goo",children:[c.jsx("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"10",result:"blur"}),c.jsx("feColorMatrix",{in:"blur",mode:"matrix",values:"1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 18 -7",result:"goo"}),c.jsx("feComposite",{in:"SourceGraphic",in2:"goo",operator:"atop"})]})})}),c.jsx("style",{children:`
        @keyframes blob-move-1 {
          0%, 100% { transform: translate(0, 0) scale(1); }
          33% { transform: translate(30px, -50px) scale(1.1); }
          66% { transform: translate(-20px, 20px) scale(0.9); }
        }
        @keyframes blob-move-2 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(-30px, 50px) scale(0.9); }
            66% { transform: translate(20px, -20px) scale(1.1); }
        }
        @keyframes blob-move-3 {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(20px, 30px) scale(1.2); }
            66% { transform: translate(-40px, -10px) scale(0.8); }
        }
        .liquid-container {
            filter: url(#goo);
            width: 200px;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .blob {
            position: absolute;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 50%;
            opacity: 0.8;
        }
        .dark .blob {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
             opacity: 0.6;
        }
        .ai-core {
             background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.8), rgba(255,255,255,0));
             mix-blend-mode: overlay;
        }
      `}),c.jsx("div",{className:"relative mb-6",children:c.jsxs("div",{className:"liquid-container",children:[c.jsx("div",{className:"blob w-20 h-20 bg-indigo-500",style:{animation:"blob-move-1 5s infinite ease-in-out"}}),c.jsx("div",{className:"blob w-24 h-24 bg-purple-500 dark:bg-blue-500",style:{animation:"blob-move-2 6s infinite ease-in-out",animationDelay:"-1.5s"}}),c.jsx("div",{className:"blob w-16 h-16 bg-amber-400 dark:bg-amber-500",style:{animation:"blob-move-3 5.5s infinite ease-in-out",animationDelay:"-3s"}}),c.jsx("div",{className:"blob w-12 h-12 bg-white/90 dark:bg-white/80 blur-[2px] z-10 ai-core",itemID:""})]})}),c.jsx("div",{className:"text-sm text-transparent bg-clip-text bg-gradient-to-r from-indigo-500 via-purple-500 to-amber-500 font-medium tracking-widest uppercase animate-pulse",children:"Reflecting"}),c.jsx("p",{className:"mt-8 text-xs text-gray-400 font-light tracking-wide uppercase opacity-60",children:"Variant B: Liquid Thought"})]}),Zg=()=>{const t=f.useRef(null);return f.useEffect(()=>{const e=t.current;if(!e)return;const r=e.getContext("2d",{willReadFrequently:!0});if(!r)return;const n=window.devicePixelRatio||1,s=e.getBoundingClientRect();e.width=s.width*n,e.height=s.height*n,r.scale(n,n);const i=s.width,o=s.height,a=80,l='"Zain", sans-serif',u=1.2,d=3,h=document.documentElement.classList.contains("dark")?"#ffffff":"#1a1a1a",p=k=>{const E=document.createElement("canvas");E.width=i,E.height=o;const A=E.getContext("2d");if(!A)return[];A.font=`800 ${a}px ${l}`,A.textAlign="center",A.textBaseline="middle",A.fillStyle="white",A.fillText(k,i/2,o/2);const L=A.getImageData(0,0,i,o),{data:X}=L,J=[];for(let re=0;re<o;re+=d)for(let me=0;me<i;me+=d)X[(re*i+me)*4+3]>200&&J.push({x:me,y:re});return J},v=p("Loading..."),b=p("StartlyTab");let m=v.map(k=>({x:k.x,y:k.y,targetX:k.x,targetY:k.y,vx:0,vy:0,size:Math.random()*.5+u,alpha:1,locked:!0,delay:Math.random()*50})),x,_="HOLD_A",w=0;const C=()=>{if(r.clearRect(0,0,i,o),w++,_==="HOLD_A")w>60&&(_="BLOW_AWAY",w=0,m.forEach(k=>{k.locked=!1,k.vx=Math.random()*2+2,k.vy=(Math.random()-.5)*4-1}));else if(_==="BLOW_AWAY"){if(w>80){_="REASSEMBLE",w=0;const k=b;if(m.length<k.length){const A=k.length-m.length;for(let L=0;L<A;L++)m.push({x:-100,y:Math.random()*o,targetX:k[m.length+L].x,targetY:k[m.length+L].y,vx:Math.random()*5+5,vy:0,size:Math.random()*.5+u,alpha:0,locked:!1,delay:Math.random()*30})}const E=Array.from({length:k.length},(A,L)=>L).sort(()=>Math.random()-.5);m.forEach((A,L)=>{if(L<k.length){const X=k[E[L]];A.targetX=X.x,A.targetY=X.y,A.locked=!1}else A.targetX=i+100,A.targetY=A.y+(Math.random()-.5)*50,A.locked=!1})}}else if(_==="REASSEMBLE")w>100&&(_="HOLD_B",w=0);else if(_==="HOLD_B"){if(w>80){_="RESET",w=0;const k=v;m.forEach((E,A)=>{A<k.length&&(E.locked=!1,E.vx=Math.random()*2+2,E.vy=(Math.random()-.5)*4-1)})}}else if(_==="RESET"){if(w>60){_="REFORM_A",w=0;const k=v,E=Array.from({length:k.length},(A,L)=>L).sort(()=>Math.random()-.5);if(m.length<k.length){const A=k.length-m.length;for(let L=0;L<A;L++)m.push({x:-100,y:Math.random()*o,targetX:0,targetY:0,vx:5,vy:0,size:u,alpha:0,locked:!1,delay:0})}m.forEach((A,L)=>{if(L<k.length){const X=k[E[L]];A.targetX=X.x,A.targetY=X.y,A.locked=!1}else A.targetX=i+200,A.targetY=A.y})}}else _==="REFORM_A"&&w>100&&(_="HOLD_A",w=0);m.forEach(k=>{if(_==="BLOW_AWAY"||_==="RESET"&&w<=60){const E=Math.sin(k.y*.05+w*.1)*.5;k.x+=k.vx+E,k.y+=k.vy,k.vx*=1.02,k.alpha-=.02,k.alpha<0&&(k.alpha=0)}else if(_==="REASSEMBLE"||_==="REFORM_A"){const E=k.targetX-k.x,A=k.targetY-k.y;Math.sqrt(E*E+A*A)<1?(k.x=k.targetX,k.y=k.targetY,k.locked=!0):(k.x+=E*.1,k.y+=A*.1),k.alpha<1&&(k.alpha+=.05)}k.alpha>.01&&(r.globalAlpha=k.alpha,r.fillStyle=h,r.beginPath(),r.arc(k.x,k.y,k.size,0,Math.PI*2),r.fill())}),r.globalAlpha=1,x=requestAnimationFrame(C)},P=setTimeout(C,100);return()=>{clearTimeout(P),cancelAnimationFrame(x)}},[]),c.jsxs("div",{className:"flex flex-col items-center justify-center p-10 bg-white dark:bg-gray-950 rounded-2xl w-full h-80 relative transition-colors overflow-hidden",children:[c.jsx("div",{className:"absolute opacity-0 font-bold",style:{fontFamily:'"Zain", sans-serif'},children:"Loading... StartlyTab"}),c.jsx("div",{className:"relative w-full h-48 flex items-center justify-center",children:c.jsx("canvas",{ref:t,className:"w-full h-full"})}),c.jsx("p",{className:"mt-8 text-xs text-gray-400 font-light tracking-wide uppercase opacity-60",children:"Variant E: Wind Particle Morph"})]})},ep=()=>{const[t,e]=f.useState("E");return c.jsxs("div",{className:"min-h-screen bg-gray-100 dark:bg-black text-gray-900 dark:text-gray-100 flex flex-col items-center justify-center p-4",children:[c.jsx("h1",{className:"text-3xl font-bold mb-2 tracking-tight",children:"Loading Effect Concepts"}),c.jsx("p",{className:"mb-8 text-gray-500 dark:text-gray-400",children:"Select a variation below to preview"}),c.jsxs("div",{className:"w-full max-w-md shadow-2xl rounded-2xl overflow-hidden border border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-950",children:[t==="A"&&c.jsx(Xg,{}),t==="B"&&c.jsx(Qg,{}),t==="E"&&c.jsx(Zg,{})]}),c.jsxs("div",{className:"flex gap-4 mt-8 flex-wrap justify-center",children:[c.jsx("button",{onClick:()=>e("A"),className:`px-6 py-3 rounded-xl text-sm font-medium transition-all duration-200 ${t==="A"?"bg-black dark:bg-white text-white dark:text-black shadow-lg scale-105":"bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 hover:scale-105"}`,children:"Simple"}),c.jsx("button",{onClick:()=>e("B"),className:`px-6 py-3 rounded-xl text-sm font-medium transition-all duration-200 ${t==="B"?"bg-black dark:bg-white text-white dark:text-black shadow-lg scale-105":"bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 hover:scale-105"}`,children:"Liquid"}),c.jsx("button",{onClick:()=>e("E"),className:`px-6 py-3 rounded-xl text-sm font-medium transition-all duration-200 ${t==="E"?"bg-black dark:bg-white text-white dark:text-black shadow-lg scale-105":"bg-white dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700 hover:scale-105"}`,children:"Particles"})]}),c.jsxs("div",{className:"mt-12 text-center max-w-lg text-sm text-gray-500 space-y-2",children:[c.jsxs("p",{children:[c.jsx("strong",{children:"Simple"})," â€” Minimalist text with a shimmering focus."]}),c.jsxs("p",{children:[c.jsx("strong",{children:"Liquid"})," â€” Fluid morphing blobs (CSS Filters)."]}),c.jsxs("p",{children:[c.jsx("strong",{children:"Particles"})," â€” Text dissolving into wind and reassembling."]})]}),c.jsx("a",{href:"/",className:"mt-8 text-sm text-gray-400 hover:text-gray-900 dark:hover:text-white underline underline-offset-4",children:"Back to Home"})]})},Ea=f.createContext(null),tp=()=>{const t=f.useContext(Ea);if(!t)throw new Error("useUser must be used within UserProvider");return t},rp=({children:t})=>{const[e,r]=f.useState(()=>{try{const s=localStorage.getItem("focus_tab_user");return s?JSON.parse(s):null}catch{return null}});f.useEffect(()=>{if(!(e!=null&&e.id))return;const s=async()=>{const a=new Promise(u=>{setTimeout(()=>u(null),1200)}),l=Promise.all([Us(e.id),xr(e.id),_r(e.id)]).then(([u,d,g])=>({...e,...u,...d&&{memberViaRedeem:d.memberViaRedeem,membershipSince:d.membershipSince},...g&&{redeemEnabled:g.redeemEnabled}}));try{const u=await Promise.race([l,a]);u&&(r(u),localStorage.setItem("focus_tab_user",JSON.stringify(u)))}catch(u){console.error("[AppRouter] Background subscription check failed:",u)}};s();const i=()=>{document.visibilityState==="visible"&&s()},o=()=>{s()};return window.addEventListener("visibilitychange",i),window.addEventListener("focus",o),()=>{window.removeEventListener("visibilitychange",i),window.removeEventListener("focus",o)}},[e==null?void 0:e.id]);const n=s=>{r(s),s?localStorage.setItem("focus_tab_user",JSON.stringify(s)):localStorage.removeItem("focus_tab_user")};return c.jsx(Ea.Provider,{value:{user:e,setUser:n},children:t})},np=()=>{const{user:t,setUser:e}=tp();kt();const r=async n=>{n.id&&await Sh(n.id,{isSubscribed:n.isSubscribed||!1,subscriptionPlan:n.subscriptionPlan||"free",subscriptionStatus:n.subscriptionStatus||"active",subscriptionExpiresAt:n.subscriptionExpiresAt||null}),e(n)};return c.jsxs(Nl,{children:[c.jsx(mr,{path:"/",element:c.jsx(Vg,{})}),c.jsx(mr,{path:"/subscription",element:c.jsx(Yg,{user:t,onSubscriptionUpdate:r})}),c.jsx(mr,{path:"/loading-demo",element:c.jsx(ep,{})}),c.jsx(mr,{path:"*",element:c.jsx(jl,{to:"/",replace:!0})})]})},sp=()=>c.jsx(tc,{children:c.jsx(rp,{children:c.jsx(np,{})})}),Ca=document.getElementById("root");if(!Ca)throw new Error("Could not find root element to mount to");const ip=Ia.createRoot(Ca);ip.render(c.jsx(xe.StrictMode,{children:c.jsx(sp,{})}));
